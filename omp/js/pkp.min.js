(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a("undefined"!=typeof jQuery?jQuery:window.Zepto)})(function(a){function b(b){var c=b.data;b.isDefaultPrevented()||(b.preventDefault(),a(b.target).ajaxSubmit(c))}function c(b){var c=b.target,d=a(c);if(!d.is("[type=submit],[type=image]")){c=d.closest("[type=submit]");if(0===c.length)return;c=c[0]}var e=this;e.clk=c;"image"==c.type&&(void 0!==b.offsetX?(e.clk_x=b.offsetX,e.clk_y=b.offsetY):"function"==typeof a.fn.offset?(d=d.offset(),
e.clk_x=b.pageX-d.left,e.clk_y=b.pageY-d.top):(e.clk_x=b.pageX-c.offsetLeft,e.clk_y=b.pageY-c.offsetTop));setTimeout(function(){e.clk=e.clk_x=e.clk_y=null},100)}function d(){if(a.fn.ajaxSubmit.debug){var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}}var e,f;e=void 0!==a("<input type='file'/>").get(0).files;f=void 0!==window.FormData;var g=!!a.fn.prop;a.fn.attr2=function(){if(!g)return this.attr.apply(this,
arguments);var a=this.prop.apply(this,arguments);return a&&a.jquery||"string"===typeof a?a:this.attr.apply(this,arguments)};a.fn.ajaxSubmit=function(b){function c(e){function f(a){var b=null;try{a.contentWindow&&(b=a.contentWindow.document)}catch(c){d("cannot get iframe.contentWindow document: "+c)}if(b)return b;try{b=a.contentDocument?a.contentDocument:a.document}catch(e){d("cannot get iframe.contentDocument: "+e),b=a.document}return b}function A(){function b(){try{var a=f(s).readyState;d("state = "+
a);a&&"uninitialized"==a.toLowerCase()&&setTimeout(b,50)}catch(c){d("Server abort: ",c," (",c.name,")"),j(z),u&&clearTimeout(u),u=void 0}}var c=p.attr2("target"),e=p.attr2("action"),g=p.attr("enctype")||p.attr("encoding")||"multipart/form-data";k.setAttribute("target",n);(!i||/post/i.test(i))&&k.setAttribute("method","POST");e!=l.url&&k.setAttribute("action",l.url);!l.skipEncodingOverride&&(!i||/post/i.test(i))&&p.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});l.timeout&&(u=
setTimeout(function(){t=!0;j(B)},l.timeout));var h=[];try{if(l.extraData)for(var v in l.extraData)l.extraData.hasOwnProperty(v)&&(a.isPlainObject(l.extraData[v])&&l.extraData[v].hasOwnProperty("name")&&l.extraData[v].hasOwnProperty("value")?h.push(a('<input type="hidden" name="'+l.extraData[v].name+'">').val(l.extraData[v].value).appendTo(k)[0]):h.push(a('<input type="hidden" name="'+v+'">').val(l.extraData[v]).appendTo(k)[0]));l.iframeTarget||m.appendTo("body");s.attachEvent?s.attachEvent("onload",
j):s.addEventListener("load",j,!1);setTimeout(b,15);try{k.submit()}catch(x){document.createElement("form").submit.apply(k)}}finally{k.setAttribute("action",e),k.setAttribute("enctype",g),c?k.setAttribute("target",c):p.removeAttr("target"),a(h).remove()}}function j(b){if(!q.aborted&&!D)if(w=f(s),w||(d("cannot access response document"),b=z),b===B&&q)q.abort("timeout"),y.reject(q,"timeout");else if(b==z&&q)q.abort("server abort"),y.reject(q,"error","server abort");else if(w&&w.location.href!=l.iframeSrc||
t){s.detachEvent?s.detachEvent("onload",j):s.removeEventListener("load",j,!1);var b="success",c;try{if(t)throw"timeout";var e="xml"==l.dataType||w.XMLDocument||a.isXMLDoc(w);d("isXml="+e);if(!e&&(window.opera&&(null===w.body||!w.body.innerHTML))&&--G){d("requeing onLoad callback, DOM not available");setTimeout(j,250);return}var g=w.body?w.body:w.documentElement;q.responseText=g?g.innerHTML:null;q.responseXML=w.XMLDocument?w.XMLDocument:w;e&&(l.dataType="xml");q.getResponseHeader=function(a){return{"content-type":l.dataType}[a.toLowerCase()]};
g&&(q.status=Number(g.getAttribute("status"))||q.status,q.statusText=g.getAttribute("statusText")||q.statusText);var h=(l.dataType||"").toLowerCase(),A=/(json|script|text)/.test(h);if(A||l.textarea){var i=w.getElementsByTagName("textarea")[0];if(i)q.responseText=i.value,q.status=Number(i.getAttribute("status"))||q.status,q.statusText=i.getAttribute("statusText")||q.statusText;else if(A){var v=w.getElementsByTagName("pre")[0],k=w.getElementsByTagName("body")[0];v?q.responseText=v.textContent?v.textContent:
v.innerText:k&&(q.responseText=k.textContent?k.textContent:k.innerText)}}else"xml"==h&&(!q.responseXML&&q.responseText)&&(q.responseXML=H(q.responseText));try{var e=q,g=l,p=e.getResponseHeader("content-type")||"",n="xml"===h||!h&&0<=p.indexOf("xml"),r=n?e.responseXML:e.responseText;n&&"parsererror"===r.documentElement.nodeName&&a.error&&a.error("parsererror");g&&g.dataFilter&&(r=g.dataFilter(r,h));"string"===typeof r&&("json"===h||!h&&0<=p.indexOf("json")?r=I(r):("script"===h||!h&&0<=p.indexOf("javascript"))&&
a.globalEval(r));E=r}catch(F){b="parsererror",q.error=c=F||b}}catch(C){d("error caught: ",C),b="error",q.error=c=C||b}q.aborted&&(d("upload aborted"),b=null);q.status&&(b=200<=q.status&&300>q.status||304===q.status?"success":"error");"success"===b?(l.success&&l.success.call(l.context,E,"success",q),y.resolve(q.responseText,"success",q),x&&a.event.trigger("ajaxSuccess",[q,l])):b&&(void 0===c&&(c=q.statusText),l.error&&l.error.call(l.context,q,b,c),y.reject(q,"error",c),x&&a.event.trigger("ajaxError",
[q,l,c]));x&&a.event.trigger("ajaxComplete",[q,l]);x&&!--a.active&&a.event.trigger("ajaxStop");l.complete&&l.complete.call(l.context,q,b);D=!0;l.timeout&&clearTimeout(u);setTimeout(function(){l.iframeTarget?m.attr("src",l.iframeSrc):m.remove();q.responseXML=null},100)}}var k=p[0],v,l,x,n,m,s,q,t,u,y=a.Deferred();y.abort=function(a){q.abort(a)};if(e)for(v=0;v<r.length;v++)e=a(r[v]),g?e.prop("disabled",!1):e.removeAttr("disabled");l=a.extend(!0,{},a.ajaxSettings,b);l.context=l.context||l;n="jqFormIO"+
(new Date).getTime();l.iframeTarget?(m=a(l.iframeTarget),(v=m.attr2("name"))?n=v:m.attr2("name",n)):(m=a('<iframe name="'+n+'" src="'+l.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"}));s=m[0];q={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(b){var c="timeout"===b?"timeout":"aborted";d("aborting upload... "+c);this.aborted=1;try{s.contentWindow.document.execCommand&&
s.contentWindow.document.execCommand("Stop")}catch(e){}m.attr("src",l.iframeSrc);q.error=c;l.error&&l.error.call(l.context,q,c,b);x&&a.event.trigger("ajaxError",[q,l,c]);l.complete&&l.complete.call(l.context,q,c)}};(x=l.global)&&0===a.active++&&a.event.trigger("ajaxStart");x&&a.event.trigger("ajaxSend",[q,l]);if(l.beforeSend&&!1===l.beforeSend.call(l.context,q,l))return l.global&&a.active--,y.reject(),y;if(q.aborted)return y.reject(),y;if(e=k.clk)if((v=e.name)&&!e.disabled)l.extraData=l.extraData||
{},l.extraData[v]=e.value,"image"==e.type&&(l.extraData[v+".x"]=k.clk_x,l.extraData[v+".y"]=k.clk_y);var B=1,z=2,e=a("meta[name=csrf-token]").attr("content");if((v=a("meta[name=csrf-param]").attr("content"))&&e)l.extraData=l.extraData||{},l.extraData[v]=e;l.forceSync?A():setTimeout(A,10);var E,w,G=50,D,H=a.parseXML||function(a,b){window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&
"parsererror"!=b.documentElement.nodeName?b:null},I=a.parseJSON||function(a){return window.eval("("+a+")")};return y}if(!this.length)return d("ajaxSubmit: skipping submit process - no element selected"),this;var i,k,p=this;"function"==typeof b?b={success:b}:void 0===b&&(b={});i=b.type||this.attr2("method");k=b.url||this.attr2("action");(k=(k="string"===typeof k?a.trim(k):"")||window.location.href||"")&&(k=(k.match(/^([^#]+)/)||[])[1]);b=a.extend(!0,{url:k,success:a.ajaxSettings.success,type:i||a.ajaxSettings.type,
iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},b);k={};this.trigger("form-pre-serialize",[this,b,k]);if(k.veto)return d("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&!1===b.beforeSerialize(this,b))return d("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var n=b.traditional;void 0===n&&(n=a.ajaxSettings.traditional);var r=[],m,t=this.formToArray(b.semantic,r);b.data&&(b.extraData=b.data,m=a.param(b.data,
n));if(b.beforeSubmit&&!1===b.beforeSubmit(t,this,b))return d("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[t,this,b,k]);if(k.veto)return d("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;k=a.param(t,n);m&&(k=k?k+"&"+m:m);"GET"==b.type.toUpperCase()?(b.url+=(0<=b.url.indexOf("?")?"&":"?")+k,b.data=null):b.data=k;var s=[];b.resetForm&&s.push(function(){p.resetForm()});b.clearForm&&s.push(function(){p.clearForm(b.includeHidden)});
if(!b.dataType&&b.target){var u=b.success||function(){};s.push(function(c){var d=b.replaceTarget?"replaceWith":"html";a(b.target)[d](c).each(u,arguments)})}else b.success&&s.push(b.success);b.success=function(a,c,d){for(var e=b.context||this,f=0,g=s.length;f<g;f++)s[f].apply(e,[a,c,d||p,p])};if(b.error){var z=b.error;b.error=function(a,c,d){z.apply(b.context||this,[a,c,d,p])}}if(b.complete){var A=b.complete;b.complete=function(a,c){A.apply(b.context||this,[a,c,p])}}m=0<a("input[type=file]:enabled",
this).filter(function(){return""!==a(this).val()}).length;k="multipart/form-data"==p.attr("enctype")||"multipart/form-data"==p.attr("encoding");n=e&&f;d("fileAPI :"+n);var l;if(!1!==b.iframe&&(b.iframe||(m||k)&&!n))b.closeKeepAlive?a.get(b.closeKeepAlive,function(){l=c(t)}):l=c(t);else if((m||k)&&n){var v=new FormData;for(k=0;k<t.length;k++)v.append(t[k].name,t[k].value);if(b.extraData){k=a.param(b.extraData,b.traditional).split("&");n=k.length;m=[];var x,y;for(x=0;x<n;x++)k[x]=k[x].replace(/\+/g,
" "),y=k[x].split("="),m.push([decodeURIComponent(y[0]),decodeURIComponent(y[1])]);for(k=0;k<m.length;k++)m[k]&&v.append(m[k][0],m[k][1])}b.data=null;m=a.extend(!0,{},a.ajaxSettings,b,{contentType:!1,processData:!1,cache:!1,type:i||"POST"});b.uploadProgress&&(m.xhr=function(){var c=a.ajaxSettings.xhr();c.upload&&c.upload.addEventListener("progress",function(a){var c=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(c=Math.ceil(100*(d/e)));b.uploadProgress(a,d,e,c)},!1);return c});m.data=null;
var B=m.beforeSend;m.beforeSend=function(a,c){c.data=b.formData?b.formData:v;B&&B.call(this,a,c)};l=a.ajax(m)}else l=a.ajax(b);p.removeData("jqxhr").data("jqxhr",l);for(m=0;m<r.length;m++)r[m]=null;this.trigger("form-submit-notify",[this,b]);return this};a.fn.ajaxForm=function(e){e=e||{};e.delegation=e.delegation&&a.isFunction(a.fn.on);if(!e.delegation&&0===this.length){var f=this.selector,g=this.context;if(!a.isReady&&f)return d("DOM not ready, queuing ajaxForm"),a(function(){a(f,g).ajaxForm(e)}),
this;d("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)"));return this}return e.delegation?(a(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,c).on("submit.form-plugin",this.selector,e,b).on("click.form-plugin",this.selector,e,c),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,b).bind("click.form-plugin",e,c)};a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};a.fn.formToArray=function(b,
c){var d=[];if(0===this.length)return d;var f=this[0],g=this.attr("id"),n=b?f.getElementsByTagName("*"):f.elements;n&&!/MSIE [678]/.test(navigator.userAgent)&&(n=a(n).get());g&&(g=a(':input[form="'+g+'"]').get(),g.length&&(n=(n||[]).concat(g)));if(!n||!n.length)return d;var r,m,t,s,u;r=0;for(u=n.length;r<u;r++)if(s=n[r],(g=s.name)&&!s.disabled)if(b&&f.clk&&"image"==s.type)f.clk==s&&(d.push({name:g,value:a(s).val(),type:s.type}),d.push({name:g+".x",value:f.clk_x},{name:g+".y",value:f.clk_y}));else if((t=
a.fieldValue(s,!0))&&t.constructor==Array){c&&c.push(s);m=0;for(s=t.length;m<s;m++)d.push({name:g,value:t[m]})}else if(e&&"file"==s.type)if(c&&c.push(s),t=s.files,t.length)for(m=0;m<t.length;m++)d.push({name:g,value:t[m],type:s.type});else d.push({name:g,value:"",type:s.type});else null!==t&&"undefined"!=typeof t&&(c&&c.push(s),d.push({name:g,value:t,type:s.type,required:s.required}));if(!b&&f.clk&&(n=a(f.clk),r=n[0],(g=r.name)&&!r.disabled&&"image"==r.type))d.push({name:g,value:n.val()}),d.push({name:g+
".x",value:f.clk_x},{name:g+".y",value:f.clk_y});return d};a.fn.formSerialize=function(b){return a.param(this.formToArray(b))};a.fn.fieldSerialize=function(b){var c=[];this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;f<g;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,value:e})}});return a.param(c)};a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;d<e;d++){var f=a.fieldValue(this[d],
b);null===f||("undefined"==typeof f||f.constructor==Array&&!f.length)||(f.constructor==Array?a.merge(c,f):c.push(f))}return c};a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();void 0===c&&(c=!0);if(c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&-1==b.selectedIndex))return null;if("select"==f){var g=b.selectedIndex;if(0>g)return null;for(var d=[],f=b.options,r=(e="select-one"==
e)?g+1:f.length,g=e?g:0;g<r;g++){var m=f[g];if(m.selected){var t=m.value;t||(t=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value);if(e)return t;d.push(t)}}return d}return a(b).val()};a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})};a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,
e=this.tagName.toLowerCase();if(c.test(d)||"textarea"==e)this.value="";else if("checkbox"==d||"radio"==d)this.checked=!1;else if("select"==e)this.selectedIndex=-1;else if("file"==d)/MSIE/.test(navigator.userAgent)?a(this).replaceWith(a(this).clone(!0)):a(this).val("");else if(b&&(!0===b&&/hidden/.test(d)||"string"==typeof b&&a(this).is(b)))this.value=""})};a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};
a.fn.enable=function(a){void 0===a&&(a=!0);return this.each(function(){this.disabled=!a})};a.fn.selected=function(b){void 0===b&&(b=!0);return this.each(function(){var c=this.type;"checkbox"==c||"radio"==c?this.checked=b:"option"==this.tagName.toLowerCase()&&(c=a(this).parent("select"),b&&(c[0]&&"select-one"==c[0].type)&&c.find("option").selected(!1),this.selected=b)})};a.fn.ajaxSubmit.debug=!1});(function(a){a.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null},_create:function(){var b=
this;this.element.is("input")?(this.tagList=a("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").andSelf().last();this.tagInput=a('<input type="text" />').addClass("ui-widget-content");this.options.readOnly&&this.tagInput.attr("disabled","disabled");this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex);this.options.placeholderText&&this.tagInput.attr("placeholder",
this.options.placeholderText);this.options.autocomplete.source||(this.options.autocomplete.source=function(b,c){var d=b.term.toLowerCase(),e=a.grep(this.options.availableTags,function(a){return 0===a.toLowerCase().indexOf(d)});this.options.allowDuplicates||(e=this._subtractArray(e,this.assignedTags()));c(e)});this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(){b._showAutocomplete()}),"undefined"===typeof this.options.autocomplete.minLength&&(this.options.autocomplete.minLength=0));
a.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=a.proxy(this.options.autocomplete.source,this));a.isFunction(this.options.tagSource)&&(this.options.tagSource=a.proxy(this.options.tagSource,this));this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(a('<li class="tagit-new"></li>').append(this.tagInput)).click(function(c){var d=a(c.target);d.hasClass("tagit-label")?(d=d.closest(".tagit-choice"),d.hasClass("removed")||b._trigger("onTagClicked",
c,{tag:d,tagLabel:b.tagLabel(d)})):b.tagInput.focus()});var c=!1;if(this.options.singleField)if(this.options.singleFieldNode){var d=a(this.options.singleFieldNode),e=d.val().split(this.options.singleFieldDelimiter);d.val("");a.each(e,function(a,d){b.createTag(d,null,!0);c=!0})}else this.options.singleFieldNode=a('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode);c||this.tagList.children("li").each(function(){a(this).hasClass("tagit-new")||
(b.createTag(a(this).text(),a(this).attr("class"),!0),a(this).remove())});this.tagInput.keydown(function(c){if(c.which==a.ui.keyCode.BACKSPACE&&""===b.tagInput.val()){var d=b._lastTag();!b.options.removeConfirmation||d.hasClass("remove")?b.removeTag(d):b.options.removeConfirmation&&d.addClass("remove ui-state-highlight")}else b.options.removeConfirmation&&b._lastTag().removeClass("remove ui-state-highlight");if(c.which===a.ui.keyCode.COMMA&&!1===c.shiftKey||c.which===a.ui.keyCode.ENTER||c.which==
a.ui.keyCode.TAB&&""!==b.tagInput.val()||c.which==a.ui.keyCode.SPACE&&!0!==b.options.allowSpaces&&('"'!=a.trim(b.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==a.trim(b.tagInput.val()).charAt(0)&&'"'==a.trim(b.tagInput.val()).charAt(a.trim(b.tagInput.val()).length-1)&&0!==a.trim(b.tagInput.val()).length-1))if(c.which===a.ui.keyCode.ENTER&&""===b.tagInput.val()||c.preventDefault(),!b.options.autocomplete.autoFocus||!b.tagInput.data("autocomplete-open"))b.tagInput.autocomplete("close"),b.createTag(b._cleanedInput())}).blur(function(){b.tagInput.data("autocomplete-open")||
b.createTag(b._cleanedInput())});if(this.options.availableTags||this.options.tagSource||this.options.autocomplete.source)d={select:function(a,c){b.createTag(c.item.value);return!1}},a.extend(d,this.options.autocomplete),d.source=this.options.tagSource||d.source,this.tagInput.autocomplete(d).bind("autocompleteopen.tagit",function(){b.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose.tagit",function(){b.tagInput.data("autocomplete-open",!1)}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete")},
destroy:function(){a.Widget.prototype.destroy.call(this);this.element.unbind(".tagit");this.tagList.unbind(".tagit");this.tagInput.removeData("autocomplete-open");this.tagList.removeClass("tagit ui-widget ui-widget-content ui-corner-all tagit-hidden-field");this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){a(this).hasClass("tagit-new")?a(this).remove():(a(this).removeClass("tagit-choice ui-widget-content ui-state-default ui-state-highlight ui-corner-all remove tagit-choice-editable tagit-choice-read-only"),
a(this).text(a(this).children(".tagit-label").text()))}),this.singleFieldNode&&this.singleFieldNode.remove());return this},_cleanedInput:function(){return a.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var b=this,c=[];this.options.singleField?(c=a(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),
""===c[0]&&(c=[])):this._tags().each(function(){c.push(b.tagLabel(this))});return c},_updateSingleTagsField:function(b){a(this.options.singleFieldNode).val(b.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(b,c){for(var d=[],e=0;e<b.length;e++)-1==a.inArray(b[e],c)&&d.push(b[e]);return d},tagLabel:function(b){return this.options.singleField?a(b).find(".tagit-label:first").text():a(b).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search",
"")},_findTagByLabel:function(b){var c=this,d=null;this._tags().each(function(){if(c._formatStr(b)==c._formatStr(c.tagLabel(this)))return d=a(this),!1});return d},_isNew:function(a){return!this._findTagByLabel(a)},_formatStr:function(b){return this.options.caseSensitive?b:a.trim(b.toLowerCase())},_effectExists:function(b){return Boolean(a.effects&&(a.effects[b]||a.effects.effect&&a.effects.effect[b]))},createTag:function(b,c,d){var e=this,b=a.trim(b);this.options.preprocessTag&&(b=this.options.preprocessTag(b));
if(""===b)return!1;if(!this.options.allowDuplicates&&!this._isNew(b))return b=this._findTagByLabel(b),!1!==this._trigger("onTagExists",null,{existingTag:b,duringInitialization:d})&&this._effectExists("highlight")&&b.effect("highlight"),!1;if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:d}),!1;var f=a(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(b),g=a("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(c).append(f);
this.options.readOnly?g.addClass("tagit-choice-read-only"):(g.addClass("tagit-choice-editable"),c=a("<span></span>").addClass("ui-icon ui-icon-close"),c=a('<a><span class="text-icon">\u00d7</span></a>').addClass("tagit-close").append(c).click(function(){e.removeTag(g)}),g.append(c));this.options.singleField||(f=f.html(),g.append('<input type="hidden" value="'+f+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />'));!1!==this._trigger("beforeTagAdded",null,{tag:g,tagLabel:this.tagLabel(g),
duringInitialization:d})&&(this.options.singleField&&(f=this.assignedTags(),f.push(b),this._updateSingleTagsField(f)),this._trigger("onTagAdded",null,g),this.tagInput.val(""),this.tagInput.parent().before(g),this._trigger("afterTagAdded",null,{tag:g,tagLabel:this.tagLabel(g),duringInitialization:d}),this.options.showAutocompleteOnFocus&&!d&&setTimeout(function(){e._showAutocomplete()},0))},removeTag:function(b,c){c="undefined"===typeof c?this.options.animate:c;b=a(b);this._trigger("onTagRemoved",
null,b);if(!1!==this._trigger("beforeTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})){if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(b),d=a.grep(d,function(a){return a!=e});this._updateSingleTagsField(d)}if(c){b.addClass("removed");var d=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],f=this;d.push(function(){b.remove();f._trigger("afterTagRemoved",null,{tag:b,tagLabel:f.tagLabel(b)})});b.fadeOut("fast").hide.apply(b,d).dequeue()}else b.remove(),
this._trigger("afterTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})}},removeTagByLabel:function(a,c){var d=this._findTagByLabel(a);if(!d)throw"No such tag exists with the name '"+a+"'";this.removeTag(d,c)},removeAll:function(){var a=this;this._tags().each(function(c,d){a.removeTag(d,!1)})}})})(jQuery);(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"undefined"!==typeof exports?module.exports=a(require("jquery")):a(jQuery)})(function(a){var b=window.Slick||{},c=0,b=function(b,e){var f,g;this.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:a(b),appendDots:a(b),arrows:!0,asNavFor:null,prevArrow:'<button type="button" data-role="none" class="slick-prev">Previous</button>',nextArrow:'<button type="button" data-role="none" class="slick-next">Next</button>',autoplay:!1,
autoplaySpeed:3E3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(a,b){return'<button type="button" data-role="none">'+(b+1)+"</button>"},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",onBeforeChange:null,onAfterChange:null,onInit:null,onReInit:null,onSetPosition:null,pauseOnHover:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rtl:!1,slide:"div",slidesToShow:1,slidesToScroll:1,speed:500,
swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,variableWidth:!1,vertical:!1,waitForAnimate:!0};this.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,$list:null,touchObject:{},transformsEnabled:!1};a.extend(this,this.initials);this.animProp=
this.animType=this.activeBreakpoint=null;this.breakpoints=[];this.breakpointSettings=[];this.paused=this.cssTransitions=!1;this.respondTo=this.positionProp=null;this.shouldClick=!0;this.$slider=a(b);this.transitionType=this.transformType=this.$slidesCache=null;this.windowWidth=0;this.windowTimer=null;this.options=a.extend({},this.defaults,e);this.currentSlide=this.options.initialSlide;this.originalSettings=this.options;if((f=this.options.responsive||null)&&-1<f.length){this.respondTo=this.options.respondTo||
"window";for(g in f)f.hasOwnProperty(g)&&(this.breakpoints.push(f[g].breakpoint),this.breakpointSettings[f[g].breakpoint]=f[g].settings);this.breakpoints.sort(function(a,b){return b-a})}this.autoPlay=a.proxy(this.autoPlay,this);this.autoPlayClear=a.proxy(this.autoPlayClear,this);this.changeSlide=a.proxy(this.changeSlide,this);this.clickHandler=a.proxy(this.clickHandler,this);this.selectHandler=a.proxy(this.selectHandler,this);this.setPosition=a.proxy(this.setPosition,this);this.swipeHandler=a.proxy(this.swipeHandler,
this);this.dragHandler=a.proxy(this.dragHandler,this);this.keyHandler=a.proxy(this.keyHandler,this);this.autoPlayIterator=a.proxy(this.autoPlayIterator,this);this.instanceUid=c++;this.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/;this.init();this.checkResponsive()};b.prototype.addSlide=function(b,c,f){if("boolean"===typeof c)f=c,c=null;else if(0>c||c>=this.slideCount)return!1;this.unload();"number"===typeof c?0===c&&0===this.$slides.length?a(b).appendTo(this.$slideTrack):f?a(b).insertBefore(this.$slides.eq(c)):
a(b).insertAfter(this.$slides.eq(c)):!0===f?a(b).prependTo(this.$slideTrack):a(b).appendTo(this.$slideTrack);this.$slides=this.$slideTrack.children(this.options.slide);this.$slideTrack.children(this.options.slide).detach();this.$slideTrack.append(this.$slides);this.$slides.each(function(b,c){a(c).attr("index",b)});this.$slidesCache=this.$slides;this.reinit()};b.prototype.animateSlide=function(b,c){var f={},g=this;if(1===g.options.slidesToShow&&!0===g.options.adaptiveHeight&&!1===g.options.vertical){var h=
g.$slides.eq(g.currentSlide).outerHeight(!0);g.$list.animate({height:h},g.options.speed)}!0===g.options.rtl&&!1===g.options.vertical&&(b=-b);!1===g.transformsEnabled?!1===g.options.vertical?g.$slideTrack.animate({left:b},g.options.speed,g.options.easing,c):g.$slideTrack.animate({top:b},g.options.speed,g.options.easing,c):!1===g.cssTransitions?a({animStart:g.currentLeft}).animate({animStart:b},{duration:g.options.speed,easing:g.options.easing,step:function(a){f[g.animType]=!1===g.options.vertical?
"translate("+a+"px, 0px)":"translate(0px,"+a+"px)";g.$slideTrack.css(f)},complete:function(){c&&c.call()}}):(g.applyTransition(),f[g.animType]=!1===g.options.vertical?"translate3d("+b+"px, 0px, 0px)":"translate3d(0px,"+b+"px, 0px)",g.$slideTrack.css(f),c&&setTimeout(function(){g.disableTransition();c.call()},g.options.speed))};b.prototype.asNavFor=function(b){var c=null!=this.options.asNavFor?a(this.options.asNavFor).getSlick():null;null!=c&&c.slideHandler(b,!0)};b.prototype.applyTransition=function(a){var b=
{};b[this.transitionType]=!1===this.options.fade?this.transformType+" "+this.options.speed+"ms "+this.options.cssEase:"opacity "+this.options.speed+"ms "+this.options.cssEase;!1===this.options.fade?this.$slideTrack.css(b):this.$slides.eq(a).css(b)};b.prototype.autoPlay=function(){this.autoPlayTimer&&clearInterval(this.autoPlayTimer);this.slideCount>this.options.slidesToShow&&!0!==this.paused&&(this.autoPlayTimer=setInterval(this.autoPlayIterator,this.options.autoplaySpeed))};b.prototype.autoPlayClear=
function(){this.autoPlayTimer&&clearInterval(this.autoPlayTimer)};b.prototype.autoPlayIterator=function(){!1===this.options.infinite?1===this.direction?(this.currentSlide+1===this.slideCount-1&&(this.direction=0),this.slideHandler(this.currentSlide+this.options.slidesToScroll)):(0===this.currentSlide-1&&(this.direction=1),this.slideHandler(this.currentSlide-this.options.slidesToScroll)):this.slideHandler(this.currentSlide+this.options.slidesToScroll)};b.prototype.buildArrows=function(){!0===this.options.arrows&&
this.slideCount>this.options.slidesToShow&&(this.$prevArrow=a(this.options.prevArrow),this.$nextArrow=a(this.options.nextArrow),this.htmlExpr.test(this.options.prevArrow)&&this.$prevArrow.appendTo(this.options.appendArrows),this.htmlExpr.test(this.options.nextArrow)&&this.$nextArrow.appendTo(this.options.appendArrows),!0!==this.options.infinite&&this.$prevArrow.addClass("slick-disabled"))};b.prototype.buildDots=function(){var b,c;if(!0===this.options.dots&&this.slideCount>this.options.slidesToShow){c=
'<ul class="'+this.options.dotsClass+'">';for(b=0;b<=this.getDotCount();b+=1)c+="<li>"+this.options.customPaging.call(this,this,b)+"</li>";this.$dots=a(c+"</ul>").appendTo(this.options.appendDots);this.$dots.find("li").first().addClass("slick-active")}};b.prototype.buildOut=function(){this.$slides=this.$slider.children(this.options.slide+":not(.slick-cloned)").addClass("slick-slide");this.slideCount=this.$slides.length;this.$slides.each(function(b,c){a(c).attr("index",b)});this.$slidesCache=this.$slides;
this.$slider.addClass("slick-slider");this.$slideTrack=0===this.slideCount?a('<div class="slick-track"/>').appendTo(this.$slider):this.$slides.wrapAll('<div class="slick-track"/>').parent();this.$list=this.$slideTrack.wrap('<div class="slick-list"/>').parent();this.$slideTrack.css("opacity",0);!0===this.options.centerMode&&(this.options.slidesToScroll=1);a("img[data-lazy]",this.$slider).not("[src]").addClass("slick-loading");this.setupInfinite();this.buildArrows();this.buildDots();this.updateDots();
!0===this.options.accessibility&&this.$list.prop("tabIndex",0);this.setSlideClasses("number"===typeof this.currentSlide?this.currentSlide:0);!0===this.options.draggable&&this.$list.addClass("draggable")};b.prototype.checkResponsive=function(){var b,c,f;c=this.$slider.width();var g=window.innerWidth||a(window).width();"window"===this.respondTo?f=g:"slider"===this.respondTo?f=c:"min"===this.respondTo&&(f=Math.min(g,c));if(this.originalSettings.responsive&&-1<this.originalSettings.responsive.length&&
null!==this.originalSettings.responsive){c=null;for(b in this.breakpoints)this.breakpoints.hasOwnProperty(b)&&f<this.breakpoints[b]&&(c=this.breakpoints[b]);null!==c?null!==this.activeBreakpoint?c!==this.activeBreakpoint&&(this.activeBreakpoint=c,this.options=a.extend({},this.originalSettings,this.breakpointSettings[c]),this.refresh()):(this.activeBreakpoint=c,this.options=a.extend({},this.originalSettings,this.breakpointSettings[c]),this.refresh()):null!==this.activeBreakpoint&&(this.activeBreakpoint=
null,this.options=this.originalSettings,this.refresh())}};b.prototype.changeSlide=function(b,c){var f,g,h;a(b.target).is("a")&&b.preventDefault();f=0!==this.slideCount%this.options.slidesToScroll?0:(this.slideCount-this.currentSlide)%this.options.slidesToScroll;switch(b.data.message){case "previous":g=0===f?this.options.slidesToScroll:this.options.slidesToShow-f;this.slideCount>this.options.slidesToShow&&this.slideHandler(this.currentSlide-g,!1,c);break;case "next":g=0===f?this.options.slidesToScroll:
f;this.slideCount>this.options.slidesToShow&&this.slideHandler(this.currentSlide+g,!1,c);break;case "index":var j=0===b.data.index?0:b.data.index||a(b.target).parent().index()*this.options.slidesToScroll;f=this.getNavigableIndexes();h=0;if(f[j]&&f[j]===j)if(j>f[f.length-1])j=f[f.length-1];else for(g in f){if(j<f[g]){j=h;break}h=f[g]}this.slideHandler(j,!1,c)}};b.prototype.clickHandler=function(a){!1===this.shouldClick&&(a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault())};b.prototype.destroy=
function(){this.autoPlayClear();this.touchObject={};a(".slick-cloned",this.$slider).remove();this.$dots&&this.$dots.remove();this.$prevArrow&&"object"!==typeof this.options.prevArrow&&this.$prevArrow.remove();this.$nextArrow&&"object"!==typeof this.options.nextArrow&&this.$nextArrow.remove();this.$slides.parent().hasClass("slick-track")&&this.$slides.unwrap().unwrap();this.$slides.removeClass("slick-slide slick-active slick-center slick-visible").removeAttr("index").css({position:"",left:"",top:"",
zIndex:"",opacity:"",width:""});this.$slider.removeClass("slick-slider");this.$slider.removeClass("slick-initialized");this.$list.off(".slick");a(window).off(".slick-"+this.instanceUid);a(document).off(".slick-"+this.instanceUid)};b.prototype.disableTransition=function(a){var b={};b[this.transitionType]="";!1===this.options.fade?this.$slideTrack.css(b):this.$slides.eq(a).css(b)};b.prototype.fadeSlide=function(a,b,c){var g=this;!1===g.cssTransitions?(g.$slides.eq(b).css({zIndex:1E3}),g.$slides.eq(b).animate({opacity:1},
g.options.speed,g.options.easing,c),g.$slides.eq(a).animate({opacity:0},g.options.speed,g.options.easing)):(g.applyTransition(b),g.applyTransition(a),g.$slides.eq(b).css({opacity:1,zIndex:1E3}),g.$slides.eq(a).css({opacity:0}),c&&setTimeout(function(){g.disableTransition(b);g.disableTransition(a);c.call()},g.options.speed))};b.prototype.filterSlides=function(a){null!==a&&(this.unload(),this.$slideTrack.children(this.options.slide).detach(),this.$slidesCache.filter(a).appendTo(this.$slideTrack),this.reinit())};
b.prototype.getCurrent=function(){return this.currentSlide};b.prototype.getDotCount=function(){var a=0,b=0,c=0;if(!0===this.options.infinite)c=Math.ceil(this.slideCount/this.options.slidesToScroll);else for(;a<this.slideCount;)++c,a=b+this.options.slidesToShow,b+=this.options.slidesToScroll<=this.options.slidesToShow?this.options.slidesToScroll:this.options.slidesToShow;return c-1};b.prototype.getLeft=function(a){var b,c=0;this.slideOffset=0;b=this.$slides.first().outerHeight();!0===this.options.infinite?
(this.slideCount>this.options.slidesToShow&&(this.slideOffset=-1*this.slideWidth*this.options.slidesToShow,c=-1*b*this.options.slidesToShow),0!==this.slideCount%this.options.slidesToScroll&&(a+this.options.slidesToScroll>this.slideCount&&this.slideCount>this.options.slidesToShow)&&(a>this.slideCount?(this.slideOffset=-1*(this.options.slidesToShow-(a-this.slideCount))*this.slideWidth,c=-1*(this.options.slidesToShow-(a-this.slideCount))*b):(this.slideOffset=-1*this.slideCount%this.options.slidesToScroll*
this.slideWidth,c=-1*this.slideCount%this.options.slidesToScroll*b))):a+this.options.slidesToShow>this.slideCount&&(this.slideOffset=(a+this.options.slidesToShow-this.slideCount)*this.slideWidth,c=(a+this.options.slidesToShow-this.slideCount)*b);this.slideCount<=this.options.slidesToShow&&(c=this.slideOffset=0);!0===this.options.centerMode&&!0===this.options.infinite?this.slideOffset+=this.slideWidth*Math.floor(this.options.slidesToShow/2)-this.slideWidth:!0===this.options.centerMode&&(this.slideOffset=
0,this.slideOffset+=this.slideWidth*Math.floor(this.options.slidesToShow/2));b=!1===this.options.vertical?-1*a*this.slideWidth+this.slideOffset:-1*a*b+c;!0===this.options.variableWidth&&(c=this.slideCount<=this.options.slidesToShow||!1===this.options.infinite?this.$slideTrack.children(".slick-slide").eq(a):this.$slideTrack.children(".slick-slide").eq(a+this.options.slidesToShow),b=c[0]?-1*c[0].offsetLeft:0,!0===this.options.centerMode&&(c=!1===this.options.infinite?this.$slideTrack.children(".slick-slide").eq(a):
this.$slideTrack.children(".slick-slide").eq(a+this.options.slidesToShow+1),b=c[0]?-1*c[0].offsetLeft:0,b+=(this.$list.width()-c.outerWidth())/2));return b};b.prototype.getNavigableIndexes=function(){for(var a=0,b=0,c=[];a<this.slideCount;)c.push(a),a=b+this.options.slidesToScroll,b+=this.options.slidesToScroll<=this.options.slidesToShow?this.options.slidesToScroll:this.options.slidesToShow;return c};b.prototype.getSlideCount=function(){var b=this,c;if(!0===b.options.swipeToSlide){var f=null;b.$slideTrack.find(".slick-slide").each(function(c,
e){if(e.offsetLeft+a(e).outerWidth()/2>-1*b.swipeLeft)return f=e,!1});return c=Math.abs(a(f).attr("index")-b.currentSlide)}return b.options.slidesToScroll};b.prototype.init=function(){a(this.$slider).hasClass("slick-initialized")||(a(this.$slider).addClass("slick-initialized"),this.buildOut(),this.setProps(),this.startLoad(),this.loadSlider(),this.initializeEvents(),this.updateArrows(),this.updateDots());null!==this.options.onInit&&this.options.onInit.call(this,this)};b.prototype.initArrowEvents=
function(){!0===this.options.arrows&&this.slideCount>this.options.slidesToShow&&(this.$prevArrow.on("click.slick",{message:"previous"},this.changeSlide),this.$nextArrow.on("click.slick",{message:"next"},this.changeSlide))};b.prototype.initDotEvents=function(){var b=this;if(!0===b.options.dots&&b.slideCount>b.options.slidesToShow)a("li",b.$dots).on("click.slick",{message:"index"},b.changeSlide);if(!0===b.options.dots&&!0===b.options.pauseOnDotsHover&&!0===b.options.autoplay)a("li",b.$dots).on("mouseenter.slick",
function(){b.paused=!0;b.autoPlayClear()}).on("mouseleave.slick",function(){b.paused=!1;b.autoPlay()})};b.prototype.initializeEvents=function(){var b=this;b.initArrowEvents();b.initDotEvents();b.$list.on("touchstart.slick mousedown.slick",{action:"start"},b.swipeHandler);b.$list.on("touchmove.slick mousemove.slick",{action:"move"},b.swipeHandler);b.$list.on("touchend.slick mouseup.slick",{action:"end"},b.swipeHandler);b.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},b.swipeHandler);
b.$list.on("click.slick",b.clickHandler);!0===b.options.pauseOnHover&&!0===b.options.autoplay&&(b.$list.on("mouseenter.slick",function(){b.paused=!0;b.autoPlayClear()}),b.$list.on("mouseleave.slick",function(){b.paused=!1;b.autoPlay()}));if(!0===b.options.accessibility)b.$list.on("keydown.slick",b.keyHandler);if(!0===b.options.focusOnSelect)a(b.options.slide,b.$slideTrack).on("click.slick",b.selectHandler);a(window).on("orientationchange.slick.slick-"+b.instanceUid,function(){b.checkResponsive();
b.setPosition()});a(window).on("resize.slick.slick-"+b.instanceUid,function(){a(window).width()!==b.windowWidth&&(clearTimeout(b.windowDelay),b.windowDelay=window.setTimeout(function(){b.windowWidth=a(window).width();b.checkResponsive();b.setPosition()},50))});a("*[draggable!=true]",b.$slideTrack).on("dragstart",function(a){a.preventDefault()});a(window).on("load.slick.slick-"+b.instanceUid,b.setPosition);a(document).on("ready.slick.slick-"+b.instanceUid,b.setPosition)};b.prototype.initUI=function(){!0===
this.options.arrows&&this.slideCount>this.options.slidesToShow&&(this.$prevArrow.show(),this.$nextArrow.show());!0===this.options.dots&&this.slideCount>this.options.slidesToShow&&this.$dots.show();!0===this.options.autoplay&&this.autoPlay()};b.prototype.keyHandler=function(a){37===a.keyCode&&!0===this.options.accessibility?this.changeSlide({data:{message:"previous"}}):39===a.keyCode&&!0===this.options.accessibility&&this.changeSlide({data:{message:"next"}})};b.prototype.lazyLoad=function(){function b(c){a("img[data-lazy]",
c).each(function(){var b=a(this),c=a(this).attr("data-lazy");b.load(function(){b.animate({opacity:1},200)}).css({opacity:0}).attr("src",c).removeAttr("data-lazy").removeClass("slick-loading")})}var c,f;!0===this.options.centerMode?!0===this.options.infinite?(c=this.currentSlide+(this.options.slidesToShow/2+1),f=c+this.options.slidesToShow+2):(c=Math.max(0,this.currentSlide-(this.options.slidesToShow/2+1)),f=2+(this.options.slidesToShow/2+1)+this.currentSlide):(c=this.options.infinite?this.options.slidesToShow+
this.currentSlide:this.currentSlide,f=c+this.options.slidesToShow,!0===this.options.fade&&(0<c&&c--,f<=this.slideCount&&f++));c=this.$slider.find(".slick-slide").slice(c,f);b(c);this.slideCount<=this.options.slidesToShow?(c=this.$slider.find(".slick-slide"),b(c)):this.currentSlide>=this.slideCount-this.options.slidesToShow?(c=this.$slider.find(".slick-cloned").slice(0,this.options.slidesToShow),b(c)):0===this.currentSlide&&(c=this.$slider.find(".slick-cloned").slice(-1*this.options.slidesToShow),
b(c))};b.prototype.loadSlider=function(){this.setPosition();this.$slideTrack.css({opacity:1});this.$slider.removeClass("slick-loading");this.initUI();"progressive"===this.options.lazyLoad&&this.progressiveLazyLoad()};b.prototype.postSlide=function(a){null!==this.options.onAfterChange&&this.options.onAfterChange.call(this,this,a);this.animating=!1;this.setPosition();this.swipeLeft=null;!0===this.options.autoplay&&!1===this.paused&&this.autoPlay()};b.prototype.progressiveLazyLoad=function(){var b=this,
c;0<a("img[data-lazy]",b.$slider).length&&(c=a("img[data-lazy]",b.$slider).first(),c.attr("src",c.attr("data-lazy")).removeClass("slick-loading").load(function(){c.removeAttr("data-lazy");b.progressiveLazyLoad()}).error(function(){c.removeAttr("data-lazy");b.progressiveLazyLoad()}))};b.prototype.refresh=function(){var b=this.currentSlide;this.destroy();a.extend(this,this.initials);this.init();this.changeSlide({data:{message:"index",index:b}},!0)};b.prototype.reinit=function(){this.$slides=this.$slideTrack.children(this.options.slide).addClass("slick-slide");
this.slideCount=this.$slides.length;this.currentSlide>=this.slideCount&&0!==this.currentSlide&&(this.currentSlide-=this.options.slidesToScroll);this.slideCount<=this.options.slidesToShow&&(this.currentSlide=0);this.setProps();this.setupInfinite();this.buildArrows();this.updateArrows();this.initArrowEvents();this.buildDots();this.updateDots();this.initDotEvents();if(!0===this.options.focusOnSelect)a(this.options.slide,this.$slideTrack).on("click.slick",this.selectHandler);this.setSlideClasses(0);this.setPosition();
null!==this.options.onReInit&&this.options.onReInit.call(this,this)};b.prototype.removeSlide=function(a,b,c){a="boolean"===typeof a?!0===a?0:this.slideCount-1:!0===b?--a:a;if(1>this.slideCount||0>a||a>this.slideCount-1)return!1;this.unload();!0===c?this.$slideTrack.children().remove():this.$slideTrack.children(this.options.slide).eq(a).remove();this.$slides=this.$slideTrack.children(this.options.slide);this.$slideTrack.children(this.options.slide).detach();this.$slideTrack.append(this.$slides);this.$slidesCache=
this.$slides;this.reinit()};b.prototype.setCSS=function(a){var b={},c,g;!0===this.options.rtl&&(a=-a);c="left"==this.positionProp?a+"px":"0px";g="top"==this.positionProp?a+"px":"0px";b[this.positionProp]=a;!1!==this.transformsEnabled&&(b={},b[this.animType]=!1===this.cssTransitions?"translate("+c+", "+g+")":"translate3d("+c+", "+g+", 0px)");this.$slideTrack.css(b)};b.prototype.setDimensions=function(){!1===this.options.vertical?!0===this.options.centerMode&&this.$list.css({padding:"0px "+this.options.centerPadding}):
(this.$list.height(this.$slides.first().outerHeight(!0)*this.options.slidesToShow),!0===this.options.centerMode&&this.$list.css({padding:this.options.centerPadding+" 0px"}));this.listWidth=this.$list.width();this.listHeight=this.$list.height();if(!1===this.options.vertical&&!1===this.options.variableWidth)this.slideWidth=Math.ceil(this.listWidth/this.options.slidesToShow),this.$slideTrack.width(Math.ceil(this.slideWidth*this.$slideTrack.children(".slick-slide").length));else if(!0===this.options.variableWidth){var b=
0;this.slideWidth=Math.ceil(this.listWidth/this.options.slidesToShow);this.$slideTrack.children(".slick-slide").each(function(){b+=Math.ceil(a(this).outerWidth(!0))});this.$slideTrack.width(Math.ceil(b)+1)}else this.slideWidth=Math.ceil(this.listWidth),this.$slideTrack.height(Math.ceil(this.$slides.first().outerHeight(!0)*this.$slideTrack.children(".slick-slide").length));var c=this.$slides.first().outerWidth(!0)-this.$slides.first().width();!1===this.options.variableWidth&&this.$slideTrack.children(".slick-slide").width(this.slideWidth-
c)};b.prototype.setFade=function(){var b=this,c;b.$slides.each(function(f,g){c=-1*b.slideWidth*f;!0===b.options.rtl?a(g).css({position:"relative",right:c,top:0,zIndex:800,opacity:0}):a(g).css({position:"relative",left:c,top:0,zIndex:800,opacity:0})});b.$slides.eq(b.currentSlide).css({zIndex:900,opacity:1})};b.prototype.setHeight=function(){if(1===this.options.slidesToShow&&!0===this.options.adaptiveHeight&&!1===this.options.vertical){var a=this.$slides.eq(this.currentSlide).outerHeight(!0);this.$list.css("height",
a)}};b.prototype.setPosition=function(){this.setDimensions();this.setHeight();!1===this.options.fade?this.setCSS(this.getLeft(this.currentSlide)):this.setFade();null!==this.options.onSetPosition&&this.options.onSetPosition.call(this,this)};b.prototype.setProps=function(){var a=document.body.style;this.positionProp=!0===this.options.vertical?"top":"left";"top"===this.positionProp?this.$slider.addClass("slick-vertical"):this.$slider.removeClass("slick-vertical");if((void 0!==a.WebkitTransition||void 0!==
a.MozTransition||void 0!==a.msTransition)&&!0===this.options.useCSS)this.cssTransitions=!0;void 0!==a.OTransform&&(this.animType="OTransform",this.transformType="-o-transform",this.transitionType="OTransition",void 0===a.perspectiveProperty&&void 0===a.webkitPerspective&&(this.animType=!1));void 0!==a.MozTransform&&(this.animType="MozTransform",this.transformType="-moz-transform",this.transitionType="MozTransition",void 0===a.perspectiveProperty&&void 0===a.MozPerspective&&(this.animType=!1));void 0!==
a.webkitTransform&&(this.animType="webkitTransform",this.transformType="-webkit-transform",this.transitionType="webkitTransition",void 0===a.perspectiveProperty&&void 0===a.webkitPerspective&&(this.animType=!1));void 0!==a.msTransform&&(this.animType="msTransform",this.transformType="-ms-transform",this.transitionType="msTransition",void 0===a.msTransform&&(this.animType=!1));void 0!==a.transform&&!1!==this.animType&&(this.transformType=this.animType="transform",this.transitionType="transition");
this.transformsEnabled=null!==this.animType&&!1!==this.animType};b.prototype.setSlideClasses=function(a){var b,c,g;this.$slider.find(".slick-slide").removeClass("slick-active").removeClass("slick-center");c=this.$slider.find(".slick-slide");!0===this.options.centerMode?(b=Math.floor(this.options.slidesToShow/2),!0===this.options.infinite&&(a>=b&&a<=this.slideCount-1-b?this.$slides.slice(a-b,a+b+1).addClass("slick-active"):(g=this.options.slidesToShow+a,c.slice(g-b+1,g+b+2).addClass("slick-active")),
0===a?c.eq(c.length-1-this.options.slidesToShow).addClass("slick-center"):a===this.slideCount-1&&c.eq(this.options.slidesToShow).addClass("slick-center")),this.$slides.eq(a).addClass("slick-center")):0<=a&&a<=this.slideCount-this.options.slidesToShow?this.$slides.slice(a,a+this.options.slidesToShow).addClass("slick-active"):c.length<=this.options.slidesToShow?c.addClass("slick-active"):(b=this.slideCount%this.options.slidesToShow,g=!0===this.options.infinite?this.options.slidesToShow+a:a,this.options.slidesToShow==
this.options.slidesToScroll&&this.slideCount-a<this.options.slidesToShow?c.slice(g-(this.options.slidesToShow-b),g+b).addClass("slick-active"):c.slice(g,g+this.options.slidesToShow).addClass("slick-active"));"ondemand"===this.options.lazyLoad&&this.lazyLoad()};b.prototype.setupInfinite=function(){var b,c,f;!0===this.options.fade&&(this.options.centerMode=!1);if(!0===this.options.infinite&&!1===this.options.fade&&(c=null,this.slideCount>this.options.slidesToShow)){f=!0===this.options.centerMode?this.options.slidesToShow+
1:this.options.slidesToShow;for(b=this.slideCount;b>this.slideCount-f;b-=1)c=b-1,a(this.$slides[c]).clone(!0).attr("id","").attr("index",c-this.slideCount).prependTo(this.$slideTrack).addClass("slick-cloned");for(b=0;b<f;b+=1)c=b,a(this.$slides[c]).clone(!0).attr("id","").attr("index",c+this.slideCount).appendTo(this.$slideTrack).addClass("slick-cloned");this.$slideTrack.find(".slick-cloned").find("[id]").each(function(){a(this).attr("id","")})}};b.prototype.selectHandler=function(b){(b=parseInt(a(b.target).parents(".slick-slide").attr("index")))||
(b=0);this.slideCount<=this.options.slidesToShow?(this.$slider.find(".slick-slide").removeClass("slick-active"),this.$slides.eq(b).addClass("slick-active"),!0===this.options.centerMode&&(this.$slider.find(".slick-slide").removeClass("slick-center"),this.$slides.eq(b).addClass("slick-center")),this.asNavFor(b)):this.slideHandler(b)};b.prototype.slideHandler=function(a,b,c){var g,h,j=null,i=this;!(!0===i.animating&&!0===i.options.waitForAnimate)&&(!(!0===i.options.fade&&i.currentSlide===a)&&!(i.slideCount<=
i.options.slidesToShow))&&(!1===(b||!1)&&i.asNavFor(a),g=a,j=i.getLeft(g),b=i.getLeft(i.currentSlide),i.currentLeft=null===i.swipeLeft?b:i.swipeLeft,!1===i.options.infinite&&!1===i.options.centerMode&&(0>a||a>i.getDotCount()*i.options.slidesToScroll)?!1===i.options.fade&&(g=i.currentSlide,!0!==c?i.animateSlide(b,function(){i.postSlide(g)}):i.postSlide(g)):!1===i.options.infinite&&!0===i.options.centerMode&&(0>a||a>i.slideCount-i.options.slidesToScroll)?!1===i.options.fade&&(g=i.currentSlide,!0!==
c?i.animateSlide(b,function(){i.postSlide(g)}):i.postSlide(g)):(!0===i.options.autoplay&&clearInterval(i.autoPlayTimer),h=0>g?0!==i.slideCount%i.options.slidesToScroll?i.slideCount-i.slideCount%i.options.slidesToScroll:i.slideCount+g:g>=i.slideCount?0!==i.slideCount%i.options.slidesToScroll?0:g-i.slideCount:g,i.animating=!0,null!==i.options.onBeforeChange&&a!==i.currentSlide&&i.options.onBeforeChange.call(this,i,i.currentSlide,h),a=i.currentSlide,i.currentSlide=h,i.setSlideClasses(i.currentSlide),
i.updateDots(),i.updateArrows(),!0===i.options.fade?!0!==c?i.fadeSlide(a,h,function(){i.postSlide(h)}):i.postSlide(h):!0!==c?i.animateSlide(j,function(){i.postSlide(h)}):i.postSlide(h)))};b.prototype.startLoad=function(){!0===this.options.arrows&&this.slideCount>this.options.slidesToShow&&(this.$prevArrow.hide(),this.$nextArrow.hide());!0===this.options.dots&&this.slideCount>this.options.slidesToShow&&this.$dots.hide();this.$slider.addClass("slick-loading")};b.prototype.swipeDirection=function(){var a;
a=Math.atan2(this.touchObject.startY-this.touchObject.curY,this.touchObject.startX-this.touchObject.curX);a=Math.round(180*a/Math.PI);0>a&&(a=360-Math.abs(a));return 45>=a&&0<=a||360>=a&&315<=a?!1===this.options.rtl?"left":"right":135<=a&&225>=a?!1===this.options.rtl?"right":"left":"vertical"};b.prototype.swipeEnd=function(){this.dragging=!1;this.shouldClick=10<this.touchObject.swipeLength?!1:!0;if(void 0===this.touchObject.curX)return!1;if(this.touchObject.swipeLength>=this.touchObject.minSwipe)switch(this.swipeDirection()){case "left":this.slideHandler(this.currentSlide+
this.getSlideCount());this.currentDirection=0;this.touchObject={};break;case "right":this.slideHandler(this.currentSlide-this.getSlideCount()),this.currentDirection=1,this.touchObject={}}else this.touchObject.startX!==this.touchObject.curX&&(this.slideHandler(this.currentSlide),this.touchObject={})};b.prototype.swipeHandler=function(a){if(!(!1===this.options.swipe||"ontouchend"in document&&!1===this.options.swipe)&&!(!1===this.options.draggable&&-1!==a.type.indexOf("mouse")))switch(this.touchObject.fingerCount=
a.originalEvent&&void 0!==a.originalEvent.touches?a.originalEvent.touches.length:1,this.touchObject.minSwipe=this.listWidth/this.options.touchThreshold,a.data.action){case "start":this.swipeStart(a);break;case "move":this.swipeMove(a);break;case "end":this.swipeEnd(a)}};b.prototype.swipeMove=function(a){var b,c;c=void 0!==a.originalEvent?a.originalEvent.touches:null;if(!this.dragging||c&&1!==c.length)return!1;b=this.getLeft(this.currentSlide);this.touchObject.curX=void 0!==c?c[0].pageX:a.clientX;
this.touchObject.curY=void 0!==c?c[0].pageY:a.clientY;this.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(this.touchObject.curX-this.touchObject.startX,2)));if("vertical"!==this.swipeDirection()){void 0!==a.originalEvent&&4<this.touchObject.swipeLength&&a.preventDefault();a=(!1===this.options.rtl?1:-1)*(this.touchObject.curX>this.touchObject.startX?1:-1);this.swipeLeft=!1===this.options.vertical?b+this.touchObject.swipeLength*a:b+this.touchObject.swipeLength*(this.$list.height()/this.listWidth)*
a;if(!0===this.options.fade||!1===this.options.touchMove)return!1;if(!0===this.animating)return this.swipeLeft=null,!1;this.setCSS(this.swipeLeft)}};b.prototype.swipeStart=function(a){var b;if(1!==this.touchObject.fingerCount||this.slideCount<=this.options.slidesToShow)return this.touchObject={},!1;void 0!==a.originalEvent&&void 0!==a.originalEvent.touches&&(b=a.originalEvent.touches[0]);this.touchObject.startX=this.touchObject.curX=void 0!==b?b.pageX:a.clientX;this.touchObject.startY=this.touchObject.curY=
void 0!==b?b.pageY:a.clientY;this.dragging=!0};b.prototype.unfilterSlides=function(){null!==this.$slidesCache&&(this.unload(),this.$slideTrack.children(this.options.slide).detach(),this.$slidesCache.appendTo(this.$slideTrack),this.reinit())};b.prototype.unload=function(){a(".slick-cloned",this.$slider).remove();this.$dots&&this.$dots.remove();this.$prevArrow&&"object"!==typeof this.options.prevArrow&&this.$prevArrow.remove();this.$nextArrow&&"object"!==typeof this.options.nextArrow&&this.$nextArrow.remove();
this.$slides.removeClass("slick-slide slick-active slick-visible").css("width","")};b.prototype.updateArrows=function(){var a;a=Math.floor(this.options.slidesToShow/2);!0===this.options.arrows&&(!0!==this.options.infinite&&this.slideCount>this.options.slidesToShow)&&(this.$prevArrow.removeClass("slick-disabled"),this.$nextArrow.removeClass("slick-disabled"),0===this.currentSlide?(this.$prevArrow.addClass("slick-disabled"),this.$nextArrow.removeClass("slick-disabled")):this.currentSlide>=this.slideCount-
this.options.slidesToShow&&!1===this.options.centerMode?(this.$nextArrow.addClass("slick-disabled"),this.$prevArrow.removeClass("slick-disabled")):this.currentSlide>this.slideCount-this.options.slidesToShow+a&&!0===this.options.centerMode&&(this.$nextArrow.addClass("slick-disabled"),this.$prevArrow.removeClass("slick-disabled")))};b.prototype.updateDots=function(){null!==this.$dots&&(this.$dots.find("li").removeClass("slick-active"),this.$dots.find("li").eq(Math.floor(this.currentSlide/this.options.slidesToScroll)).addClass("slick-active"))};
a.fn.slick=function(a){return this.each(function(c,f){f.slick=new b(f,a)})};a.fn.slickAdd=function(a,b,c){return this.each(function(g,h){h.slick.addSlide(a,b,c)})};a.fn.slickCurrentSlide=function(){return this.get(0).slick.getCurrent()};a.fn.slickFilter=function(a){return this.each(function(b,c){c.slick.filterSlides(a)})};a.fn.slickGoTo=function(a,b){return this.each(function(c,g){g.slick.changeSlide({data:{message:"index",index:parseInt(a)}},b)})};a.fn.slickNext=function(){return this.each(function(a,
b){b.slick.changeSlide({data:{message:"next"}})})};a.fn.slickPause=function(){return this.each(function(a,b){b.slick.autoPlayClear();b.slick.paused=!0})};a.fn.slickPlay=function(){return this.each(function(a,b){b.slick.paused=!1;b.slick.autoPlay()})};a.fn.slickPrev=function(){return this.each(function(a,b){b.slick.changeSlide({data:{message:"previous"}})})};a.fn.slickRemove=function(a,b){return this.each(function(c,g){g.slick.removeSlide(a,b)})};a.fn.slickRemoveAll=function(){return this.each(function(a,
b){b.slick.removeSlide(null,null,!0)})};a.fn.slickGetOption=function(a){return this.get(0).slick.options[a]};a.fn.slickSetOption=function(a,b,c){return this.each(function(g,h){h.slick.options[a]=b;!0===c&&(h.slick.unload(),h.slick.reinit())})};a.fn.slickUnfilter=function(){return this.each(function(a,b){b.slick.unfilterSlides()})};a.fn.unslick=function(){return this.each(function(a,b){b.slick&&b.slick.destroy()})};a.fn.getSlick=function(){var a=null;this.each(function(b,c){a=c.slick});return a}});jQuery.fn.sortElements=function(){var a=[].sort;return function(b,c){var c=c||function(){return this},d=this.map(function(){var a=c.call(this),b=a.parentNode,d=b.insertBefore(document.createTextNode(""),a.nextSibling);return function(){if(b===this)throw Error("You can't sort elements if any one is a descendant of another.");b.insertBefore(this,d);b.removeChild(d)}});return a.call(this,b).each(function(a){d[a].call(c.call(this))})}}();(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a){return e.raw?a:encodeURIComponent(a)}function c(b,c){var h;if(e.raw)h=b;else a:{var j=b;0===j.indexOf('"')&&(j=j.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{j=decodeURIComponent(j.replace(d," "))}catch(i){h=void 0;break a}try{h=e.json?JSON.parse(j):j;break a}catch(k){}h=void 0}return a.isFunction(c)?c(h):h}var d=/\+/g,e=a.cookie=function(d,g,h){if(void 0!==g&&!a.isFunction(g)){h=
a.extend({},e.defaults,h);if("number"===typeof h.expires){var j=h.expires,i=h.expires=new Date;i.setDate(i.getDate()+j)}return document.cookie=[b(d),"=",b(e.json?JSON.stringify(g):String(g)),h.expires?"; expires="+h.expires.toUTCString():"",h.path?"; path="+h.path:"",h.domain?"; domain="+h.domain:"",h.secure?"; secure":""].join("")}for(var h=d?void 0:{},j=document.cookie?document.cookie.split("; "):[],i=0,k=j.length;i<k;i++){var p=j[i].split("="),n;n=p.shift();n=e.raw?n:decodeURIComponent(n);p=p.join("=");
if(d&&d===n){h=c(p,g);break}if(!d&&void 0!==(p=c(p)))h[n]=p}return h};e.defaults={};a.removeCookie=function(b,c){return void 0!==a.cookie(b)?(a.cookie(b,"",a.extend({},c,{expires:-1})),!0):!1}});(function(a){a.fn.equalizeElementHeights=function(){var b=this.map(function(b,d){return a(d).height()}).get();return this.height(Math.max.apply(this,b))}})(jQuery);(function(a){a.fn.jLabel=function(b){function c(b){this.equals=function(a){return a.attr("id")==this.input.attr("id")};this.input=b;var c=a("label[for="+b.attr("id")+"]");0==c.size()&&(c=a("<label>").attr("for",b.attr("id")).text(b.attr("title")));b.before(c);c.css({"font-family":b.css("font-family"),"font-size":b.css("font-size"),"font-style":b.css("font-style"),"font-variant":b.css("font-variant"),"font-weight":b.css("font-weight"),"letter-spacing":b.css("letter-spacing"),"line-height":b.css("line-height"),
"text-decoration":b.css("text-decoration"),"text-transform":b.css("text-transform"),color:b.css("color"),cursor:b.css("cursor"),width:b.css("width"),display:"inline-block",overflow:"hidden"});c.mousedown(function(){return!1}).css({position:"relative","z-index":"100","margin-right":-c.width(),left:g.xShift+parseInt(b.css("padding-left"))+"px",top:g.yShift+"px"});this.label=c;""!=this.input.val()&&this.label.hide()}function d(b){var c;a.each(f,function(){if(this.equals(b))return c=this,!1});return c}
function e(a){var b=d(a).label;""==a.val()?b.stop().fadeTo(g.speed,g.opacity):b.is(":visible")&&b.stop().fadeTo(g.speed,0,function(){b.hide()})}var f=[],g=a.extend({},a.fn.jLabel.defaults,b);return this.each(function(){var b=a(this);f.push(new c(b));b.focus(function(){var b=a(this);""==b.val()&&d(b).label.stop().fadeTo(g.speed,g.opacity)}).blur(function(){var b=a(this);""==b.val()&&d(b).label.stop().fadeTo(g.speed,1)}).keyup(function(){e(a(this))}).change(function(){e(a(this))})})};a.fn.jLabel.defaults=
{speed:200,opacity:0.4,xShift:2,yShift:0}})(jQuery);jQuery&&function(a){a.extend(a.fn,{selectBox:function(b,c){var d,e="",f=navigator.platform.match(/mac/i),g=function(b,c){var d,e=function(b,c){b.children("OPTION, OPTGROUP").each(function(){if(a(this).is("OPTION"))if(0<a(this).length){var b=a(this),d=c,f=a("<li />"),g=a("<a />");f.addClass(b.attr("class"));f.data(b.data());g.attr("rel",b.val()).text(b.text());f.append(g);b.attr("disabled")&&f.addClass("selectBox-disabled");b.attr("selected")&&f.addClass("selectBox-selected");d.append(f)}else c.append("<li>\u00a0</li>");
else b=a('<li class="selectBox-optgroup" />'),b.text(a(this).attr("label")),c.append(b),c=e(a(this),c)});return c};switch(c){case "inline":return d=a('<ul class="selectBox-options" />'),d=e(b,d),d.find("A").bind("mouseover.selectBox",function(){r(b,a(this).parent())}).bind("mouseout.selectBox",function(){m(b,a(this).parent())}).bind("mousedown.selectBox",function(a){a.preventDefault();b.selectBox("control").hasClass("selectBox-active")||b.selectBox("control").focus()}).bind("mouseup.selectBox",function(c){p();
n(b,a(this).parent(),c)}),z(d),d;case "dropdown":d=a('<ul class="selectBox-dropdown-menu selectBox-options" />');d=e(b,d);d.data("selectBox-select",b).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(a){a.preventDefault();a.screenX===d.data("selectBox-down-at-x")&&a.screenY===d.data("selectBox-down-at-y")&&(d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),p())}).bind("mouseup.selectBox",function(c){c.screenX===d.data("selectBox-down-at-x")&&
c.screenY===d.data("selectBox-down-at-y")||(d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),n(b,a(this).parent()),p())}).bind("mouseover.selectBox",function(){r(b,a(this).parent())}).bind("mouseout.selectBox",function(){m(b,a(this).parent())});var f=b.attr("class")||"";if(""!==f){var f=f.split(" "),g;for(g in f)d.addClass(f[g]+"-selectBox-dropdown-menu")}z(d);return d}},h=function(b){return("selectBox-label "+(a(b).find("OPTION:selected").attr("class")||"")).replace(/\s+$/,"")},
j=function(b){return a(b).find("OPTION:selected").text()||"\u00a0"},i=function(b){var b=a(b),c=b.data("selectBox-control");c&&c.find(".selectBox-label").attr("class",h(b)).text(j(b))},k=function(b){var b=a(b),c=b.data("selectBox-control"),d=b.data("selectBox-settings"),e=c.data("selectBox-options");if(c.hasClass("selectBox-disabled"))return!1;p();var f=isNaN(c.css("borderBottomWidth"))?0:parseInt(c.css("borderBottomWidth"));e.width(c.innerWidth()).css({top:c.offset().top+c.outerHeight()-f,left:c.offset().left});
if(b.triggerHandler("beforeopen"))return!1;f=function(){b.triggerHandler("open",{_selectBox:!0})};switch(d.menuTransition){case "fade":e.fadeIn(d.menuSpeed,f);break;case "slide":e.slideDown(d.menuSpeed,f);break;default:e.show(d.menuSpeed,f)}d.menuSpeed||f();d=e.find(".selectBox-selected:first");t(b,d,!0);r(b,d);c.addClass("selectBox-menuShowing");a(document).bind("mousedown.selectBox",function(b){a(b.target).parents().andSelf().hasClass("selectBox-options")||p()})},p=function(){0!==a(".selectBox-dropdown-menu:visible").length&&
(a(document).unbind("mousedown.selectBox"),a(".selectBox-dropdown-menu").each(function(){var b=a(this),c=b.data("selectBox-select"),d=c.data("selectBox-control"),e=c.data("selectBox-settings");if(c.triggerHandler("beforeclose"))return!1;var f=function(){c.triggerHandler("close",{_selectBox:!0})};if(e){switch(e.menuTransition){case "fade":b.fadeOut(e.menuSpeed,f);break;case "slide":b.slideUp(e.menuSpeed,f);break;default:b.hide(e.menuSpeed,f)}e.menuSpeed||f();d.removeClass("selectBox-menuShowing")}else a(this).hide(),
a(this).triggerHandler("close",{_selectBox:!0}),a(this).removeClass("selectBox-menuShowing")}))},n=function(b,c,d){var b=a(b),c=a(c),e=b.data("selectBox-control");b.data("selectBox-settings");if(e.hasClass("selectBox-disabled")||0===c.length||c.hasClass("selectBox-disabled"))return!1;b.attr("multiple")?d.shiftKey&&e.data("selectBox-last-selected")?(c.toggleClass("selectBox-selected"),d=c.index()>e.data("selectBox-last-selected").index()?c.siblings().slice(e.data("selectBox-last-selected").index(),
c.index()):c.siblings().slice(c.index(),e.data("selectBox-last-selected").index()),d=d.not(".selectBox-optgroup, .selectBox-disabled"),c.hasClass("selectBox-selected")?d.addClass("selectBox-selected"):d.removeClass("selectBox-selected")):f&&d.metaKey||!f&&d.ctrlKey?c.toggleClass("selectBox-selected"):(c.siblings().removeClass("selectBox-selected"),c.addClass("selectBox-selected")):(c.siblings().removeClass("selectBox-selected"),c.addClass("selectBox-selected"));e.hasClass("selectBox-dropdown")&&e.find(".selectBox-label").text(c.text());
var g=0,h=[];b.attr("multiple")?e.find(".selectBox-selected A").each(function(){h[g++]=a(this).attr("rel")}):h=c.find("A").attr("rel");e.data("selectBox-last-selected",c);b.val()!==h&&(b.val(h),i(b),b.trigger("change"));return!0},r=function(b,c){b=a(b);c=a(c);b.data("selectBox-control").data("selectBox-options").find(".selectBox-hover").removeClass("selectBox-hover");c.addClass("selectBox-hover")},m=function(b,c){b=a(b);a(c);b.data("selectBox-control").data("selectBox-options").find(".selectBox-hover").removeClass("selectBox-hover")},
t=function(b,c,d){if(c&&0!==c.length){var b=a(b),b=b.data("selectBox-control"),e=b.data("selectBox-options"),b=b.hasClass("selectBox-dropdown")?e:e.parent(),e=parseInt(c.offset().top-b.position().top),f=parseInt(e+c.outerHeight());d?b.scrollTop(c.offset().top-b.offset().top+b.scrollTop()-b.height()/2):(0>e&&b.scrollTop(c.offset().top-b.offset().top+b.scrollTop()),f>b.height()&&b.scrollTop(c.offset().top+c.outerHeight()-b.offset().top+b.scrollTop()-b.height()))}},s=function(b,c){var b=a(b),d=b.data("selectBox-control"),
f=d.data("selectBox-options"),g=b.data("selectBox-settings"),i=0,h=0;if(!d.hasClass("selectBox-disabled"))switch(c.keyCode){case 8:c.preventDefault();e="";break;case 9:case 27:p();m(b);break;case 13:d.hasClass("selectBox-menuShowing")?(n(b,f.find("LI.selectBox-hover:first"),c),d.hasClass("selectBox-dropdown")&&p()):k(b);break;case 38:case 37:c.preventDefault();if(d.hasClass("selectBox-menuShowing")){d=f.find(".selectBox-hover").prev("LI");i=f.find("LI:not(.selectBox-optgroup)").length;for(h=0;(0===
d.length||d.hasClass("selectBox-disabled")||d.hasClass("selectBox-optgroup"))&&!(d=d.prev("LI"),0===d.length&&(d=g.loopOptions?f.find("LI:last"):f.find("LI:first")),++h>=i););r(b,d);n(b,d,c);t(b,d)}else k(b);break;case 40:case 39:if(c.preventDefault(),d.hasClass("selectBox-menuShowing")){d=f.find(".selectBox-hover").next("LI");i=f.find("LI:not(.selectBox-optgroup)").length;for(h=0;(0===d.length||d.hasClass("selectBox-disabled")||d.hasClass("selectBox-optgroup"))&&!(d=d.next("LI"),0===d.length&&(d=
g.loopOptions?f.find("LI:first"):f.find("LI:last")),++h>=i););r(b,d);n(b,d,c);t(b,d)}else k(b)}},u=function(b,c){var b=a(b),f=b.data("selectBox-control"),g=f.data("selectBox-options");if(!f.hasClass("selectBox-disabled"))switch(c.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:f.hasClass("selectBox-menuShowing")||k(b),c.preventDefault(),clearTimeout(d),e+=String.fromCharCode(c.charCode||c.keyCode),g.find("A").each(function(){if(a(this).text().substr(0,e.length).toLowerCase()===
e.toLowerCase())return r(b,a(this).parent()),t(b,a(this).parent()),!1}),d=setTimeout(function(){e=""},1E3)}},z=function(b){a(b).css("MozUserSelect","none").bind("selectstart",function(a){a.preventDefault()})};switch(b){case "control":return a(this).data("selectBox-control");case "settings":if(!c)return a(this).data("selectBox-settings");a(this).each(function(){a(this).data("selectBox-settings",a.extend(!0,a(this).data("selectBox-settings"),c))});break;case "options":if(void 0===c)return a(this).data("selectBox-control").data("selectBox-options");
a(this).each(function(){var b,d=c;b=a(this);var e=b.data("selectBox-control");b.data("selectBox-settings");switch(typeof c){case "string":b.html(c);break;case "object":b.html("");for(var f in c)if(null!==c[f]){if("object"===typeof c[f]){var d=a('<optgroup label="'+f+'" />'),h;for(h in c[f])d.append('<option value="'+h+'">'+c[f][h]+"</option>")}else d=a('<option value="'+f+'">'+c[f]+"</option>");b.append(d)}}if(e)switch(e.data("selectBox-options").remove(),f=e.hasClass("selectBox-dropdown")?"dropdown":
"inline",d=g(b,f),e.data("selectBox-options",d),f){case "inline":e.append(d);break;case "dropdown":i(b),a("BODY").append(d)}});break;case "value":if(void 0===c)return a(this).val();a(this).each(function(){var b,d=c;b=a(this);b.val(d);d=b.val();null===d&&(d=b.children().first().val(),b.val(d));var e=b.data("selectBox-control");if(e){var f=b.data("selectBox-settings"),e=e.data("selectBox-options");i(b);e.find(".selectBox-selected").removeClass("selectBox-selected");e.find("A").each(function(){if("object"===
typeof d)for(var b=0;b<d.length;b++)a(this).attr("rel")==d[b]&&a(this).parent().addClass("selectBox-selected");else a(this).attr("rel")==d&&a(this).parent().addClass("selectBox-selected")});f.change&&f.change.call(b)}});break;case "refresh":a(this).each(function(){var b;b=a(this);b.selectBox("options",b.html())});break;case "enable":a(this).each(function(){var b;b=a(this);b.attr("disabled",!1);(b=b.data("selectBox-control"))&&b.removeClass("selectBox-disabled")});break;case "disable":a(this).each(function(){var b;
b=a(this);b.attr("disabled",!0);(b=b.data("selectBox-control"))&&b.addClass("selectBox-disabled")});break;case "destroy":a(this).each(function(){var b;b=a(this);var c=b.data("selectBox-control");c&&(c.data("selectBox-options").remove(),c.remove(),b.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show())});break;default:a(this).each(function(){var c=this,d;if(!navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)&&
"select"===c.tagName.toLowerCase()&&(c=a(c),!c.data("selectBox-control"))){var e=a('<a class="selectBox" />'),f=c.attr("multiple")||1<parseInt(c.attr("size")),i=b||{};e.width(c.outerWidth()).addClass(c.attr("class")).attr("title",c.attr("title")||"").attr("tabindex",parseInt(c.attr("tabindex"))).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&a(document.activeElement).blur();e.hasClass("selectBox-active")||(e.addClass("selectBox-active"),
c.trigger("focus"))}).bind("blur.selectBox",function(){e.hasClass("selectBox-active")&&(e.removeClass("selectBox-active"),c.trigger("blur"))});a(window).data("selectBox-bindings")||a(window).data("selectBox-bindings",!0).bind("scroll.selectBox",p).bind("resize.selectBox",p);c.attr("disabled")&&e.addClass("selectBox-disabled");c.bind("click.selectBox",function(a){e.focus();a.preventDefault()});if(f){if(d=g(c,"inline"),e.append(d).data("selectBox-options",d).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",
function(a){s(c,a)}).bind("keypress.selectBox",function(a){u(c,a)}).bind("mousedown.selectBox",function(b){a(b.target).is("A.selectBox-inline")&&b.preventDefault();e.hasClass("selectBox-focus")||e.focus()}).insertAfter(c),!c[0].style.height){var f=c.attr("size")?parseInt(c.attr("size")):5,n=e.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");n.find(".selectBox-options").html("<li><a>\u00a0</a></li>");var m=parseInt(n.find(".selectBox-options A:first").html("&nbsp;").outerHeight());
n.remove();e.height(m*f)}}else f=a('<span class="selectBox-label" />'),n=a('<span class="selectBox-arrow" />'),f.attr("class",h(c)).text(j(c)),d=g(c,"dropdown"),d.appendTo("BODY"),e.data("selectBox-options",d).addClass("selectBox-dropdown").append(f).append(n).bind("mousedown.selectBox",function(a){e.hasClass("selectBox-menuShowing")?p():(a.stopPropagation(),d.data("selectBox-down-at-x",a.screenX).data("selectBox-down-at-y",a.screenY),k(c))}).bind("keydown.selectBox",function(a){s(c,a)}).bind("keypress.selectBox",
function(a){u(c,a)}).bind("open.selectBox",function(a,b){b&&!0===b._selectBox||k(c)}).bind("close.selectBox",function(a,b){b&&!0===b._selectBox||p()}).insertAfter(c),n=e.width()-n.outerWidth()-parseInt(f.css("paddingLeft"))-parseInt(f.css("paddingLeft")),f.width(n);z(e);c.addClass("selectBox").data("selectBox-control",e).data("selectBox-settings",i).hide()}})}return a(this)}})}(jQuery);var JSON;JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function b(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var e,h,r,m,t=f,s,u=d[a];u&&("object"===typeof u&&"function"===typeof u.toJSON)&&(u=u.toJSON(a));"function"===typeof j&&(u=j.call(d,a,u));switch(typeof u){case "string":return b(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);case "object":if(!u)return"null";
f+=g;s=[];if("[object Array]"===Object.prototype.toString.apply(u)){m=u.length;for(e=0;e<m;e+=1)s[e]=c(e,u)||"null";r=0===s.length?"[]":f?"[\n"+f+s.join(",\n"+f)+"\n"+t+"]":"["+s.join(",")+"]";f=t;return r}if(j&&"object"===typeof j){m=j.length;for(e=0;e<m;e+=1)"string"===typeof j[e]&&(h=j[e],(r=c(h,u))&&s.push(b(h)+(f?": ":":")+r))}else for(h in u)Object.prototype.hasOwnProperty.call(u,h)&&(r=c(h,u))&&s.push(b(h)+(f?": ":":")+r);r=0===s.length?"{}":f?"{\n"+f+s.join(",\n"+f)+"\n"+t+"}":"{"+s.join(",")+
"}";f=t;return r}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,d){var e;g=f="";if("number"===typeof d)for(e=0;e<d;e+=1)g+=" ";else"string"===typeof d&&(g=d);if((j=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var e,f,g=a[d];if(g&&"object"===typeof g)for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(f=c(g,e),void 0!==f?g[e]=f:delete g[e]);return b.call(a,d,g)}var e,a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof b?c({"":e},""):e;throw new SyntaxError("JSON.parse");})})();function confirmAction(a,b){return confirm(b)?(a&&(document.location.href=a),!0):!1}function openHelp(a){window.open(a,"Help","width=700,height=600,screenX=100,screenY=100,toolbar=0,scrollbars=1")}function openComments(a){window.open(a,"Comments","width=700,height=600,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}function openWindow(a){window.open(a,"Window","width=600,height=550,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}
function openRTWindow(a){window.open(a,"RT","width=700,height=500,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}function openRTWindowWithToolbar(a){window.open(a,"RT","width=700,height=500,screenX=100,screenY=100,toolbar=1,resizable=1,scrollbars=1")}function getBrowserObject(a,b){var c=0,d;document.getElementById?d=document.getElementById(a):document.all?d=document.all[a]:document.layers&&(d=document.layers[a],c=1);b&&!c&&(d=d.style);return d}
function loadUrl(a){document.location.href=a}function createCookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"}function readCookie(a){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}
function makeAsyncRequest(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function sendAsyncRequest(a,b,c,d){a.open(d,b,!0);a.setRequestHeader("Content-Type","text/html; Charset=utf-8");a.send(c)}function changeFormAction(a,b){document.getElementById(a).action=b;document.getElementById(a).submit()}
function urlEncode(a){return encodeURIComponent(a).replace(/\%20/g,"+").replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/\~/g,"%7E")}function escapeHTML(a){return $("<div/>").text(a).html()}function unescapeHTML(a){return $("<div/>").html(a).text()};(function(a){a.pkp=a.pkp||{};a.pkp.classes=a.pkp.classes||{};a.pkp.controllers=a.pkp.controllers||{};a.pkp.plugins=a.pkp.plugins||{};a.pkp.plugins.blocks=a.pkp.plugins.blocks||{};a.pkp.plugins.generic=a.pkp.plugins.generic||{};a.pkp.plugins.pubIds=a.pkp.plugins.pubIds||{};a.pkp.classes.Helper=function(){throw Error("Trying to instantiate the Helper singleton!");};a.pkp.classes.Helper.CHARS_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");a.pkp.classes.Helper.uuid=function(){var b=
a.pkp.classes.Helper.CHARS_,c=Array(36),d=0,e,f;for(f=0;36>f;f++)8==f||13==f||18==f||23==f?c[f]="-":14==f?c[f]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),e=d&15,d>>=4,c[f]=b[19==f?e&3|8:e]);return c.join("")};a.pkp.classes.Helper.inherits=function(a,c){var d=function(){};d.prototype=c.prototype;a.parent_=c.prototype;a.prototype=new d;a.prototype.constructor=a;c.prototype.constructor==Object.prototype.constructor&&(c.prototype.constructor=c)};a.pkp.classes.Helper.objectFactory=function(b,c){var d,
e;d=a.pkp.classes.Helper.resolveObjectName(b);e=a.pkp.classes.Helper.getObjectProxyInstance();a.extend(!0,e,a.pkp.classes.ObjectProxy);a.pkp.classes.Helper.inherits(e,d);a.extend(!0,e.prototype,a.pkp.classes.ObjectProxy.prototype);return new e(b,c)};a.pkp.classes.Helper.resolveObjectName=function(b){var c,d,e;c=b.split(".");if("$"!=c.shift())throw Error(['Namespace "',c[0],'" for object "',b,'" is currently not supported!'].join(""));e=c[c.length-1];if(e.charAt(0).toUpperCase()!==e.charAt(0))throw Error(['The name "',
b,'" does not point to aconstructor which must always be upper case!'].join(""));e=a;for(d in c)if(e=e[c[d]],void 0===e)throw Error(['Constructor for object "',b,'" not found!'].join(""));if(!a.isFunction(e))throw Error(['The name "',b,'" does not point to a,constructor which must always be a function!'].join());return e};a.pkp.classes.Helper.getObjectProxyInstance=function(){var a=function(a,b){this.objectName_=a;this.parent.apply(this,b)};a.objectName_="";a.prototype.parent=function(){};return a};
a.pkp.classes.Helper.injectMixin=function(b,c){var d=a.pkp.classes.Helper.objectFactory(c,[]);a.extend(!0,b,d)};a.pkp.classes.Helper.curry=function(a,c,d){if(2<arguments.length){var e,f;e=Array.prototype.slice.call(arguments,2);return function(){f=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(f,e);return a.apply(c,f)}}return function(){return a.apply(c,arguments)}}})(jQuery);(function(a){a.pkp.classes.ObjectProxy=function(){};a.pkp.classes.ObjectProxy.prototype.objectName_="";a.pkp.classes.ObjectProxy.prototype.self=function(b,c){var d,e;for(d=this.constructor;d;d=d.parent_&&d.parent_.constructor)if(d.hasOwnProperty(b))return d=d[b],a.isFunction(d)?(e=Array.prototype.slice.call(arguments,1),d.apply(this,e)):d;throw Error(['Static property "',b,'" not found!'].join(""));};a.pkp.classes.ObjectProxy.prototype.parent=function(b,c){var d,e,f,g;d=a.pkp.classes.ObjectProxy.prototype.parent.caller;
if(d.parent_)return e=Array.prototype.slice.call(arguments),d.parent_.constructor.apply(this,e);e=Array.prototype.slice.call(arguments,1);if(this.hasOwnProperty(b)&&this[b]===d)return this.constructor.parent_[b].apply(this,e);f=!1;for(g=this.constructor;g;g=g.parent_&&g.parent_.constructor)if(g.prototype.hasOwnProperty(b)&&g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(this,e);throw Error("Trying to call parent from a method of one name to a method of a different name");};a.pkp.classes.ObjectProxy.prototype.getObjectName=
function(){return this.objectName_}})(jQuery);(function(a){a.pkp.classes.Handler=function(a,c){if(1<a.length)throw Error("jQuery selector contained more than one handler!");this.$htmlElement_=a;if(void 0!==this.data("handler"))throw Error(['The handler "',this.getObjectName(),'" has already been bound to the selected element!'].join(""));this.eventBindings_={};this.dataItems_={};this.publishedEvents_={};c.eventBridge&&(this.eventBridge_=c.eventBridge);if(c.publishChangeEvents){this.publishChangeEvents_=c.publishChangeEvents;var d;for(d=0;d<this.publishChangeEvents_.length;d++)this.publishEvent(this.publishChangeEvents_[d])}else this.publishChangeEvents_=
[];this.data("handler",this)};a.pkp.classes.Handler.prototype.publishChangeEvents_=null;a.pkp.classes.Handler.prototype.$htmlElement_=null;a.pkp.classes.Handler.prototype.eventBindings_=null;a.pkp.classes.Handler.prototype.dataItems_=null;a.pkp.classes.Handler.prototype.publishedEvents_=null;a.pkp.classes.Handler.prototype.eventBridge_=null;a.pkp.classes.Handler.getHandler=function(b){b=b.data("pkp.handler");if(!(b instanceof a.pkp.classes.Handler))throw Error("There is no handler bound to this element!");
return b};a.pkp.classes.Handler.prototype.getHtmlElement=function(){a.pkp.classes.Handler.checkContext_(this);return this.$htmlElement_};a.pkp.classes.Handler.prototype.publishChangeEvents=function(){var a;for(a=0;a<this.publishChangeEvents_.length;a++)this.trigger(this.publishChangeEvents_[a])};a.pkp.classes.Handler.prototype.handleEvent=function(b){var c,d,e,f,g,h;c=a(this);d=a.pkp.classes.Handler.getHandler(c);if(c[0]!==d.getHtmlElement.call(d)[0])throw Error("An invalid handler is bound to the calling element of an event!");
c=d.eventBindings_[b.type];if(void 0===c)return!1;e=a.makeArray(arguments);f=!0;e.unshift(this);g=0;for(h=c.length;g<h&&!(!1===c[g].apply(d,e)&&(f=!1),b.isImmediatePropagationStopped());g++);b.stopPropagation();return f};a.pkp.classes.Handler.prototype.callbackWrapper=function(b,c){a.pkp.classes.Handler.checkContext_(this);c||(c=this);return function(){var d;d=a.makeArray(arguments);d.unshift(this);return b.apply(c,d)}};a.pkp.classes.Handler.prototype.remoteResponse=function(a,c){return this.handleJson(c)};
a.pkp.classes.Handler.prototype.remove=function(){a.pkp.classes.Handler.checkContext_(this);var b,c;b=this.getHtmlElement();b.unbind(".pkpHandler");for(c in this.dataItems_)"pkp.handler"!==c&&b.removeData(c);b.trigger("pkpRemoveHandler");b.unbind(".pkpHandlerRemove");b.removeData("pkp.handler")};a.pkp.classes.Handler.prototype.handleJson=function(a){if(!a)throw Error("Server error: Server returned no or invalid data!");if(!0===a.status)return a.event&&(a.event.data?this.trigger(a.event.name,a.event.data):
this.trigger(a.event.name)),a;a.content&&alert(a.content);return!1};a.pkp.classes.Handler.prototype.setHtmlElement=function(b){a.pkp.classes.Handler.checkContext_(this);return this.$htmlElement_=b};a.pkp.classes.Handler.prototype.bind=function(b,c){a.pkp.classes.Handler.checkContext_(this);if(!this.eventBindings_[b]){this.eventBindings_[b]=[];var d;d=".pkpHandler";"pkpRemoveHandler"===b&&(d=".pkpHandlerRemove");this.getHtmlElement().bind(b+d,this.handleEvent)}this.eventBindings_[b].push(c)};a.pkp.classes.Handler.prototype.unbind=
function(b,c){a.pkp.classes.Handler.checkContext_(this);if(!this.eventBindings_[b])return!1;var d,e;d=0;for(e=this.eventBindings_[b].length;d<e;d++)if(this.eventBindings_[b][d]===c){this.eventBindings_[b].splice([d],1);break}0===this.eventBindings_[b].length&&(delete this.eventBindings_[b],this.getHtmlElement().unbind(b,this.handleEvent));return!0};a.pkp.classes.Handler.prototype.data=function(b,c){a.pkp.classes.Handler.checkContext_(this);b="pkp."+b;void 0!==c&&(this.dataItems_[b]=!0);return 1<arguments.length?
this.getHtmlElement().data(b,c):this.getHtmlElement().data(b)};a.pkp.classes.Handler.prototype.trigger=function(a,c){void 0===c&&(c=null);this.getHtmlElement().triggerHandler(a,c);this.publishedEvents_[a]||this.triggerPublicEvent_(a,c)};a.pkp.classes.Handler.prototype.publishEvent=function(a){this.publishedEvents_[a]||(this.publishedEvents_[a]=!0,this.bind(a,function(c,d,e){var f=null;2<arguments.length&&(f=Array.prototype.slice.call(arguments,2));this.triggerPublicEvent_(a,f)}))};a.pkp.classes.Handler.prototype.switchViz=
function(b){a(b.currentTarget).parent().parent().find("span").toggle()};a.pkp.classes.Handler.prototype.initializeTinyMCE=function(){if("undefined"!==typeof tinyMCE){var b=this.getHtmlElement().attr("id");a("#"+b).find(".richContent").each(function(){var b=a(this).attr("id"),d=a("<div></div>"),e=a("<div></div>"),f=tinyMCE.EditorManager.settings;a(this).hasClass("extendedRichContent")&&(f.toolbar=f.richToolbar);tinyMCE.EditorManager.createEditor(b,f).render();if(a(this).hasClass("localizable")||a(this).hasClass("flag"))if(d.addClass("mceLocalizationIcon localizable"),
d.attr("id","mceLocalizationIcon-"+b),a(this).wrap(e),a(this).parent().append(d),a(this).hasClass("localizable"))d.addClass("mceGlobe");else if(a(this).hasClass("flag")&&(b=a(this).attr("class").split(" "),b.length))for(e=0;e<b.length;e++)if(b[e].match(/^flag_[a-z]{2}_[A-Z]{2}$/)){d.addClass(b[e]);break}})}};a.pkp.classes.Handler.prototype.triggerPublicEvent_=function(b,c){this.getHtmlElement().parent().trigger(b,c);this.eventBridge_&&a('[id^="'+this.eventBridge_+'"]').trigger(b,c)};a.pkp.classes.Handler.checkContext_=
function(b){if(!(b instanceof a.pkp.classes.Handler))throw Error("Trying to call handler method in non-handler context!");}})(jQuery);(function(a){a.pkp.classes.TinyMCEHelper=function(){throw Error("Trying to instantiate the TinyMCEHelper singleton!");};a.pkp.classes.TinyMCEHelper.prototype.getVariableMap=function(b){b=a(b).attr("data-variables");return void 0!==b?a.parseJSON(decodeURIComponent(b)):[]};a.pkp.classes.TinyMCEHelper.prototype.getVariableElement=function(b,c){return a("<div/>").append(a("<span/>").addClass("pkpTag mceNonEditable").attr("data-symbolic",b).text(c))}})(jQuery);(function(a){a.pkp.classes.linkAction=a.pkp.classes.linkAction||{};a.pkp.classes.linkAction.LinkActionRequest=function(a,c){this.$linkActionElement=a;this.options=c;a.is("a")&&c.url&&a.attr("href",c.url)};a.pkp.classes.linkAction.LinkActionRequest.prototype.$linkActionElement=null;a.pkp.classes.linkAction.LinkActionRequest.prototype.options=null;a.pkp.classes.linkAction.LinkActionRequest.prototype.activate=function(){this.getLinkActionElement().trigger("actionStart");return!1};a.pkp.classes.linkAction.LinkActionRequest.prototype.finish=
function(){this.options.finishCallback&&this.options.finishCallback();this.getLinkActionElement().trigger("actionStop");return!1};a.pkp.classes.linkAction.LinkActionRequest.prototype.getUrl=function(){return this.options.url?this.options.url:null};a.pkp.classes.linkAction.LinkActionRequest.prototype.getOptions=function(){return this.options};a.pkp.classes.linkAction.LinkActionRequest.prototype.getLinkActionElement=function(){return this.$linkActionElement};a.pkp.classes.linkAction.LinkActionRequest.prototype.shouldDebounce=
function(){return!0}})(jQuery);(function(a){a.pkp.classes.linkAction.RedirectRequest=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.RedirectRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.RedirectRequest.prototype.activate=function(a,c){var d=this.getOptions();window.open(d.url,d.name,d.specs);return this.parent("activate",a,c)}})(jQuery);(function(a){a.pkp.classes.linkAction.OpenWindowRequest=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.OpenWindowRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.OpenWindowRequest.prototype.activate=function(a,c){var d=this.getOptions();window.open(d.url);return this.parent("activate",a,c)}})(jQuery);(function(a){a.pkp.classes.linkAction.PostAndRedirectRequest=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.PostAndRedirectRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.PostAndRedirectRequest.prototype.postJsonData_=null;a.pkp.classes.linkAction.PostAndRedirectRequest.prototype.activate=function(b,c){var d=this.parent("activate",b,c),e=this.getOptions(),f=a.pkp.classes.Helper.curry(this.handleResponse_,this);a.post(e.postUrl,f,
"json");return d};a.pkp.classes.linkAction.PostAndRedirectRequest.prototype.finishCallback_=function(){var b=this.getLinkActionElement(),b=a.pkp.classes.Handler.getHandler(b);this.finish();b.handleJson(this.postJsonData_)};a.pkp.classes.linkAction.PostAndRedirectRequest.prototype.handleResponse_=function(b){var c=this.getOptions(),d=null,e=null;this.postJsonData_=b;d=setInterval(function(){0==a.active&&(clearInterval(d),window.location=c.url)},100);e=a.pkp.classes.Helper.curry(this.finishCallback_,
this);setTimeout(e,2E3)}})(jQuery);(function(a){a.pkp.classes.linkAction.NullAction=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.NullAction,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.NullAction.prototype.activate=function(a,c){return this.parent("activate",a,c)};a.pkp.classes.linkAction.NullAction.prototype.shouldDebounce=function(){return!1}})(jQuery);(function(a){a.pkp.classes.linkAction.EventAction=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.EventAction,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.EventAction.prototype.activate=function(b,c){a(this.options.target).trigger(this.options.event,this.options);return this.parent("activate",b,c)};a.pkp.classes.linkAction.EventAction.prototype.shouldDebounce=function(){return!1}})(jQuery);(function(a){a.pkp.classes.linkAction.AjaxRequest=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.AjaxRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.AjaxRequest.prototype.activate=function(b,c){var d=this.parent("activate",b,c),e=this.getOptions(),f=a.pkp.classes.Helper.curry(this.handleResponse,this);switch(e.requestType){case "get":a.getJSON(e.url,f);break;case "post":a.post(e.url,f,"json")}return d};a.pkp.classes.linkAction.AjaxRequest.prototype.handleResponse=
function(a){this.getLinkActionElement().data("pkp.handler").handleJson(a);this.finish()}})(jQuery);(function(a){a.pkp.classes.linkAction.ModalRequest=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.ModalRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.ModalRequest.prototype.$modal_=null;a.pkp.classes.linkAction.ModalRequest.prototype.activate=function(b,c){var d=this.getOptions(),e=this.getLinkActionElement(),f=e.text();void 0===d.title&&(""===f&&(f=e.attr("title")),d.title=f);e=a.pkp.classes.Helper.uuid();if(!d.modalHandler)throw Error('The "modalHandler" setting is required in a ModalRequest');
f=this.getLinkActionElement();f=a.pkp.classes.Handler.getHandler(f);f=a.extend(!0,{eventBridge:f.getStaticId()},d);this.$modal_=a('<div id="'+e+'" class="pkp_modal pkpModalWrapper" tabindex="-1"></div>').pkpHandler(d.modalHandler,f);a.pkp.classes.Handler.getHandler(this.$modal_).bind("pkpRemoveHandler",a.pkp.classes.Helper.curry(this.finish,this));return this.parent("activate",b,c)};a.pkp.classes.linkAction.ModalRequest.prototype.finish=function(){this.$linkActionElement.focus();this.$modal_.remove();
return this.parent("finish")}})(jQuery);(function(a){a.pkp.classes.notification=a.pkp.classes.notification||{};a.pkp.classes.notification.NotificationHelper=function(){};a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent=function(b,c){var d,e,f,g,h,j,i,k,p,n,r;if(void 0!==c.content)b.getHtmlElement().parent().trigger("notifyUser",[c]);else{d=b.getHtmlElement();e=!1;!(b instanceof a.pkp.controllers.SiteHandler)&&0<a(c).parents(".pkp_controllers_grid").length&&(d.parent().trigger("notifyUser"),e=!0);d=a(".pkp_notification",
d);f=[];g=0;for(h=d.length;g<h;g++)if(i=a(d[g]),!(0<i.parents(":hidden").length)){j=i.parents();p=0;for(n=j.length;p<n;p++)if(k=a(j[p]).data("pkp.handler"),k instanceof a.pkp.classes.Handler){r=a(j[p]);break}if(r.has(c[0]).length||r[0]===c[0]){if(0<i.parents(".ui-accordion:first").length&&(j=i.parents(".ui-accordion:first"),!j.has(c[0])))continue;f.push(i)}}if(f.length)for(g=f.length-1;-1<g;g--)f[g].triggerHandler("notifyUser");else e||b.getHtmlElement().parent().trigger("notifyUser")}}})(jQuery);(function(a){a.pkp.classes.features=a.pkp.classes.features||{};a.pkp.classes.features.Feature=function(a,c){this.gridHandler=a;this.options_=c;this.addFeatureHtml(this.getGridHtmlElement(),c)};a.pkp.classes.features.Feature.prototype.gridHandler=null;a.pkp.classes.features.Feature.prototype.options_=null;a.pkp.classes.features.Feature.prototype.setOptions=function(a){this.options_=a};a.pkp.classes.features.Feature.prototype.getOptions=function(){return this.options_};a.pkp.classes.features.Feature.prototype.init=
function(){throw Error("Abstract method!");};a.pkp.classes.features.Feature.prototype.addElement=function(){return!1};a.pkp.classes.features.Feature.prototype.replaceElement=function(){return!1};a.pkp.classes.features.Feature.prototype.resequenceRows=function(){return!1};a.pkp.classes.features.Feature.prototype.refreshGrid=function(){return!1};a.pkp.classes.features.Feature.prototype.replaceElementResponseHandler=function(){return!1};a.pkp.classes.features.Feature.prototype.callbackWrapper=function(a,
c){return this.gridHandler.callbackWrapper(a,c)};a.pkp.classes.features.Feature.prototype.addFeatureHtml=function(){};a.pkp.classes.features.Feature.prototype.getGridHtmlElement=function(){return this.gridHandler.getHtmlElement()}})(jQuery);(function(a){a.pkp.classes.features.OrderItemsFeature=function(b,c){this.parent(b,c);this.$orderButton_=a(".pkp_linkaction_orderItems",this.getGridHtmlElement());this.$finishControl_=a(".order_finish_controls",this.getGridHtmlElement());0===this.$orderButton_.length&&(this.isOrdering=!0);this.itemsOrder=[]};a.pkp.classes.Helper.inherits(a.pkp.classes.features.OrderItemsFeature,a.pkp.classes.features.Feature);a.pkp.classes.features.OrderItemsFeature.prototype.itemsOrder=null;a.pkp.classes.features.OrderItemsFeature.prototype.isOrdering=
!1;a.pkp.classes.features.OrderItemsFeature.prototype.$orderButton_=null;a.pkp.classes.features.OrderItemsFeature.prototype.$cancelButton_=null;a.pkp.classes.features.OrderItemsFeature.prototype.$saveButton_=null;a.pkp.classes.features.OrderItemsFeature.prototype.$finishControl_=null;a.pkp.classes.features.OrderItemsFeature.prototype.getOrderButton=function(){return this.$orderButton_};a.pkp.classes.features.OrderItemsFeature.prototype.getFinishControl=function(){return this.$finishControl_};a.pkp.classes.features.OrderItemsFeature.prototype.getSaveOrderButton=
function(){return this.getFinishControl().find(".saveButton")};a.pkp.classes.features.OrderItemsFeature.prototype.getCancelOrderButton=function(){return this.getFinishControl().find(".cancelFormButton")};a.pkp.classes.features.OrderItemsFeature.prototype.getMoveItemRowActionSelector=function(){return".orderable .pkp_linkaction_moveItem"};a.pkp.classes.features.OrderItemsFeature.prototype.getMoveItemClasses=function(){return"pkp_helpers_moveicon ordering"};a.pkp.classes.features.OrderItemsFeature.prototype.dragStartCallback=
function(){};a.pkp.classes.features.OrderItemsFeature.prototype.dragStopCallback=function(){};a.pkp.classes.features.OrderItemsFeature.prototype.updateOrderCallback=function(){};a.pkp.classes.features.OrderItemsFeature.prototype.init=function(){this.addOrderingClassToRows();this.toggleMoveItemRowAction(this.isOrdering);this.toggleOrderLink_();this.isOrdering&&this.setupSortablePlugin()};a.pkp.classes.features.OrderItemsFeature.prototype.addFeatureHtml=function(b,c){var d;void 0!==c.orderFinishControls&&
(d=a(c.orderFinishControls),b.find("table").last().after(d),d.hide())};a.pkp.classes.features.OrderItemsFeature.prototype.addOrderingClassToRows=function(){this.gridHandler.getRows().addClass("orderable")};a.pkp.classes.features.OrderItemsFeature.prototype.setupSortablePlugin=function(){};a.pkp.classes.features.OrderItemsFeature.prototype.storeRowOrder=function(){};a.pkp.classes.features.OrderItemsFeature.prototype.clickOrderHandler=function(){this.gridHandler.hideAllVisibleRowActions();this.storeOrder(this.gridHandler.getRows());
this.toggleState(!0);return!1};a.pkp.classes.features.OrderItemsFeature.prototype.saveOrderHandler=function(){var a;this.gridHandler.updateControlRowsPosition();this.unbindOrderFinishControlsHandlers_();a=this.gridHandler.getRows();this.storeOrder(a);return!1};a.pkp.classes.features.OrderItemsFeature.prototype.cancelOrderHandler=function(){this.gridHandler.resequenceRows(this.itemsOrder);this.toggleState(!1);return!1};a.pkp.classes.features.OrderItemsFeature.prototype.toggleState=function(a){this.isOrdering=
a;this.toggleGridLinkActions_();this.toggleOrderLink_();this.toggleFinishControl_();this.toggleItemsDragMode();this.setupSortablePlugin()};a.pkp.classes.features.OrderItemsFeature.prototype.storeOrder=function(b){var c,d,e,f;this.itemsOrder=[];c=0;for(d=b.length;c<d;c++)e=a(b[c]),f=e.attr("id"),this.itemsOrder.push(f),this.storeRowOrder(c,e)};a.pkp.classes.features.OrderItemsFeature.prototype.toggleItemsDragMode=function(){var a=this.isOrdering,c=this.gridHandler.getRows().filter(".orderable"),d=
this.getMoveItemClasses();a?c.addClass(d):c.removeClass(d);this.toggleMoveItemRowAction(a)};a.pkp.classes.features.OrderItemsFeature.prototype.applySortPlgOnElements=function(b,c,d){var e=this.isOrdering,f=this.gridHandler.callbackWrapper(this.dragStartCallback,this),g=this.gridHandler.callbackWrapper(this.dragStopCallback,this),h=this.gridHandler.callbackWrapper(this.updateOrderCallback,this),c={disabled:!e,items:c,activate:f,deactivate:g,update:h,tolerance:"pointer"};"object"===typeof d&&(c=a.extend(!0,
c,d));b.sortable(c)};a.pkp.classes.features.OrderItemsFeature.prototype.getRowsDataId=function(b){var c,d=[],e;for(c in this.itemsOrder)e=a("#"+this.itemsOrder[c],b),1>e.length||(e=this.gridHandler.getRowDataId(e),d.push(e));return d};a.pkp.classes.features.OrderItemsFeature.prototype.toggleMoveItemRowAction=function(b){var c=this.getGridHtmlElement(),d=a("div.row_actions",c),e="a:not("+this.getMoveItemRowActionSelector()+")",f=d.find(e),d=a(this.getMoveItemRowActionSelector(),c);b?(f.addClass("pkp_helpers_display_none"),
d.show(),this.gridHandler.showRowActionsDiv()):(f.removeClass("pkp_helpers_display_none"),b=a(".gridRow div.row_actions",c),e=b.find(e),0===e.length&&this.gridHandler.hideRowActionsDiv(),d.hide())};a.pkp.classes.features.OrderItemsFeature.prototype.addElement=function(){this.addOrderingClassToRows();this.toggleItemsDragMode();return!1};a.pkp.classes.features.OrderItemsFeature.prototype.replaceElement=function(){this.addOrderingClassToRows();this.toggleItemsDragMode();return!1};a.pkp.classes.features.OrderItemsFeature.prototype.toggleGridLinkActions_=
function(){var b=this.isOrdering,c=a(".pkp_controllers_linkAction",this.getGridHtmlElement()).not(this.getMoveItemRowActionSelector()).not(this.getOrderButton()).not(this.getFinishControl().find("*"));this.gridHandler.changeLinkActionsState(!b,c)};a.pkp.classes.features.OrderItemsFeature.prototype.toggleOrderLink_=function(){if(this.isOrdering)this.$orderButton_.unbind("click"),this.$orderButton_.attr("disabled","disabled");else{var a=this.gridHandler.callbackWrapper(this.clickOrderHandler,this);
this.$orderButton_.click(a);this.$orderButton_.removeAttr("disabled")}};a.pkp.classes.features.OrderItemsFeature.prototype.toggleFinishControl_=function(){this.isOrdering?(this.bindOrderFinishControlsHandlers_(),this.getFinishControl().slideDown(300)):(this.unbindOrderFinishControlsHandlers_(),this.getFinishControl().slideUp(300))};a.pkp.classes.features.OrderItemsFeature.prototype.bindOrderFinishControlsHandlers_=function(){var a=this.getSaveOrderButton(),c=this.getCancelOrderButton(),d=this.gridHandler.callbackWrapper(this.cancelOrderHandler,
this),e=this.gridHandler.callbackWrapper(this.saveOrderHandler,this);a.click(e);c.click(d)};a.pkp.classes.features.OrderItemsFeature.prototype.unbindOrderFinishControlsHandlers_=function(){this.getSaveOrderButton().unbind("click");this.getCancelOrderButton().unbind("click")}})(jQuery);(function(a){a.pkp.classes.features.OrderGridItemsFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.OrderGridItemsFeature,a.pkp.classes.features.OrderItemsFeature);a.pkp.classes.features.OrderGridItemsFeature.prototype.setupSortablePlugin=function(){this.applySortPlgOnElements(this.getGridHtmlElement(),"tr.orderable",null)};a.pkp.classes.features.OrderGridItemsFeature.prototype.saveOrderHandler=function(){var b,c,d=this.getOptions();this.parent("saveOrderHandler");
b=JSON.stringify(this.getItemsDataId());c=this.callbackWrapper(this.saveOrderResponseHandler_,this);a.post(d.saveItemsSequenceUrl,{data:b},c,"json");return!1};a.pkp.classes.features.OrderGridItemsFeature.prototype.getItemsDataId=function(){return this.getRowsDataId(this.getGridHtmlElement())};a.pkp.classes.features.OrderGridItemsFeature.prototype.saveOrderResponseHandler_=function(a,c){this.gridHandler.handleJson(c);this.toggleState(!1)}})(jQuery);(function(a){a.pkp.classes.features.OrderCategoryGridItemsFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.OrderCategoryGridItemsFeature,a.pkp.classes.features.OrderGridItemsFeature);a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.setupSortablePlugin=function(){var b,c,d,e;this.applySortPlgOnElements(this.getGridHtmlElement(),"tbody.orderable",null);b=navigator.userAgent.toLowerCase();if(!(/msie/.test(b)&&8>=parseInt(b.substr(b.indexOf("msie")+
5,1),10))){b=this.gridHandler.getCategories();c=0;for(d=b.length;c<d;c++)e=a(b[c]),this.applySortPlgOnElements(e,"tr.orderable",null)}};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.saveOrderHandler=function(){this.gridHandler.updateEmptyPlaceholderPosition();this.parent("saveOrderHandler");return!1};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.cancelOrderHandler=function(){var a=this.getCategorySequence_(this.itemsOrder);this.parent("cancelOrderHandler");this.gridHandler.resequenceCategories(a);
return!1};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.toggleItemsDragMode=function(){this.parent("toggleItemsDragMode");var b=this.gridHandler.getCategories(),c,d,e;c=0;for(d=b.length;c<d;c++)e=a(b[c]),this.toggleCategoryDragMode_(e)};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.addOrderingClassToRows=function(){var b=this.getOptions().type,c;if(b==a.pkp.cons.ORDER_CATEGORY_GRID_CATEGORIES_ONLY||b==a.pkp.cons.ORDER_CATEGORY_GRID_CATEGORIES_AND_ROWS)c=this.gridHandler.getCategories(),
c.addClass("orderable");(b==a.pkp.cons.ORDER_CATEGORY_GRID_CATEGORIES_ROWS_ONLY||b==a.pkp.cons.ORDER_CATEGORY_GRID_CATEGORIES_AND_ROWS)&&this.parent("addOrderingClassToRows");this.gridHandler.getCategoryRow().removeClass("orderable")};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.getItemsDataId=function(){var b=this.getCategorySequence_(this.itemsOrder),c=[],d,e,f,g;d=0;for(e=b.length;d<e;d++)f=a("#"+b[d]),g=this.getRowsDataId(f),f=this.gridHandler.getCategoryDataId(f),c.push({categoryId:f,
rowsId:g});return c};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.toggleCategoryDragMode_=function(b){var c=this.isOrdering,b=this.gridHandler.getCategoryRow(b),b=a("td:first",b),d=this.getMoveItemClasses();c?b.addClass(d):b.removeClass(d)};a.pkp.classes.features.OrderCategoryGridItemsFeature.prototype.getCategorySequence_=function(b){var c,d,e=[],f;c=0;for(d=b.length;c<d;c++)f=this.gridHandler.getCategoryDataIdByRowId(b[c]),f=this.gridHandler.getCategoryIdPrefix()+f,-1<a.inArray(f,
e)||e.push(f);return e}})(jQuery);(function(a){a.pkp.classes.features.OrderListbuilderItemsFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.OrderListbuilderItemsFeature,a.pkp.classes.features.OrderItemsFeature);a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.addFeatureHtml=function(b,c){var d,e,f,g,h,j;this.parent("addFeatureHtml",b,c);d=this.getSequenceInput_();e=this.gridHandler.getRows();f=0;for(g=e.length;f<g;f++)h=a(e[f]),j=d.clone(),a("td.first_column",h).append(j)};
a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.setupSortablePlugin=function(){this.applySortPlgOnElements(this.getGridHtmlElement(),"tr.orderable",null)};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.init=function(){this.parent("init");this.toggleItemsDragMode()};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.toggleState=function(a){this.parent("toggleState",a);this.toggleContentHandlers_()};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.storeRowOrder=
function(a,c){c.find(".itemSequence").attr("value",a+1);c.find(".isModified").attr("value",1)};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.saveOrderHandler=function(){this.parent("saveOrderHandler");this.toggleState(!1);return!1};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.updateOrderCallback=function(){var a;this.parent("updateOrderCallback");a=this.gridHandler.getRows();this.storeOrder(a)};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.clickOrderHandler=
function(){var b=a("select:visible",this.getGridHtmlElement()),c,d;if(0<b.length){c=0;for(d=b.length;c<d;c++)this.gridHandler.saveRow(a(b[c]).parents(".gridRow"))}return this.parent("clickOrderHandler")};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.addElement=function(a){this.parent("addElement",a);this.formatAndStoreNewRow_(a);return!1};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.replaceElement=function(a){this.parent("replaceElement",a);this.formatAndStoreNewRow_(a);
return!1};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.getSequenceInput_=function(){return a('<input type="hidden" name="newRowId[sequence]" class="itemSequence" />')};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.toggleContentHandlers_=function(){var b=this.gridHandler.getRows(),c,d,e;c=0;for(d=b.length;c<d;c++)e=a(b[c]),this.isOrdering?e.find(".gridCellDisplay").unbind("click"):this.gridHandler.attachContentHandlers_(e)};a.pkp.classes.features.OrderListbuilderItemsFeature.prototype.formatAndStoreNewRow_=
function(a){a.children().after(this.getSequenceInput_());a=this.gridHandler.getRows();this.storeOrder(a)}})(jQuery);(function(a){a.pkp.classes.features.OrderMultipleListsItemsFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.OrderMultipleListsItemsFeature,a.pkp.classes.features.OrderListbuilderItemsFeature);a.pkp.classes.features.OrderMultipleListsItemsFeature.prototype.addFeatureHtml=function(b,c){var d,e,f,g,h,j,i;this.parent("addFeatureHtml",b,c);d=a('<input type="hidden" name="newRowId[listId]" class="itemList" />');e=this.gridHandler.getRows();f=0;for(g=e.length;f<
g;f++)h=a(e[f]),j=this.gridHandler.getListIdByRow(h),i=d.clone(),i.attr("value",j),a("td.first_column",h).append(i)};a.pkp.classes.features.OrderMultipleListsItemsFeature.prototype.storeRowOrder=function(a,c){var d,e;this.parent("storeRowOrder",a,c);d=c.find(".itemList");e=this.gridHandler.getListIdByRow(c);d.attr("value",e)};a.pkp.classes.features.OrderMultipleListsItemsFeature.prototype.setupSortablePlugin=function(){var a=this.gridHandler.getLists().find("tbody");this.applySortPlgOnElements(a,
"tr.orderable",{connectWith:a})};a.pkp.classes.features.OrderMultipleListsItemsFeature.prototype.dragStartCallback=function(a,c,d){a=this.gridHandler.getListByRow(d.item);this.gridHandler.toggleListNoItemsRow(a,1,".ui-sortable-placeholder, .ui-sortable-helper")};a.pkp.classes.features.OrderMultipleListsItemsFeature.prototype.dragStopCallback=function(a,c,d){a=this.gridHandler.getListByRow(d.item);this.gridHandler.toggleListNoItemsRow(a,0,null)}})(jQuery);(function(a){a.pkp.classes.features.GridCategoryAccordionFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.GridCategoryAccordionFeature,a.pkp.classes.features.Feature);a.pkp.classes.features.GridCategoryAccordionFeature.prototype.getExpandClass=function(){return"expanded"};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.getCollapseClass=function(){return"collapsed"};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.getAccordionLinks=
function(b){var c="."+this.getCollapseClass(),d="."+this.getExpandClass();return a(c+","+d,b)};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.init=function(){var b;a(".grid_header_bar .expand_all",this.getGridHtmlElement()).click(this.callbackWrapper(this.expandAllClickHandler_,this));b=a(".grid_header_bar .collapse_all",this.getGridHtmlElement());b.click(this.callbackWrapper(this.collapseAllClickHandler_,this));this.bindCategoryAccordionControls_(this.getGridHtmlElement());b.click();
this.hideEmptyPlaceholders_()};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.replaceElement=function(b){this.bindCategoryAccordionControls_(b);a("."+this.getExpandClass(),b).click();this.hideEmptyPlaceholders_();return!1};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.bindCategoryAccordionControls_=function(a){this.getAccordionLinks(a).click(this.callbackWrapper(this.accordionRowClickHandler_,this))};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.hideEmptyPlaceholders_=
function(){a("tbody.empty",this.getGridHtmlElement()).hide()};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.expandAllClickHandler_=function(b){a(b).hide();a(".grid_header_bar .collapse_all").show();a(".category ."+this.getExpandClass(),this.getGridHtmlElement()).click();return!1};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.collapseAllClickHandler_=function(b){a(b).hide();a(".grid_header_bar .expand_all").show();a(".category ."+this.getCollapseClass(),this.getGridHtmlElement()).click();
this.closeOpenedRowControls_();return!1};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.accordionRowClickHandler_=function(b){var c=a(b),d,e;c.hide();d=c.parents(".category_grid_body:first");b=this.gridHandler.getRowsInCategory(d);0===b.length&&(b=this.gridHandler.getCategoryEmptyPlaceholder(d));e=c.parent();c.hasClass(this.getExpandClass())?(d=a("."+this.getCollapseClass(),e),d.show(),b.show()):(c=a("."+this.getExpandClass(),e),c.show(),b.hide(),this.closeOpenedRowControls_(d));this.updateGridActions_();
return!1};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.updateGridActions_=function(){var b,c,d,e,f;this.getGridHtmlElement().is(":visible")&&(b=this.getGridHtmlElement(),c="."+this.getExpandClass()+", ."+this.getCollapseClass(),c=a(c,b).filter(":visible"),d=a("."+this.getExpandClass(),b).filter(":visible"),b=a("."+this.getCollapseClass(),b).filter(":visible"),e=a(".grid_header_bar .collapse_all"),f=a(".grid_header_bar .expand_all"),c.length==d.length&&e.is(":visible")?e.click():c.length==
b.length&&f.is(":visible")&&f.click())};a.pkp.classes.features.GridCategoryAccordionFeature.prototype.closeOpenedRowControls_=function(b){void 0==b&&(b=this.gridHandler.getHtmlElement());a(".row_controls :visible",b).closest("tr").prev().find(".row_actions > a:first").click()}})(jQuery);(function(a){a.pkp.classes.features.GeneralPagingFeature=function(a,c){c.defaultItemsPerPage=parseInt(c.defaultItemsPerPage,10);c.currentItemsPerPage=parseInt(c.currentItemsPerPage,10);c.itemsTotal=c.itemsTotal?parseInt(c.itemsTotal,10):0;c.currentPage=parseInt(c.currentPage,10);this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.GeneralPagingFeature,a.pkp.classes.features.Feature);a.pkp.classes.features.GeneralPagingFeature.prototype.getOptions=function(){return this.parent("getOptions")};
a.pkp.classes.features.GeneralPagingFeature.prototype.setGridParams=function(b){var c=this.getOptions();c.hasOwnProperty("filter")&&(c=a.parseJSON(c.filter),a.extend(!0,b,c));this.gridHandler.setFetchExtraParams(b)}})(jQuery);(function(a){a.pkp.classes.features.PagingFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.PagingFeature,a.pkp.classes.features.GeneralPagingFeature);a.pkp.classes.features.PagingFeature.prototype.init=function(){this.configPagingLinks_();this.configItemsPerPageElement_()};a.pkp.classes.features.PagingFeature.prototype.addFeatureHtml=function(a,c){a.append(c.pagingMarkup)};a.pkp.classes.features.PagingFeature.prototype.resequenceRows=function(){var a=this.gridHandler.getRows(),
c,d;c=this.getOptions();c=a.length-c.currentItemsPerPage;if(0<c)for(d=0;d<c;d++)this.gridHandler.deleteElement(a.first(),!0);return!1};a.pkp.classes.features.PagingFeature.prototype.refreshGrid=function(){var a=this.getOptions(),c,d;c=this.gridHandler.getFetchExtraParams();c[a.pageParamName]=a.currentPage;c[a.itemsPerPageParamName]=a.currentItemsPerPage;a=this.gridHandler.getRows().first();d=this.gridHandler.getRows().last();c.topLimitRowId=0==a.length?0:this.gridHandler.getRowDataId(a);c.bottomLimitRowId=
0==d.length?0:this.gridHandler.getRowDataId(d);this.setGridParams(c);return!1};a.pkp.classes.features.PagingFeature.prototype.replaceElementResponseHandler=function(b){var c,d;d=this.getOptions();void 0!=b.deletedRowReplacement&&(c=b.deletedRowReplacement,this.gridHandler.insertOrReplaceElement(c));void 0!=b.pagingInfo&&(c=b.pagingInfo,this.setOptions(c),a("div.gridPaging",this.getGridHtmlElement()).replaceWith(c.pagingMarkup),this.init());b.loadLastPage&&this.getGridHtmlElement().trigger("dataChanged");
void 0!=b.newTopRow&&(c=this.gridHandler.getRows(),d.currentItemsPerPage==c.length&&this.gridHandler.deleteElement(c.last(),!0),c=b.newTopRow,this.gridHandler.insertOrReplaceElement(c,!0));return!1};a.pkp.classes.features.PagingFeature.prototype.configPagingLinks_=function(){var b,c,d,e,f,g,h,j;b=this.getOptions();if(c=a("div.gridPaging",this.getGridHtmlElement())){j=this.callbackWrapper(function(c,d){g=RegExp("[?&]"+b.pageParamName+"(?:=([^&]*))?","i");h=g.exec(a(d.target).attr("href"));null!=h&&
(b.currentPage=parseInt(h[1],10),this.getGridHtmlElement().trigger("dataChanged"));return!1},this);c=c.find("a").not(".showMoreItems").not(".showLessItems");d=0;for(e=c.length;d<e;d++)f=a(c[d]),f.click(j)}};a.pkp.classes.features.PagingFeature.prototype.configItemsPerPageElement_=function(){var b,c,d,e,f,g;b=this.getOptions();if(c=a("div.gridPaging",this.getGridHtmlElement()))if(g=this.callbackWrapper(function(c,d){b.currentItemsPerPage=parseInt(a("option",d.target).filter(":selected").attr("value"),
10);b.currentPage=1;this.getGridHtmlElement().trigger("dataChanged");return!1},this),e=c.find("select.itemsPerPage"),f=[10,25,50,75,100],0>a.inArray(b.defaultItemsPerPage,f)&&f.push(b.defaultItemsPerPage),f.sort(function(a,b){return a-b}),b.itemsTotal<=f[0])a("div.gridItemsPerPage",c).hide();else{d=f.length-1;for(c=0;c<=d;c++)e.append(a('<option value="'+f[c]+'">'+f[c]+"</option>"));e.val(b.currentItemsPerPage.toString());e.change(g)}}})(jQuery);(function(a){a.pkp.classes.features.InfiniteScrollingFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.InfiniteScrollingFeature,a.pkp.classes.features.GeneralPagingFeature);a.pkp.classes.features.InfiniteScrollingFeature.prototype.init=function(){this.getGridHtmlElement().find("div.pkp_loading").hide();this.addScrollHandler_();this.fixGridHeight_();this.addPagingDataToRows_()};a.pkp.classes.features.InfiniteScrollingFeature.prototype.addFeatureHtml=function(a,
c){a.find("div.scrollable").append(c.loadingContainer).after(c.pagingMarkup)};a.pkp.classes.features.InfiniteScrollingFeature.prototype.refreshGrid=function(b){var c=this.getOptions(),d;d=this.gridHandler.getFetchExtraParams();d[c.pageParamName]=c.currentPage;b&&b!==a.pkp.controllers.grid.GridHandler.FETCH_ALL_ROWS_ID&&(b=this.gridHandler.getRowByDataId(b),1==b.length&&(d[c.pageParamName]=Number(b.attr("data-paging"))));d[c.itemsPerPageParamName]=c.currentItemsPerPage;this.setGridParams(d);return!1};
a.pkp.classes.features.InfiniteScrollingFeature.prototype.replaceElementResponseHandler=function(b){var c;this.getOptions();void 0!=b.deletedRowReplacement&&(c=b.deletedRowReplacement,this.gridHandler.insertOrReplaceElement(c),this.updatePagingDataInAllRows_());this.addScrollHandler_();void 0!=b.pagingInfo&&(b=b.pagingInfo,this.setOptions(b),void 0!=b.pagingMarkup&&a("div.gridPagingScrolling",this.getGridHtmlElement()).replaceWith(b.pagingMarkup));this.addPagingDataToRows_();this.toggleLoadingContainer_();
return!1};a.pkp.classes.features.InfiniteScrollingFeature.prototype.observeScroll_=function(b){var c=this.getOptions();if(c.itemsTotal==this.gridHandler.getRows().length)return!1;b.scrollHeight-a(b).scrollTop()==a(b).height()&&(a("div.scrollable",this.getGridHtmlElement()).unbind("scroll"),this.toggleLoadingContainer_(!0),c.currentPage=Number(a("tr.gridRow",this.getGridHtmlElement()).last().attr("data-paging"))+1,this.getGridHtmlElement().trigger("dataChanged",[a.pkp.controllers.grid.GridHandler.FETCH_ALL_ROWS_ID]));
return!1};a.pkp.classes.features.InfiniteScrollingFeature.prototype.fixGridHeight_=function(){var b=a("div.scrollable",this.getGridHtmlElement()),c,d,e,f;0<b.length&&(e=setInterval(function(){if(b.is(":visible")){clearInterval(e);f=b.length;for(c=0;c<f;c++)d=a(b[c]),d.get(0).scrollHeight>d.height()&&d.css("max-height",d.get(0).scrollHeight-10)}},300))};a.pkp.classes.features.InfiniteScrollingFeature.prototype.addPagingDataToRows_=function(){var a=this.getOptions();this.gridHandler.getRows().filter("tr:not([data-paging])").attr("data-paging",
a.currentPage)};a.pkp.classes.features.InfiniteScrollingFeature.prototype.updatePagingDataInAllRows_=function(){var b,c=this.getOptions(),d,e,f=1,g=1;b=this.gridHandler.getRows();b.removeAttr("data-paging");d=0;for(e=b.length;d<e;d++)a(b[d]).attr("data-paging",f),g++,g>c.currentItemsPerPage&&(g=1,f++)};a.pkp.classes.features.InfiniteScrollingFeature.prototype.addScrollHandler_=function(){a("div.scrollable",this.getGridHtmlElement()).scroll(this.gridHandler.callbackWrapper(this.observeScroll_,this))};
a.pkp.classes.features.InfiniteScrollingFeature.prototype.toggleLoadingContainer_=function(a){var c=this.getGridHtmlElement().find("div.scrollable div.pkp_loading"),d=this.getGridHtmlElement().find("div.scrollable"),e=c.height();a?(c.show(),a=d.scrollTop(),d.scrollTop(a+e)):c.hide()}})(jQuery);(function(a){a.pkp.classes.features.CollapsibleGridFeature=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.classes.features.CollapsibleGridFeature,a.pkp.classes.features.Feature);a.pkp.classes.features.CollapsibleGridFeature.prototype.getControlSelector=function(){return"a[id^='collapsibleGridControl-expandGridControlLink-button-']"};a.pkp.classes.features.CollapsibleGridFeature.prototype.init=function(){a(this.getControlSelector(),this.getGridHtmlElement()).click(this.callbackWrapper(this.toggleGridClickHandler_,
this))};a.pkp.classes.features.CollapsibleGridFeature.prototype.addFeatureHtml=function(a,c){a.find("div.grid_header_bar").prepend(c.collapsibleLink)};a.pkp.classes.features.CollapsibleGridFeature.prototype.toggleGridClickHandler_=function(){var a=this.getGridHtmlElement().find(this.getControlSelector());this.getGridHtmlElement().find("div.grid_header").siblings().toggle();a.toggleClass("expand_all").toggleClass("collapse_all");this.getGridHtmlElement().find("div.grid_header_bar .search_extras_collapse").click();
this.getGridHtmlElement().find("div.grid_header span.options").toggle();return!1}})(jQuery);(function(a){a.pkp.controllers.SiteHandler=function(b,c){this.parent(b,c);this.options_=c;this.unsavedFormElements_=[];a(".go").button();this.bind("redirectRequested",this.redirectToUrl);this.bind("notifyUser",this.fetchNotificationHandler_);this.bind("updateHeader",this.updateHeaderHandler_);this.bind("callWhenClickOutside",this.callWhenClickOutsideHandler_);this.bind("mousedown",this.mouseDownHandler_);this.bind("gridInitialized",this.updateHelpDisplayHandler_);this.bind("toggleInlineHelp",this.toggleInlineHelpHandler_);
a(window).bind("beforeunload",this.pageUnloadHandler_);a.ajaxSetup({cache:!1});a("select.applyPlugin",b).selectBox();c.hasSystemNotifications&&this.trigger("notifyUser");this.bind("formChanged",this.callbackWrapper(this.registerUnsavedFormElement_));this.bind("unregisterChangedForm",this.callbackWrapper(this.unregisterUnsavedFormElement_));this.bind("unregisterAllForms",this.callbackWrapper(this.unregisterAllFormElements_));this.bind("pkpModalOpen",this.callbackWrapper(this.openModal_));this.bind("pkpModalClose",
this.callbackWrapper(this.closeModal_));this.outsideClickChecks_={}};a.pkp.classes.Helper.inherits(a.pkp.controllers.SiteHandler,a.pkp.classes.Handler);a.pkp.controllers.SiteHandler.prototype.options_=null;a.pkp.controllers.SiteHandler.prototype.outsideClickChecks_=null;a.pkp.controllers.SiteHandler.prototype.unsavedFormElements_=null;a.pkp.controllers.SiteHandler.prototype.triggerTinyMCEInitialized=function(b){a("#"+b.id).trigger("tinyMCEInitialized",[b])};a.pkp.controllers.SiteHandler.prototype.triggerTinyMCESetup=
function(b){a("#"+b.id).attr("readonly")&&(b.settings.readonly=!0);b.on("init",function(b){var d=a("#"+b.id),e;e=a("#"+b.id).attr("placeholder");""!==e&&(e=a("<span></span>").html(e),e.addClass("mcePlaceholder"),e.attr("id","mcePlaceholder-"+b.id),b.target.getContent().length&&e.hide(),b=a("<div></div>"),b.addClass("mcePlaceholderParent"),d.wrap(b),d.parent().append(e))});b.on("activate",function(b){a("#mcePlaceholder-"+b.id).hide()});b.on("deactivate",function(b){b.target.getContent().length||a("#mcePlaceholder-"+
b.id).show();b.target.dom.addClass(b.target.dom.select("li"),"show")});b.on("BeforeSetContent",function(c){var d=a.pkp.classes.TinyMCEHelper.prototype.getVariableMap("#"+b.id);c.content=c.content.replace(/\{\$([a-zA-Z]+)\}/g,function(b,c){return void 0!==d[c]?a.pkp.classes.TinyMCEHelper.prototype.getVariableElement(c,d[c]).html():b})});b.on("SaveContent",function(b){var d=a("<div>"+b.content+"</div>");d.find(".pkpTag").replaceWith(function(){return"{$"+a(this).attr("data-symbolic")+"}"});b.content=
d.html()});b.on("FullscreenStateChanged init",function(b){var b=b.target,d=a(b.editorContainer);b.plugins.fullscreen&&(b.plugins.fullscreen.isFullscreen()?d.find(".mce-toolbar[role='menubar']").show():d.find(".mce-toolbar[role='menubar']").hide())})};a.pkp.controllers.SiteHandler.prototype.redirectToUrl=function(a,c,d){window.location=d};a.pkp.controllers.SiteHandler.prototype.registerUnsavedFormElement_=function(b,c,d){b=a(d.target.lastElementChild).attr("id");-1==a.inArray(b,this.unsavedFormElements_)&&
this.unsavedFormElements_.push(b)};a.pkp.controllers.SiteHandler.prototype.unregisterUnsavedFormElement_=function(b,c,d){b=a(d.target.lastElementChild).attr("id");b=a.inArray(b,this.unsavedFormElements_);-1!==b&&delete this.unsavedFormElements_[b]};a.pkp.controllers.SiteHandler.prototype.unregisterAllFormElements_=function(){this.unsavedFormElements_=[]};a.pkp.controllers.SiteHandler.prototype.toggleInlineHelpHandler_=function(){a.ajax({url:this.options_.toggleHelpUrl});this.options_.inlineHelpState=
this.options_.inlineHelpState?0:1;this.updateHelpDisplayHandler_();return!1};a.pkp.controllers.SiteHandler.prototype.updateHelpDisplayHandler_=function(){var a;a=this.getHtmlElement();this.options_.inlineHelpState?(a.find(".pkp_grid_description, #legend, .pkp_help").css("visibility","visible").show(),a.find('[id^="toggleHelp"]').html(this.options_.toggleHelpOffText)):(a.find(".pkp_grid_description, #legend, .pkp_help").hide(),a.find('[id^="toggleHelp"]').html(this.options_.toggleHelpOnText))};a.pkp.controllers.SiteHandler.prototype.fetchNotificationHandler_=
function(b,c,d){void 0!==d?this.showNotification_(d):a.ajax({url:this.options_.fetchNotificationUrl,data:this.options_.requestOptions,success:this.callbackWrapper(this.showNotificationResponseHandler_),dataType:"json",async:!1})};a.pkp.controllers.SiteHandler.prototype.updateHeaderHandler_=function(){a.pkp.classes.Handler.getHandler(a("#navigationUserWrapper")).reload()};a.pkp.controllers.SiteHandler.prototype.callWhenClickOutsideHandler_=function(a,c,d){void 0!==d.container&&void 0!==d.callback&&
(a=d.container.attr("id"),this.outsideClickChecks_[a]=d)};a.pkp.controllers.SiteHandler.prototype.mouseDownHandler_=function(b,c){var d;if(!a.isEmptyObject(this.outsideClickChecks_))for(d in this.outsideClickChecks_)this.processOutsideClickCheck_(this.outsideClickChecks_[d],c);return!0};a.pkp.controllers.SiteHandler.prototype.processOutsideClickCheck_=function(a,c){if("click"!==c.type&&"mousedown"!==c.type&&"mouseup"!==c.type)throw Error("Can not check outside click with the passed event: "+c.type+
".");var d=a.container;return d.is(":hidden")||void 0!==a.skipWhenVisibleModals&&a.skipWhenVisibleModals&&0<this.getHtmlElement().find("div.ui-dialog").length?!1:0===d.has(c.target).length?(delete this.outsideClickChecks_[d.attr("id")],a.callback(),!0):!1};a.pkp.controllers.SiteHandler.prototype.pageUnloadHandler_=function(){var b,c,d;b=a.pkp.classes.Handler.getHandler(a("body"));c=0;for(d in b.unsavedFormElements_)d&&c++;if(0<c)return a.pkp.locale.form_dataHasChanged};a.pkp.controllers.SiteHandler.prototype.isFormUnsaved=
function(a){return null!==this.unsavedFormElements_&&void 0!==this.unsavedFormElements_[a]?!0:!1};a.pkp.controllers.SiteHandler.prototype.showNotificationResponseHandler_=function(a,c){this.showNotification_(c)};a.pkp.controllers.SiteHandler.prototype.showNotification_=function(a){var c,d,a=this.handleJson(a);if(!1!==a&&a.content.general)for(c in a=a.content.general,a)for(d in a[c])new PNotify(a[c][d])};a.pkp.controllers.SiteHandler.prototype.openModal_=function(){this.getHtmlElement().addClass("modal_is_visible")};
a.pkp.controllers.SiteHandler.prototype.closeModal_=function(){var a=this.getHtmlElement();a.find(".pkp_modal.is_visible").length||a.removeClass("modal_is_visible")}})(jQuery);(function(a){a.pkp.controllers.UrlInDivHandler=function(a,c){this.parent(a,c);this.sourceUrl_=c.sourceUrl;this.reload()};a.pkp.classes.Helper.inherits(a.pkp.controllers.UrlInDivHandler,a.pkp.classes.Handler);a.pkp.controllers.UrlInDivHandler.sourceUrl_=null;a.pkp.controllers.UrlInDivHandler.prototype.reload=function(){a.get(this.sourceUrl_,this.callbackWrapper(this.handleLoadedContent_),"json")};a.pkp.controllers.UrlInDivHandler.prototype.getSourceUrl=function(){return this.sourceUrl_};a.pkp.controllers.UrlInDivHandler.prototype.setSourceUrl=
function(a){this.sourceUrl_=a};a.pkp.controllers.UrlInDivHandler.prototype.handleLoadedContent_=function(a,c){var d=this.handleJson(c);!0===d.status?void 0===d.content?this.getHtmlElement().hide():(/msie/.test(navigator.userAgent.toLowerCase())?this.getHtmlElement().html(d.content):this.getHtmlElement().hide().html(d.content).fadeIn(400),this.trigger("urlInDivLoaded",[this.getHtmlElement().attr("id")])):alert(d.content);return!1}})(jQuery);(function(a){a.pkp.controllers.ExtrasOnDemandHandler=function(b,c){this.parent(b,c);a(".toggleExtras",b).show().click(this.callbackWrapper(this.toggleExtras));this.deactivateExtraContent_()};a.pkp.classes.Helper.inherits(a.pkp.controllers.ExtrasOnDemandHandler,a.pkp.classes.Handler);a.pkp.controllers.ExtrasOnDemandHandler.prototype.toggleExtras=function(b){var c=this.getHtmlElement();a(b,c).hasClass("active")?this.deactivateExtraContent_("slow"):this.activateExtraContent_("slow")};a.pkp.controllers.ExtrasOnDemandHandler.prototype.activateExtraContent_=
function(b){var c;c=this.getHtmlElement();a(".toggleExtras .toggleExtras-inactive",c).hide();a(".extrasContainer",c).show(b);a(".toggleExtras .toggleExtras-active",c).show();a(".toggleExtras",c).removeClass("inactive").addClass("active");a(".ui-icon",c).removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-s");b=c.closest(".scrollable");0<b.size()&&this.scrollToMakeVisible_(c,b)};a.pkp.controllers.ExtrasOnDemandHandler.prototype.deactivateExtraContent_=function(b){var c=this.getHtmlElement();
a(".extrasContainer",c).hide(b);a(".toggleExtras .toggleExtras-active",c).hide();a(".toggleExtras .toggleExtras-inactive",c).show();a(".toggleExtras",c).removeClass("active").addClass("inactive");a(".ui-icon",c).removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e")};a.pkp.controllers.ExtrasOnDemandHandler.prototype.scrollToMakeVisible_=function(a,c){var d,e,f;d=a.position().top;e=c.position().top;f=parseInt(c.scrollTop(),10);d>e?(d=Math.ceil(d+a.height()-c.height()),0<d&&c.scrollTop(f+
d)):(f=Math.max(Math.floor(f+d-e),0),c.scrollTop(f))}})(jQuery);(function(a){a.pkp.controllers.PageHandler=function(a,c){this.parent(a,c);this.bind("redirectRequested",this.redirectToUrl);this.bind("notifyUser",this.redirectNotifyUserEventHandler_);this.bind("redirectDataChangedToGrid",this.redirectDataChangedEventHandler_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.PageHandler,a.pkp.classes.Handler);a.pkp.controllers.PageHandler.prototype.redirectToUrl=function(a,c,d){window.location=d};a.pkp.controllers.PageHandler.prototype.redirectNotifyUserEventHandler_=
function(b,c,d){!0===d.status?this.getHtmlElement().parent().trigger("notifyUser",[d]):a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent(this,d)};a.pkp.controllers.PageHandler.prototype.redirectDataChangedEventHandler_=function(b,c,d){var b=a("a",c.target),e=a.pkp.classes.Handler.getHandler(b).getUrl(),b=a(".pkp_controllers_grid",this.getHtmlElement()).filter(function(){var b=0;a(this).find("a").each(function(){a(this).attr("href")==e&&b++});return 0<b});0<b.length&&b.each(function(){a(this).trigger("dataChanged",
[d])})}})(jQuery);(function(a){a.pkp.controllers.TabHandler=function(a,c){var d,e,f;this.parent(a,c);this.bind("tabsbeforeactivate",this.tabsBeforeActivate);this.bind("tabsactivate",this.tabsActivate);this.bind("tabscreate",this.tabsCreate);this.bind("tabsbeforeload",this.tabsBeforeLoad);this.bind("tabsload",this.tabsLoad);this.bind("containerReloadRequested",this.tabsReloadRequested);this.bind("addTab",this.addTab);c.emptyLastTab&&(this.emptyLastTab_=c.emptyLastTab);d=document.location.toString();if(d.match("#")){d=
d.split("#")[1];e=a.find("li a");for(f=0;f<e.length;f++)d==e[f].getAttribute("name")&&(c.selected=f)}a.tabs({ajaxOptions:{cache:!1,dataFilter:this.callbackWrapper(this.dataFilter)},disabled:c.disabled,active:c.selected})};a.pkp.classes.Helper.inherits(a.pkp.controllers.TabHandler,a.pkp.classes.Handler);a.pkp.controllers.TabHandler.prototype.$currentTab_=null;a.pkp.controllers.TabHandler.prototype.currentTabIndex_=0;a.pkp.controllers.TabHandler.prototype.emptyLastTab_=!1;a.pkp.controllers.TabHandler.prototype.tabsBeforeActivate=
function(){var b=!1;this.$currentTab_.find("form").each(function(){if(a.pkp.classes.Handler.getHandler(a("#"+a(this).attr("id"))).formChangesTracked)return b=!0,!1});this.$currentTab_.find(".hasDatepicker").datepicker("hide");if(b)if(confirm(a.pkp.locale.form_dataHasChanged))this.trigger("unregisterAllForms");else return!1;this.emptyLastTab_&&(a(window).one("error",function(){return!1}),this.$currentTab_&&this.$currentTab_.empty());return!0};a.pkp.controllers.TabHandler.prototype.tabsCreate=function(b,
c,d){this.currentTabIndex_=d.tab.index();this.$currentTab_=d.panel.jquery?d.panel:a(d.panel);return!0};a.pkp.controllers.TabHandler.prototype.tabsActivate=function(b,c,d){this.currentTabIndex_=d.newTab.index();this.$currentTab_=d.newPanel.jquery?d.newPanel:a(d.newPanel);return!0};a.pkp.controllers.TabHandler.prototype.tabsLoad=function(){return!0};a.pkp.controllers.TabHandler.prototype.tabsBeforeLoad=function(a,c,d){d.ajaxSettings.cache=!1;d.ajaxSettings.dataFilter=this.callbackWrapper(this.dataFilter)};
a.pkp.controllers.TabHandler.prototype.dataFilter=function(b,c){var d=this.handleJson(a.parseJSON(c));return!1===d?"":d.content};a.pkp.controllers.TabHandler.prototype.tabsReloadRequested=function(b,c,d){var e=this.getHtmlElement();a.get(d.tabsUrl,function(b){b=a.parseJSON(b);e.replaceWith(b.content)})};a.pkp.controllers.TabHandler.prototype.addTab=function(b,c,d){var e=this.getHtmlElement(),b=e.children("ul").children("li").length+1,c=a("<a/>").text(d.title).attr("href",d.url),d=a("<a/>").addClass("close").text(a.pkp.locale.common_close).attr("href",
"#"),c=a("<li/>").append(c).append(d);d.click(function(){var b=a(this).closest("li"),c=a("#"+b.attr("aria-controls")),d,j;j=!1;c.find("form").each(function(){if(a.pkp.classes.Handler.getHandler(a(this)).formChangesTracked&&!confirm(a.pkp.locale.form_dataHasChanged))return j=!0,!1});j||(c.find("form").each(function(){var b=a.pkp.classes.Handler.getHandler(a(this));b&&b.unregisterForm()}),d=b.eq(0).index(),e.tabs("option","active")==d&&e.tabs("option","active",d-1),b.remove(),c.remove(),e.tabs("refresh"))});
e.children("ul").append(c);e.tabs("refresh");e.tabs("option","active",b-1)};a.pkp.controllers.TabHandler.prototype.getCurrentTab=function(){return this.$currentTab_};a.pkp.controllers.TabHandler.prototype.getCurrentTabIndex=function(){return this.currentTabIndex_}})(jQuery);(function(a){a.pkp.controllers.MenuHandler=function(a,c){this.parent(a,c);this.$links_=this.getHtmlElement().find("a");this.$links_.bind("focus",this.onFocus);this.$links_.bind("blur",this.onBlur)};a.pkp.classes.Helper.inherits(a.pkp.controllers.MenuHandler,a.pkp.classes.Handler);a.pkp.controllers.MenuHandler.prototype.onFocus=function(b){b=a(b.target).parents("li");b.length&&b.addClass("in_focus")};a.pkp.controllers.MenuHandler.prototype.onBlur=function(b){b=a(b.target).parents("li");b.length&&b.removeClass("in_focus")}})(jQuery);(function(a){a.pkp.controllers.UploaderHandler=function(b,c){this.parent(b,c);if(!b.is("div"))throw Error("An uploader widget controller can only be attached to a div!");var d=a.extend({},this.self("DEFAULT_PROPERTIES_"),{url:c.uploadUrl,flash_swf_url:c.baseUrl+"/lib/pkp/lib/vendor/moxiecode/plupload/js/Moxie.swf",silverlight_xap_url:c.baseUrl+"/lib/pkp/lib/vendor/moxiecode/plupload/js/Moxie.xap"});b.plupload(d);d=b.plupload("getUploader");d.refresh();/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)||
b.find("div.plupload").css("z-index",99999);b.find("div.plupload input").css("z-index",99999);d.bind("FilesAdded",this.callbackWrapper(this.limitQueueSize));d.bind("QueueChanged",this.callbackWrapper(this.refreshUploader))};a.pkp.classes.Helper.inherits(a.pkp.controllers.UploaderHandler,a.pkp.classes.Handler);a.pkp.controllers.UploaderHandler.prototype.limitQueueSize=function(a,c){1<c.files.length&&(c.splice(0,1),c.refresh())};a.pkp.controllers.UploaderHandler.prototype.refreshUploader=function(a,
c){c.refresh()};a.pkp.controllers.UploaderHandler.DEFAULT_PROPERTIES_={runtimes:"html5, flash, silverlight",max_file_size:a.pkp.cons.UPLOAD_MAX_FILESIZE,multi_selection:!1,file_data_name:"uploadedFile",multipart:!0,headers:{browser_user_agent:navigator.userAgent}}})(jQuery);(function(a){a.pkp.controllers.AutocompleteHandler=function(b,c){var d;this.parent(b,c);this.sourceUrl_=c.sourceUrl;c.sourceUrl=void 0;this.jLabelText_=c.jLabelText;this.disableSync_=c.disableSync;d={};d.source=this.callbackWrapper(this.fetchAutocomplete);d.appendTo="#"+b.attr("id");d=a.extend({},this.self("DEFAULT_PROPERTIES_"),d,c);this.textInput=b.find(":text");this.disableSync_||this.textInput.keyup(this.callbackWrapper(this.synchronizeFields_));this.textInput.autocomplete(d);this.textInput.attr("title",
this.jLabelText_);a("#"+this.textInput.attr("id")).jLabel();this.textInput.attr("title","");this.textLabel_=b.find("label");this.hiddenInput_=b.find("input:hidden");this.bind("autocompleteselect",this.itemSelected);this.bind("autocompletefocus",this.itemFocused);this.textInput.blur(this.callbackWrapper(this.textInputBlurHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.AutocompleteHandler,a.pkp.classes.Handler);a.pkp.controllers.AutocompleteHandler.textLabel_=null;a.pkp.controllers.AutocompleteHandler.jLabelText_=
null;a.pkp.controllers.AutocompleteHandler.disableSync_=null;a.pkp.controllers.AutocompleteHandler.DEFAULT_PROPERTIES_={minLength:2};a.pkp.controllers.AutocompleteHandler.prototype.hiddenInput_=null;a.pkp.controllers.AutocompleteHandler.prototype.sourceUrl_=null;a.pkp.controllers.AutocompleteHandler.prototype.textInput=null;a.pkp.controllers.AutocompleteHandler.prototype.itemSelected=function(a,c,d){a=this.hiddenInput_;c=this.textInput;""!==d.item.value&&(a.val(d.item.value),c.val(d.item.label),c.trigger("keyup"));
return!1};a.pkp.controllers.AutocompleteHandler.prototype.itemFocused=function(a,c,d){a=this.textInput;""!==d.item.value&&a.val(d.item.label);return!1};a.pkp.controllers.AutocompleteHandler.prototype.fetchAutocomplete=function(b,c,d){var e;e=this.textInput;e.addClass("spinner");a.post(this.getAutocompleteUrl(),{term:c.term},function(a){e.removeClass("spinner");d(a.content)},"json")};a.pkp.controllers.AutocompleteHandler.prototype.getAutocompleteUrl=function(){return this.sourceUrl_};a.pkp.controllers.AutocompleteHandler.prototype.setAutocompleteUrl=
function(a){this.sourceUrl_=a};a.pkp.controllers.AutocompleteHandler.prototype.textInputBlurHandler_=function(){""===this.hiddenInput_.val()&&this.textInput.val("")};a.pkp.controllers.AutocompleteHandler.prototype.synchronizeFields_=function(){this.hiddenInput_.val(String(this.textInput.val()))}})(jQuery);(function(a){a.pkp.controllers.RangeSliderHandler=function(b,c){this.parent(b,c);if(!c.min||!c.max)throw Error('The "min" and "max"settings are required in a RangeSliderHandler');this.slider_=b.children(".pkp_controllers_rangeSlider_slider");this.label_=b.find(".pkp_controllers_rangeSlider_sliderValue");var d={};d.min=c.min;d.max=c.max;d.values=[c.min,c.max];d=a.extend({},this.self("DEFAULT_PROPERTIES_"),d);this.slider_.slider(d);this.bind("slide",this.sliderAdjusted)};a.pkp.classes.Helper.inherits(a.pkp.controllers.RangeSliderHandler,
a.pkp.classes.Handler);a.pkp.controllers.RangeSliderHandler.slider_=null;a.pkp.controllers.RangeSliderHandler.label_=null;a.pkp.controllers.RangeSliderHandler.DEFAULT_PROPERTIES_={range:!0};a.pkp.controllers.RangeSliderHandler.prototype.sliderAdjusted=function(b,c,d){this.label_.val(d.values[0]+" - "+d.values[1]);a(b).children(".pkp_controllers_rangeSlider_minInput").val(d.values[0]);a(b).children(".pkp_controllers_rangeSlider_maxInput").val(d.values[1])}})(jQuery);(function(a){a.pkp.controllers.NotificationHandler=function(a,c){this.parent(a,c);this.options_=c;this.bind("notifyUser",this.fetchNotificationHandler_);this.getHtmlElement().hide();this.getHtmlElement().triggerHandler("notifyUser")};a.pkp.classes.Helper.inherits(a.pkp.controllers.NotificationHandler,a.pkp.classes.Handler);a.pkp.controllers.NotificationHandler.prototype.options_=null;a.pkp.controllers.NotificationHandler.prototype.trivialTimer_=null;a.pkp.controllers.NotificationHandler.prototype.fetchNotificationHandler_=
function(){var b={};b.requestOptions=this.options_.requestOptions;a.ajax({type:"POST",url:this.options_.fetchNotificationUrl,data:b,success:this.callbackWrapper(this.showNotificationResponseHandler_),dataType:"json",async:!1})};a.pkp.controllers.NotificationHandler.prototype.showNotificationResponseHandler_=function(b,c){clearTimeout(this.trivialTimer_);var d=this.getHtmlElement(),e=this.handleJson(c),f,g,h;if(!1!==e)if(e.content.inPlace){f=this.concatenateNotifications_(e.content.inPlace);g=this.removeAlreadyShownNotifications_(e);
d.html(f);d.show();e=this.getTrivialNotifications_(e.content.inPlace);if(!this.visibleWithoutScrolling_()&&g)for(h in d.parent().trigger("notifyUser",[g]),e)g=e[h],a("#pkp_notification_"+g,this.getHtmlElement()).remove();0===d.children().length?d.hide():this.addTimerToNotifications(e)}else this.getHtmlElement().empty(),this.getHtmlElement().hide()};a.pkp.controllers.NotificationHandler.prototype.visibleWithoutScrolling_=function(){var b=this.getHtmlElement(),c=b.offset().top+this.getHtmlElement().height()/
2,d=a(window).scrollTop(),e=d+a(window).height(),f=b.parents(".ui-dialog-content");return 0<f.length&&(b=f.offset().top,f=b+f.height(),c<b||c>f)?!1:c<d||c>e?!1:!0};a.pkp.controllers.NotificationHandler.prototype.removeAlreadyShownNotifications_=function(b){var c=!0,d,e,f;for(d in b.content.inPlace)for(e in b.content.inPlace[d])f=a("#pkp_notification_"+e),0<f.length?(delete b.content.inPlace[d][e],delete b.content.general[d][e]):c=!1;return c?!1:b};a.pkp.controllers.NotificationHandler.prototype.concatenateNotifications_=
function(a){var c="",d,e;for(d in a)for(e in a[d])c+=a[d][e];return c};a.pkp.controllers.NotificationHandler.prototype.getTrivialNotifications_=function(a){var c=[],d,e;for(d in a)if(1==d)for(e in a[d])c.push(e);return c};a.pkp.controllers.NotificationHandler.prototype.addTimerToNotifications=function(b){var c=function(){a(this).remove()};b.length&&(this.trivialTimer_=setTimeout(function(){var d,e;for(d in b)e=a("#pkp_notification_"+b[d]),e.fadeOut(400,c())},6E3))}})(jQuery);(function(a){a.pkp.controllers.form=a.pkp.controllers.form||{};a.pkp.controllers.form.FormHandler=function(b,c){var d;this.parent(b,c);if(!b.is("form"))throw Error("A form handler controller can only be bound to an HTML form element!");c.submitHandler&&(this.callerSubmitHandler_=c.submitHandler);a(".datepicker").datepicker({dateFormat:"yy-mm-dd"});c.cancelRedirectUrl&&(this.cancelRedirectUrl_=c.cancelRedirectUrl);"undefined"!==typeof c.trackFormChanges&&(this.trackFormChanges=c.trackFormChanges);
c.disableControlsOnSubmit&&(this.disableControlsOnSubmit=c.disableControlsOnSubmit);c.enableDisablePairs&&(this.enableDisablePairs_=c.enableDisablePairs,this.setupEnableDisablePairs());for(d in this.enableDisablePairs_)b.find("[id^='"+d+"']").trigger("updatePair");c.fetchUsernameSuggestionUrl&&c.usernameSuggestionTextAlert&&(this.fetchUsernameSuggestionUrl_=c.fetchUsernameSuggestionUrl,this.usernameSuggestionTextAlert_=c.usernameSuggestionTextAlert);d=b.validate({onfocusout:this.callbackWrapper(this.onFocusOutValidation_),
errorClass:"error",highlight:function(b,c){a(b).parent().parent().addClass(c)},unhighlight:function(b,c){a(b).parent().parent().removeClass(c)},submitHandler:this.callbackWrapper(this.submitHandler_),showErrors:this.callbackWrapper(this.showErrors)});a("[id^='cancelFormButton-']",b).click(this.callbackWrapper(this.cancelForm));a("#resetFormButton",b).click(this.callbackWrapper(this.resetForm));b.find(".showMore, .showLess").bind("click",this.switchViz);a('[id^="suggestUsernameButton"]',b).click(this.callbackWrapper(this.generateUsername));
d.checkForm()?this.trigger("formValid"):this.trigger("formInvalid");this.initializeTinyMCE();a("[id^='submitFormButton']",b).click(this.callbackWrapper(this.pushTinyMCEChanges_));a(":input",b).change(this.callbackWrapper(this.formChange));this.bind("formChange",this.callbackWrapper(this.formChange));b.click(this.callbackWrapper(this.hideDatepicker_));this.publishEvent("tinyMCEInitialized");this.bind("tinyMCEInitialized",this.tinyMCEInitHandler_);this.bind("containerClose",this.containerCloseHandler)};
a.pkp.classes.Helper.inherits(a.pkp.controllers.form.FormHandler,a.pkp.classes.Handler);a.pkp.controllers.form.FormHandler.prototype.disableControlsOnSubmit=!1;a.pkp.controllers.form.FormHandler.prototype.trackFormChanges=!0;a.pkp.controllers.form.FormHandler.prototype.callerSubmitHandler_=null;a.pkp.controllers.form.FormHandler.prototype.cancelRedirectUrl_=null;a.pkp.controllers.form.FormHandler.prototype.formChangesTracked=!1;a.pkp.controllers.form.FormHandler.prototype.enableDisablePairs_=null;
a.pkp.controllers.form.FormHandler.prototype.fetchUsernameSuggestionUrl_="";a.pkp.controllers.form.FormHandler.prototype.usernameSuggestionTextAlert_="";a.pkp.controllers.form.FormHandler.prototype.showErrors=function(b){"undefined"!==typeof tinyMCE&&tinyMCE.EditorManager.triggerSave();var c=a.extend(!0,{},b);setTimeout(this.callbackWrapper(function(){c.defaultShowErrors();c=null}),250);b.checkForm()?this.trigger("formValid"):(this.trigger("formInvalid"),this.enableFormControls())};a.pkp.controllers.form.FormHandler.prototype.formChange=
function(){this.trackFormChanges&&!this.formChangesTracked&&(this.formChangesTracked=!0,this.trigger("formChanged"))};a.pkp.controllers.form.FormHandler.prototype.disableFormControls=function(){this.disableControlsOnSubmit&&this.getHtmlElement().find(":submit").attr("disabled","disabled").addClass("ui-state-disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.enableFormControls=function(){this.getHtmlElement().find(":submit").removeAttr("disabled").removeClass("ui-state-disabled");return!0};
a.pkp.controllers.form.FormHandler.prototype.cancelForm=function(){this.unregisterForm();this.trigger("formCanceled");return!1};a.pkp.controllers.form.FormHandler.prototype.unregisterForm=function(){this.formChangesTracked=!1;this.trigger("unregisterChangedForm")};a.pkp.controllers.form.FormHandler.prototype.resetForm=function(){this.formChangesTracked=!1;this.trigger("unregisterChangedForm");this.getHtmlElement().each(function(){this.reset()});return!1};a.pkp.controllers.form.FormHandler.prototype.setupEnableDisablePairs=
function(){var b=this.getHtmlElement(),c;for(c in this.enableDisablePairs_)a(b).find("[id^='"+c+"']").bind("click updatePair",this.callbackWrapper(this.toggleDependentElement_));return!0};a.pkp.controllers.form.FormHandler.prototype.submitFormWithoutValidation=function(a){a.settings.submitHandler=null;this.disableFormControls();this.getHtmlElement().submit();this.formChangesTracked=!1};a.pkp.controllers.form.FormHandler.prototype.generateUsername=function(b,c){c.preventDefault();var d=this.getHtmlElement(),
e;""===a('[name="lastName"]',d).val()?alert(this.usernameSuggestionTextAlert_):(e=a('[name="firstName"]',d).val(),d=a('[name="lastName"]',d).val(),e=this.fetchUsernameSuggestionUrl_.replace("FIRST_NAME_DUMMY",e).replace("LAST_NAME_DUMMY",d),a.get(e,this.callbackWrapper(this.setUsername),"json"))};a.pkp.controllers.form.FormHandler.prototype.setUsername=function(b,c){var d=this.handleJson(c),e=this.getHtmlElement();if(!1===d)throw Error("JSON response must be set to true!");a('[id^="username"]',e).val(d.content).trigger("blur")};
a.pkp.controllers.form.FormHandler.prototype.hideSpinner=function(){this.getHtmlElement().find(".formButtons .pkp_spinner").removeClass("is_visible")};a.pkp.controllers.form.FormHandler.prototype.submitHandler_=function(b,c){var d=!1;a(c).find(".formWidget").each(function(){var b=new a.Event("formSubmitRequested");d||(a(this).trigger(b),d=b.isDefaultPrevented())});d||(this.showSpinner_(),this.trigger("unregisterChangedForm"),null!==this.callerSubmitHandler_?(this.formChangesTracked=!1,this.callbackWrapper(this.callerSubmitHandler_).call(b,
c)):this.submitFormWithoutValidation(b))};a.pkp.controllers.form.FormHandler.prototype.pushTinyMCEChanges_=function(){"undefined"!==typeof tinyMCE&&tinyMCE.EditorManager.triggerSave();return!0};a.pkp.controllers.form.FormHandler.prototype.toggleDependentElement_=function(b){var c,d;c=this.getHtmlElement();d=a(b).attr("id");c=a(c).find("[id^='"+this.enableDisablePairs_[d]+"']");a(b).is(":checked")?a(c).prop("disabled",!1):a(c).prop("disabled",!0);return!0};a.pkp.controllers.form.FormHandler.prototype.tinyMCEInitHandler_=
function(b,c,d){var e=d.id;d.on("blur",this.callbackWrapper(function(b){b.save();var b=this.getHtmlElement(),c=a("#"+e,b);b.validate().element(c)}))};a.pkp.controllers.form.FormHandler.prototype.containerCloseHandler=function(){a(this.getHtmlElement()).find(".hasDatepicker").datepicker("hide");if(this.formChangesTracked)if(confirm(a.pkp.locale.form_dataHasChanged))this.trigger("unregisterAllForms");else return!1;return!0};a.pkp.controllers.form.FormHandler.prototype.onFocusOutValidation_=function(b,
c){var d=this.getHtmlElement();a(c).parents("#"+d.attr("id")).length&&b.element(c);return!0};a.pkp.controllers.form.FormHandler.prototype.hideDatepicker_=function(b,c){var d,e;d=c.originalEvent.target;e=this.getHtmlElement();!a(d).hasClass("hasDatepicker")&&(!a(d).hasClass("ui-datepicker")&&!a(d).hasClass("ui-icon")&&!a(d).hasClass("ui-datepicker-next")&&!a(d).hasClass("ui-datepicker-prev")&&!a(d).parent().parents(".ui-datepicker").length)&&a(e).find(".hasDatepicker").datepicker("hide")};a.pkp.controllers.form.FormHandler.prototype.showSpinner_=
function(){this.getHtmlElement().find(".formButtons .pkp_spinner").addClass("is_visible")}})(jQuery);(function(a){a.pkp.controllers.form.DropdownHandler=function(a,c){this.parent(a,c);this.eventName_=c.eventName;this.defaultKey_=c.defaultKey;this.publishEvent(this.eventName_);this.getOptionsUrl_=c.getOptionsUrl;this.trackFormChanges=!1;a.find("select").change(this.callbackWrapper(this.selectOptionHandler_));this.loadOptions_();this.bind("containerReloadRequested",this.containerReloadHandler_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.DropdownHandler,a.pkp.classes.Handler);a.pkp.controllers.form.DropdownHandler.prototype.eventName_=
null;a.pkp.controllers.form.DropdownHandler.prototype.defaultKey_=null;a.pkp.controllers.form.DropdownHandler.prototype.currentKey_=null;a.pkp.controllers.form.DropdownHandler.prototype.getOptionsUrl_=null;a.pkp.controllers.form.DropdownHandler.prototype.selectOptionHandler_=function(b){this.trigger(this.eventName_,[a(b).val()])};a.pkp.controllers.form.DropdownHandler.prototype.loadOptions_=function(){a.get(this.getOptionsUrl_,this.callbackWrapper(this.setOptionList_),"json")};a.pkp.controllers.form.DropdownHandler.prototype.setOptionList_=
function(b,c){var d=this.handleJson(c),e=this.getHtmlElement().find("select"),f,g;for(f in d.content){g=a("<option/>");g.attr("value",f);if(this.defaultKey_==f||this.currentKey_==f)g.attr("selected","selected"),this.trigger(this.eventName_,[f]);g.text(d.content[f]);e.append(g)}this.trigger("dropDownOptionSet")};a.pkp.controllers.form.DropdownHandler.prototype.containerReloadHandler_=function(){var a=this.getHtmlElement().find("select");this.currentKey_=a.find("option:selected").attr("value");a.find('option[value!="0"]').remove();
this.loadOptions_()}})(jQuery);(function(a){a.pkp.controllers.form.AjaxFormHandler=function(a,c){c.submitHandler=this.submitForm;this.parent(a,c);this.bind("refreshForm",this.refreshFormHandler_);this.publishEvent("containerReloadRequested")};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.AjaxFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.controllers.form.AjaxFormHandler.prototype.disableControlsOnSubmit=!0;a.pkp.controllers.form.AjaxFormHandler.prototype.submitForm=function(){var b=this.getHtmlElement();this.disableFormControls();
a.post(b.attr("action"),b.serialize(),this.callbackWrapper(this.handleResponse),"json")};a.pkp.controllers.form.AjaxFormHandler.prototype.refreshFormHandler_=function(a,c,d){d&&this.getHtmlElement().replaceWith(d)};a.pkp.controllers.form.AjaxFormHandler.prototype.handleResponse=function(b,c){var d,e;e=this.handleJson(c);if(!1!==e)if(""===e.content)d=new a.Event("formSubmitted"),a(this.getHtmlElement()).find(".formWidget").trigger(d),this.trigger("formSubmitted"),this.publishChangeEvents(),this.disableControlsOnSubmit&&
this.enableFormControls();else{if(void 0!==e.reloadContainer)return this.trigger("dataChanged"),this.trigger("containerReloadRequested",[e]),e.status;d=this.getHtmlElement();d.replaceWith(e.content)}else this.enableFormControls();this.trigger("notifyUser",[this.getHtmlElement()]);this.hideSpinner();return e.status}})(jQuery);(function(a){a.pkp.controllers.form.ClientFormHandler=function(a,c){c.submitHandler=this.submitForm;this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.ClientFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.controllers.form.ClientFormHandler.prototype.submitForm=function(){var b;b=this.getHtmlElement().serializeArray();b.push({name:"clientSubmit",value:!0});this.trigger("formSubmitted",[a.param(b)])}})(jQuery);(function(a){a.pkp.controllers.form.ToggleFormHandler=function(a){this.parent(a,{trackFormChanges:!1});a.change(this.callbackWrapper(this.toggleHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.ToggleFormHandler,a.pkp.controllers.form.ClientFormHandler);a.pkp.controllers.form.ToggleFormHandler.prototype.toggleHandler_=function(){this.getHtmlElement().submit();return!0}})(jQuery);(function(a){a.pkp.controllers.form.FileUploadFormHandler=function(a,c){this.parent(a,c);void 0!==c.resetUploader&&(this.resetUploader_=c.resetUploader);this.attachUploader_(c.$uploader,c.uploaderOptions);this.uploaderSetup(c.$uploader)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.FileUploadFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.form.FileUploadFormHandler.prototype.resetUploader_=!1;a.pkp.controllers.form.FileUploadFormHandler.prototype.handleResponse=function(b,
c){var d;this.resetUploader_&&(d=a("#plupload",this.getHtmlElement()).plupload("getUploader"),d.splice(),d.refresh(),a("#temporaryFileId",this.getHtmlElement()).val(""));return this.parent("handleResponse",b,c)};a.pkp.controllers.form.FileUploadFormHandler.prototype.uploaderSetup=function(a){a.plupload("getUploader").bind("FileUploaded",this.callbackWrapper(this.handleUploadResponse))};a.pkp.controllers.form.FileUploadFormHandler.prototype.handleUploadResponse=function(b,c,d,e){b=this.handleJson(a.parseJSON(e.response));
!1!==b&&(this.trigger("fileUploaded",[b.uploadedFile]),""===b.content?(c=this.getHtmlElement(),c=c.find("#temporaryFileId"),c.val(b.temporaryFileId)):this.getHtmlElement().replaceWith(b.content))};a.pkp.controllers.form.FileUploadFormHandler.prototype.attachUploader_=function(a,c){a.pkpHandler("$.pkp.controllers.UploaderHandler",c)}})(jQuery);(function(a){a.pkp.controllers.form.MultilingualInputHandler=function(a,c){this.parent(a,c);var d=null,d=a.hasClass("pkpTagit")?a.find(":input").filter(":visible"):a.find(":input").first();d.focus(this.callbackWrapper(this.focusHandler_));a.find(":input").blur(this.callbackWrapper(this.blurHandler_));this.publishEvent("tinyMCEInitialized");this.tinyMCEInitHandler_()};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.MultilingualInputHandler,a.pkp.classes.Handler);a.pkp.controllers.form.MultilingualInputHandler.prototype.focusHandler_=
function(){this.showPopover_()};a.pkp.controllers.form.MultilingualInputHandler.prototype.blurHandler_=function(){setTimeout(this.callbackWrapper(function(){this.hasElementInFocus_()||this.hidePopover_()}),0);return!0};a.pkp.controllers.form.MultilingualInputHandler.prototype.hidePopover_=function(){var a=this.getHtmlElement();a.removeClass("localization_popover_container_focus");a.find(".localization_popover").hide()};a.pkp.controllers.form.MultilingualInputHandler.prototype.showPopover_=function(){var a=
this.getHtmlElement();a.addClass("localization_popover_container_focus");a.find(".localization_popover").width(a.width());a.find(".localization_popover").show()};a.pkp.controllers.form.MultilingualInputHandler.prototype.hasElementInFocus_=function(){return this.getHtmlElement().has(document.activeElement).length?!0:!1};a.pkp.controllers.form.MultilingualInputHandler.prototype.tinyMCEInitHandler_=function(){if(this.getHtmlElement().find(".richContent").length){var b=this.getHtmlElement(),c=tinyMCE.EditorManager.get(b.find("textarea").first().attr("id"));
c.on("focus",this.callbackWrapper(function(){this.trigger("callWhenClickOutside",{container:this.getHtmlElement(),callback:this.callbackWrapper(this.hidePopover_),skipWhenVisibleModals:!1});this.showPopover_()}));c.on("blur",this.callbackWrapper(function(){if(a(c.getContainer()).find("iframe").attr("id")==a(document.activeElement).attr("id"))return!1;setTimeout(this.callbackWrapper(function(){this.hasElementInFocus_()||this.hidePopover_()}),0)}))}}})(jQuery);(function(a){a.pkp.controllers.form.CancelActionAjaxFormHandler=function(a,c){this.parent(a,c);this.cancelUrl_=c.cancelUrl};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.CancelActionAjaxFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.form.CancelActionAjaxFormHandler.prototype.cancelUrl_=null;a.pkp.controllers.form.CancelActionAjaxFormHandler.prototype.isComplete_=!1;a.pkp.controllers.form.CancelActionAjaxFormHandler.prototype.containerCloseHandler=function(b,c){!this.isComplete_&&
null!==this.cancelUrl_&&a.post(this.cancelUrl_);return this.parent("containerCloseHandler",b,c)};a.pkp.controllers.form.CancelActionAjaxFormHandler.prototype.submitForm=function(a,c){this.isComplete_=!0;this.parent("submitForm",a,c)}})(jQuery);(function(a){a.pkp.controllers.form.reviewer=a.pkp.controllers.form.reviewer||{};a.pkp.controllers.form.reviewer.ReviewerReviewStep3FormHandler=function(a,c){this.parent(a,c);a.find("[id^='submitFormButton-']").click(this.callbackWrapper(this.updateCommentsRequired_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.reviewer.ReviewerReviewStep3FormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.form.reviewer.ReviewerReviewStep3FormHandler.prototype.updateCommentsRequired_=function(){var b=
this.getHtmlElement().find('[id^="comments"]');1==a("#reviewAttachmentsGridContainer").find("tbody.empty:visible").length?b.attr("required","1"):b.removeAttr("required");return!0}})(jQuery);(function(a){a.pkp.controllers.grid=a.pkp.controllers.grid||{};a.pkp.controllers.grid.GridHandler=function(a,c){this.parent(a,c);this.initialize(c);this.initFeatures_(c.features)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.GridHandler,a.pkp.classes.Handler);a.pkp.controllers.grid.GridHandler.FETCH_ALL_ROWS_ID={};a.pkp.controllers.grid.GridHandler.prototype.bodySelector=null;a.pkp.controllers.grid.GridHandler.prototype.fetchRowUrl=null;a.pkp.controllers.grid.GridHandler.prototype.fetchRowsUrl=
null;a.pkp.controllers.grid.GridHandler.prototype.gridId_=null;a.pkp.controllers.grid.GridHandler.prototype.fetchGridUrl_=null;a.pkp.controllers.grid.GridHandler.prototype.features_=null;a.pkp.controllers.grid.GridHandler.prototype.fetchExtraParams_=null;a.pkp.controllers.grid.GridHandler.prototype.getFetchExtraParams=function(){return this.fetchExtraParams_};a.pkp.controllers.grid.GridHandler.prototype.setFetchExtraParams=function(a){this.fetchExtraParams_=a};a.pkp.controllers.grid.GridHandler.prototype.getFetchRowUrl=
function(){return this.fetchRowUrl};a.pkp.controllers.grid.GridHandler.prototype.getFetchRowsUrl=function(){return this.fetchRowsUrl};a.pkp.controllers.grid.GridHandler.prototype.getRows=function(){return a(".gridRow",this.getHtmlElement()).not(".gridRowDeleted")};a.pkp.controllers.grid.GridHandler.prototype.getGridIdPrefix=function(){return"component-"+this.gridId_};a.pkp.controllers.grid.GridHandler.prototype.getRowIdPrefix=function(){return this.getGridIdPrefix()+"-row-"};a.pkp.controllers.grid.GridHandler.prototype.getRowByDataId=
function(b){return a("tr.element"+b,this.getHtmlElement())};a.pkp.controllers.grid.GridHandler.prototype.getRowDataId=function(a){var c,d,e,a=a.attr("class").split(" ");for(c in a)if(e=a[c].indexOf("element"),-1!=e){d=a[c].slice(7);break}return d};a.pkp.controllers.grid.GridHandler.prototype.getParentRow=function(a){return a.parents(".gridRow:first")};a.pkp.controllers.grid.GridHandler.prototype.getElementsByType=function(b){return b.hasClass("gridRow")?(b=b.parents("tbody:first"),a(".gridRow",b)):
null};a.pkp.controllers.grid.GridHandler.prototype.getEmptyElement=function(a){return a.hasClass("gridRow")?a.parents("tbody:first").next(".empty"):null};a.pkp.controllers.grid.GridHandler.prototype.toggleRowActions=function(b){a(b).toggleClass("show_extras");a(b).toggleClass("hide_extras");b=a(b).parents("tr").next(".row_controls");this.applyToggleRowActionEffect_(b)};a.pkp.controllers.grid.GridHandler.prototype.hideAllVisibleRowActions=function(){this.getHtmlElement().find("a.hide_extras").click()};
a.pkp.controllers.grid.GridHandler.prototype.hideRowActionsDiv=function(){var b,c,d,e;b=a(".gridRow div.row_actions",this.getHtmlElement());b.hide();c=0;for(d=b.length;c<d;c++)e=a(b[c]),e.parents(".row_container:first").attr("style","padding-left:0px !important")};a.pkp.controllers.grid.GridHandler.prototype.showRowActionsDiv=function(){var b,c,d,e;b=a(".gridRow div.row_actions",this.getHtmlElement());b.show();c=0;for(d=b.length;c<d;c++)e=a(b[c]),e.parents(".row_container:first").removeAttr("style")};
a.pkp.controllers.grid.GridHandler.prototype.changeLinkActionsState=function(b,c){void 0===c&&(c=a(".pkp_controllers_linkAction",this.getHtmlElement()));c.each(function(){var c;c=a.pkp.classes.Handler.getHandler(a(this));b?c.enableLink():c.disableLink()})};a.pkp.controllers.grid.GridHandler.prototype.resequenceRows=function(b){var c,d,e;if(b){for(d in b){c=b[d];e=a("#"+c);0==e.length&&(e=a("tr.element"+c,this.getHtmlElement()));if(0==e.length)throw Error("Row with id "+c+" not found!");this.addElement(e)}this.updateControlRowsPosition();
this.callFeaturesHook("resequenceRows",b)}};a.pkp.controllers.grid.GridHandler.prototype.updateControlRowsPosition=function(){var b,c,d,e,f;b=this.getRows();c=0;for(d=b.length;c<d;c++)e=a(b[c]),f=this.getControlRowByGridRow(e),0<f.length&&f.insertAfter(e)};a.pkp.controllers.grid.GridHandler.prototype.insertOrReplaceElement=function(b,c){var d,e,f;d=a(b);e=d.attr("id");f=this.getHtmlElement();e=e?f.find("#"+e):null;if(null!==e&&1<e.length)throw Error("There were "+e.length+" rather than 0 or 1 elements to be replaced!");
this.hasSameNumOfColumns(d)?(null!==e&&1===e.length?this.replaceElement(e,d):this.addElement(d,null,c),this.activateRowActions_()):a.get(this.fetchGridUrl_,null,this.callbackWrapper(this.replaceGridResponseHandler_),"json")};a.pkp.controllers.grid.GridHandler.prototype.deleteElement=function(a,c){var d,e,f;if(1!==a.length)throw Error("There were "+a.length+" rather than 1 element to delete!");a.addClass("gridRowDeleted");d=!1;1==this.getElementsByType(a).length&&(d=!0);a.hasClass("gridRow")&&this.deleteControlsRow_(a);
e=this.getEmptyElement(a);f=function(){a.remove();d&&e.fadeIn(500)};void 0!=c&&c?f():a.fadeOut(500,f)};a.pkp.controllers.grid.GridHandler.prototype.initialize=function(b){var c;this.bind("dataChanged",this.refreshGridHandler);this.bind("addRow",this.addRowHandler_);this.bind("formSubmitted",this.refreshGridWithFilterHandler_);this.gridId_=b.gridId;this.fetchRowUrl=b.fetchRowUrl;this.fetchRowsUrl=b.fetchRowsUrl;this.fetchGridUrl_=b.fetchGridUrl;this.bodySelector=0<a("div.scrollable",this.getHtmlElement()).length?
"div.scrollable table":b.bodySelector;this.activateRowActions_();this.setFetchExtraParams({});this.getHtmlElement().find(".pkp_form").hide();c=this.getHtmlElement().find(".pkp_linkaction_search");0!==c.length?c.click(this.callbackWrapper(function(){this.getHtmlElement().find(".pkp_form").toggle();c.toggleClass("is_open")})):this.getHtmlElement().find(".pkp_form").toggle();this.trigger("gridInitialized")};a.pkp.controllers.grid.GridHandler.prototype.callFeaturesHook=function(b,c){var d;a.isArray(c)||
(c=[c]);for(d in this.features_)this.features_[d][b].apply(this.features_[d],c)};a.pkp.controllers.grid.GridHandler.prototype.refreshGridHandler=function(b,c,d,e){this.callFeaturesHook("refreshGrid",d);b=this.getFetchExtraParams();e||(d?d==a.pkp.controllers.grid.GridHandler.FETCH_ALL_ROWS_ID?a.get(this.fetchRowsUrl,b,this.callbackWrapper(this.replaceElementResponseHandler),"json"):(b.rowId=d,a.get(this.fetchRowUrl,b,this.callbackWrapper(this.replaceElementResponseHandler),"json")):a.get(this.fetchGridUrl_,
b,this.callbackWrapper(this.replaceGridResponseHandler_),"json"));this.trigger("gridRefreshRequested");this.publishChangeEvents()};a.pkp.controllers.grid.GridHandler.prototype.addElement=function(a,c,d){if(void 0===c||null===c)c=this.getHtmlElement().find(this.bodySelector);void 0!=d&&d?c.prepend(a):c.append(a);this.getEmptyElement(a).hide();this.callFeaturesHook("addElement",a)};a.pkp.controllers.grid.GridHandler.prototype.replaceElement=function(a,c){c.hasClass("gridRow")&&this.deleteControlsRow_(a);
a.replaceWith(c);this.callFeaturesHook("replaceElement",c)};a.pkp.controllers.grid.GridHandler.prototype.hasSameNumOfColumns=function(a,c){var d,e;d=this.getHtmlElement().find("th").length;e=a.first().find("td");e=c?e.attr("colspan"):e.length;return d==e};a.pkp.controllers.grid.GridHandler.prototype.replaceElementResponseHandler=function(b,c){var d,e,f,g,h,j,i;e=this.handleJson(c);if(!1!==e)if(e.elementNotFound)d=e.elementNotFound,d=this.getHtmlElement().find(".element"+d),0<d.length&&this.deleteElement(d);
else{f=a(e.content);if(1<f.filter("tr:not('.row_controls')").length){d=f.filter("tr.gridRow");h=f.filter("tr.row_controls");j=0;for(i=d.length;j<i;j++)f=a(d[j]),g=this.getControlRowByGridRow(f,h),this.insertOrReplaceElement(f.add(g))}else this.insertOrReplaceElement(e.content);this.resequenceRows(e.sequenceMap)}this.callFeaturesHook("replaceElementResponseHandler",e)};a.pkp.controllers.grid.GridHandler.prototype.refreshGridWithFilterHandler_=function(b,c,d){a.post(this.fetchGridUrl_,d,this.callbackWrapper(this.replaceGridResponseHandler_),
"json")};a.pkp.controllers.grid.GridHandler.prototype.addRowHandler_=function(b,c,d){a.get(this.fetchRowUrl,d,this.callbackWrapper(this.replaceElementResponseHandler),"json")};a.pkp.controllers.grid.GridHandler.prototype.replaceGridResponseHandler_=function(b,c){var d,e,f,g;d=this.handleJson(c);!1!==d&&(e=this.getHtmlElement(),f=e.parent(),g=e.find(".filter").is(":visible"),e.replaceWith(d.content),d=a('div[id^="'+this.getGridIdPrefix()+'"]',f),this.setHtmlElement(d),this.activateRowActions_(),g&&
d.find(".pkp_linkaction_search").click())};a.pkp.controllers.grid.GridHandler.prototype.deleteControlsRow_=function(b){b=a("#"+b.attr("id")+"-control-row",this.getHtmlElement());b.is("tr")&&b.hasClass("row_controls")&&b.remove()};a.pkp.controllers.grid.GridHandler.prototype.getControlRowByGridRow=function(a,c){var d,e;e=void 0===c||null===c?this.getHtmlElement().find("tr"):c;d=a.attr("id")+"-control-row";return e.filter("#"+d)};a.pkp.controllers.grid.GridHandler.prototype.activateRowActions_=function(){var a=
this.getHtmlElement();this.getHtmlElement().find("tr.gridRow").not(".category");a.find("a.show_extras").unbind("click").bind("click",this.callbackWrapper(this.toggleRowActions))};a.pkp.controllers.grid.GridHandler.prototype.applyToggleRowActionEffect_=function(a){var c;c=a.prev().find("td:not(.indent_row)");c=c.add(a.prev());a.is(":visible")?(setTimeout(function(){c.removeClass("no_border")},0),a.hide(0)):(c.addClass("no_border"),a.show(0))};a.pkp.controllers.grid.GridHandler.prototype.addFeature_=
function(a,c){this.features_||(this.features_=[]);this.features_[a]=c};a.pkp.controllers.grid.GridHandler.prototype.initFeatures_=function(b){var c,d;for(c in b)d=b[c].JSClass,null!==d&&(d=a.pkp.classes.Helper.objectFactory(d,[this,b[c].options]),this.addFeature_(c,d),this.features_[c].init())}})(jQuery);(function(a){a.pkp.controllers.grid.CategoryGridHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.CategoryGridHandler,a.pkp.controllers.grid.GridHandler);a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryIdPrefix=function(){return this.getGridIdPrefix()+"-category-"};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategories=function(){return a(".category_grid_body:not(.empty)",this.getHtmlElement())};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryByDataId=
function(b){return a("#"+this.getCategoryIdPrefix()+b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryRow=function(b){var c=this.getHtmlElement();void 0!==b&&(c=b);return a("tr.category",c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getRowsInCategory=function(b){return a("tr.gridRow",b).not(".category")};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryEmptyPlaceholder=function(b){b="#"+b.attr("id")+"-emptyPlaceholder";return a(b,this.getHtmlElement())};
a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryDataId=function(a){var a=a.attr("id"),c=this.getCategoryIdPrefix().length;return a.slice(c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryDataIdByRowId=function(b){b=b.replace(this.getCategoryIdPrefix()," ");b=b.match("(.*)-row");return a.trim(b[1])};a.pkp.controllers.grid.CategoryGridHandler.prototype.appendCategory=function(a){this.getHtmlElement().find(this.bodySelector).append(a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.resequenceCategories=
function(b){var c,d;for(d in b)c=b[d],c=a("#"+c),this.appendCategory(c);this.updateEmptyPlaceholderPosition()};a.pkp.controllers.grid.CategoryGridHandler.prototype.updateEmptyPlaceholderPosition=function(){var b=this.getCategories(),c,d,e,f;c=0;for(d=b.length;c<d;c++)e=a(b[c]),f=this.getCategoryEmptyPlaceholder(e),0<f.length&&f.insertAfter(e)};a.pkp.controllers.grid.CategoryGridHandler.prototype.initialize=function(a){this.fetchCategoryUrl_=a.fetchCategoryUrl;this.parent("initialize",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getElementsByType=
function(a){return a.hasClass("category_grid_body")?this.getCategories():this.parent("getElementsByType",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getEmptyElement=function(a){return a.hasClass("category_grid_body")?this.getHtmlElement().find(".empty").not(".category_placeholder"):this.parent("getEmptyElement",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.refreshGridHandler=function(b,c,d){var e=!1;void 0!==d&&(void 0!==d.parentElementId?(e={rowId:d[0],rowCategoryId:d.parentElementId},
this.currentCategoryId_=d.parentElementId,a.get(this.fetchRowUrl,e,this.callbackWrapper(this.replaceElementResponseHandler),"json")):a.get(this.fetchCategoryUrl_,{rowId:d},this.callbackWrapper(this.replaceElementResponseHandler),"json"),e=!0);this.parent("refreshGridHandler",b,c,d,e)};a.pkp.controllers.grid.CategoryGridHandler.prototype.deleteElement=function(b){var c,d,e,f;if(1<b.length&&(2==b.length&&(b.hasClass("category_grid_body")&&b.hasClass("category"))&&(b=b.filter(".category_grid_body")),
this.currentCategoryId_)){c=this.getCategoryByDataId(this.currentCategoryId_);d=0;for(e=b.length;d<e;d++)if(f=a(b[d]).parents("#"+c.attr("id")),1===f.length){b=a(b[d]);break}}b.hasClass("category_grid_body")&&(c=this.getCategoryEmptyPlaceholder(b),c.remove());this.parent("deleteElement",b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.addElement=function(a){var c=null;a.hasClass("gridRow")&&(c=this.getCategoryDataIdByRowId(a.attr("id")),c=this.getCategoryByDataId(c));this.parent("addElement",
a,c);a.hasClass("category_grid_body")&&(a=this.getEmptyElement(a),this.getHtmlElement().find(this.bodySelector).append(a))};a.pkp.controllers.grid.CategoryGridHandler.prototype.replaceElement=function(a,c){c.hasClass("category_grid_body")&&this.getCategoryEmptyPlaceholder(a).remove();this.parent("replaceElement",a,c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.hasSameNumOfColumns=function(a){var c=a,d=!1;a.hasClass("category_grid_body")&&(c=a.find("tr"),d=!0);return this.parent("hasSameNumOfColumns",
c,d)}})(jQuery);(function(a){a.pkp.controllers.listbuilder=a.pkp.controllers.listbuilder||{};a.pkp.controllers.listbuilder.ListbuilderHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.listbuilder.ListbuilderHandler,a.pkp.controllers.grid.GridHandler);a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.sourceType_=null;a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.saveUrl_=null;a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.saveFieldName_=null;
a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.fetchOptionsUrl_=null;a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.editItemCallingContext_=null;a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.initialize=function(a){this.parent("initialize",a);this.sourceType_=a.sourceType;this.saveUrl_=a.saveUrl;this.saveFieldName_=a.saveFieldName;this.fetchOptionsUrl_=a.fetchOptionsUrl;a=this.getHtmlElement();a.find(".actions .pkp_linkaction_addItem").mousedown(this.callbackWrapper(this.addItemHandler_));
this.attachContentHandlers_(a);this.bind("formSubmitRequested",this.formSubmitHandler_);this.bind("formSubmitted",this.formSubmittedHandler_)};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.getSaveUrl_=function(){return this.saveUrl_};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.getSaveFieldName_=function(){return this.saveFieldName_};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.closeEdits=function(){var a=this.getHtmlElement().find(".gridRowEdit:visible");
0!==a.length&&(this.saveRow(a),a.removeClass("gridRowEdit"))};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.save=function(){var b=this.getHtmlElement().find("input.deletions").val(),c=[],d,e,f=this;this.getHtmlElement().find('.gridRow input.isModified[value="1"]').each(function(b,d){var e=a(d).parents(".gridRow"),e=f.buildParamsFromInputs_(e.find(":input"));c.push(e)});d=this.getRows().length;b=JSON.stringify({deletions:b,changes:c,numberOfRows:d});(d=this.getSaveUrl_())?a.post(d,{data:b},
this.callbackWrapper(this.saveResponseHandler_,null),"json"):(e=this.getSaveFieldName_(),d=this.getHtmlElement().find(":input[type=hidden]").filter(function(){return a(this).attr("name")==e}).first(),0===d.length&&(d=a('<input type="hidden" />'),d.attr("name",e),this.getHtmlElement().append(d)),d.attr("value",b))};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.saveRow=function(b){b.addClass("saveRowResponsePlaceholder");b=this.buildParamsFromInputs_(b.find(":input"));b.modify=!0;this.disableControls();
a.ajax({url:this.getFetchRowUrl(),data:b,success:this.callbackWrapper(this.saveRowResponseHandler_,null),dataType:"json",async:!1})};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.getEmptyElement=function(){return this.getHtmlElement().find(".empty")};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.addItemHandler_=function(){setTimeout(this.callbackWrapper(function(){this.closeEdits();this.disableControls();a.get(this.getFetchRowUrl(),{modify:!0},this.callbackWrapper(this.appendRowResponseHandler_,
null),"json")}),0);return!1};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.deleteItemHandler_=function(b){this.closeEdits();var c=a(b),b=c.closest(".gridRow"),c=c.closest(".pkp_controllers_listbuilder").find(".deletions"),d=b.find('input[name="rowId"]').val();void 0!==d&&(c.val(c.val()+" "+d),this.getHtmlElement().trigger("formChange"));this.deleteElement(b);return!1};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.appendRowResponseHandler_=function(b,c){var d=this.handleJson(c);
!1!==d&&(d=a(d.content),this.getHtmlElement().find(".empty").hide().before(d),this.attachContentHandlers_(d),d.addClass("gridRowEdit"),d.find(":input").not('[type="hidden"]').first().focus(),this.sourceType_==a.pkp.cons.LISTBUILDER_SOURCE_TYPE_SELECT?(this.disableControls(),a.get(this.fetchOptionsUrl_,{},this.callbackWrapper(this.fetchOptionsResponseHandler_,null),"json")):this.enableControls(),this.callFeaturesHook("addElement",d));return!1};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.fetchOptionsResponseHandler_=
function(b,c){var d=this.handleJson(c),e=this.getHtmlElement(),f=[],g,h,j,i,k,p,n,r,m,t;if(!1!==d){e.find(".gridCellDisplay :input").each(function(b,c){f[b]=a(c).val()});e=e.find(".gridRowEdit:visible .selectMenu:input");g=0;for(h=e.length;g<h;g++){j=a(e[g]);i=j.parents(".gridCellContainer");k=0;j.children().empty();p=null;for(p in d.content[g])if(p!=a.pkp.cons.LISTBUILDER_OPTGROUP_LABEL)if("object"==typeof d.content[g][p]){if(void 0!==d.content[g][a.pkp.cons.LISTBUILDER_OPTGROUP_LABEL]&&"object"==
typeof d.content[g][a.pkp.cons.LISTBUILDER_OPTGROUP_LABEL]&&(r=d.content[g][a.pkp.cons.LISTBUILDER_OPTGROUP_LABEL][p])){m=a("<optgroup></optgroup>");m.attr("label",r);j.append(m);r=null;t=0;for(r in d.content[g][p])if(n=this.populatePulldown_(m,f,d.content[g][p][r],r))k++,t++;0===t&&m.remove()}}else(n=this.populatePulldown_(j,f,d.content[g][p],p))&&k++;j=n;1===k&&j&&j.attr("selected","selected");0===k&&(i.find(".gridCellDisplay").show(),i.find(".gridCellEdit").hide())}}this.enableControls();return!1};
a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.populatePulldown_=function(b,c,d,e){var f=b.parents(".gridCellContainer").find(".gridCellDisplay :input").val(),g=!1,h;if(e!=f)for(h=0;h<c.length;h++)c[h]==e&&(g=!0);if(g)return!1;c=a("<option/>");c.attr("value",e);c.text(d);e==f&&c.attr("selected","selected");b.append(c);return c};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.editItemHandler_=function(b){this.closeEdits();this.editItemCallingContext_=b;setTimeout(this.callbackWrapper(function(){var b=
a(this.editItemCallingContext_).closest(".gridRow");b.addClass("gridRowEdit");b.find(":input").not('[type="hidden"]').first().focus();this.sourceType_==a.pkp.cons.LISTBUILDER_SOURCE_TYPE_SELECT&&(this.disableControls(),a.get(this.fetchOptionsUrl_,{},this.callbackWrapper(this.fetchOptionsResponseHandler_,null),"json"))}),0);return!1};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.buildParamsFromInputs_=function(b){var c={};a.each(b.serializeArray(),function(b,e){var f=e.name,g=e.value;
c[f]=void 0===c[f]?g:a.isArray(c[f])?c[f].concat(g):[c[f],g]});return c};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.inputKeystrokeHandler_=function(b,c){var d,e,f;return 13==c.which?(d=a(b),e=d.parents(".gridRow"),f=e.find(":input:visible"),d=f.index(d),f.length==d+1?this.saveRow(e):f[d+1].focus(),!1):!0};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.inputBlurHandler_=function(b){a(b).closest(".gridRow").addClass("editingRowPlaceholder");setTimeout(this.callbackWrapper(function(){var b=
a(".editingRowPlaceholder"),d=!1;b.find(":input").each(function(a,b){b===document.activeElement&&(d=!0)});b.removeClass("editingRowPlaceholder");d||this.closeEdits()}),0);return!0};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.saveRowResponseHandler_=function(b,c){var d=this.handleJson(c),e;!1!==d&&(d=a(d.content),e=this.getHtmlElement().find(".saveRowResponsePlaceholder").attr("id"),this.getHtmlElement().find(".saveRowResponsePlaceholder").replaceWith(d),d.attr("id",e),this.attachContentHandlers_(d),
this.callFeaturesHook("replaceElement",d));this.getHtmlElement().trigger("formChange");this.enableControls()};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.saveResponseHandler_=function(){};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.attachContentHandlers_=function(a){a.find(".gridCellDisplay").click(this.callbackWrapper(this.editItemHandler_));a.find(":input").keypress(this.callbackWrapper(this.inputKeystrokeHandler_)).blur(this.callbackWrapper(this.inputBlurHandler_));
a.find(".pkp_linkaction_delete").click(this.callbackWrapper(this.deleteItemHandler_))};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.formSubmitHandler_=function(){this.save();this.getHtmlElement().find(".gridRow :input").attr("disabled","disabled");return!0};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.formSubmittedHandler_=function(){this.getHtmlElement().find(".gridRow :input").removeAttr("disabled")};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.disableControls=
function(){this.getHtmlElement().find('span[class="options"] > a[id*="addItem"]').unbind("mousedown");this.getHtmlElement().find('span[class="options"] > a[id*="addItem"]').mousedown(function(){return!1});this.getHtmlElement().find(".h3").addClass("spinner")};a.pkp.controllers.listbuilder.ListbuilderHandler.prototype.enableControls=function(){this.getHtmlElement().find('span[class="options"] > a[id*="addItem"]').mousedown(this.callbackWrapper(this.addItemHandler_));this.getHtmlElement().find(".h3").removeClass("spinner")}})(jQuery);(function(a){a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler,a.pkp.controllers.listbuilder.ListbuilderHandler);a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.$lists_=null;a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getRowsByList=function(a){return a.find(".gridRow")};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getLists=
function(){return this.$lists_};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.setLists=function(b){jQuery();var c,d;if(!a.isArray(b))throw Error("Lists id must be passed using an array object!");for(c in b)d=this.getListById(b[c]),this.$lists_=this.$lists_?this.$lists_.add(d):d};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getListById=function(b){b=this.getGridIdPrefix()+"-table-"+b;return a("#"+b,this.getHtmlElement())};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getListByRow=
function(a){return a.parents("table:first")};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getListIdByRow=function(a){a=this.getListByRow(a);return this.getListId(a)};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getListId=function(a){var c=this.getGridIdPrefix()+"-table-";return a.attr("id").slice(c.length)};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.getListNoItemsRow=function(a){return a.find("tr.empty")};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.initialize=
function(a){this.parent("initialize",a);this.setLists(a.listsId)};a.pkp.controllers.listbuilder.MultipleListsListbuilderHandler.prototype.toggleListNoItemsRow=function(a,c,d){var e=this.getListNoItemsRow(a),f=this.getRowsByList(a);d&&(f=f.not(d));f.length==c?(e.detach(),a.append(e),e.show()):(e.detach(),a.append(e),e.hide())}})(jQuery);(function(a){a.pkp.controllers.modal=a.pkp.controllers.modal||{};a.pkp.controllers.modal.ModalHandler=function(b,c){this.parent(b,c);if(!this.checkOptions(c))throw Error("Missing or invalid modal options!");var d=a.extend(!0,{},c);this.options=this.mergeOptions(d);b.html(this.modalBuild()[0].outerHTML);this.modalOpen(b);b.find(".pkpModalCloseButton").click(this.callbackWrapper(this.modalClose));b.on("click keyup",this.callbackWrapper(this.handleWrapperEvents));this.publishEvent("redirectRequested");
this.publishEvent("dataChanged");this.publishEvent("containerReloadRequested");this.publishEvent("updateHeader");this.bind("notifyUser",this.redirectNotifyUserEventHandler_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ModalHandler,a.pkp.classes.Handler);a.pkp.controllers.modal.ModalHandler.DEFAULT_OPTIONS_={autoOpen:!0,width:710,modal:!0,draggable:!1,resizable:!1,position:{my:"center",at:"center center-10%",of:window},canClose:!0};a.pkp.controllers.modal.ModalHandler.options=null;a.pkp.controllers.modal.ModalHandler.prototype.checkOptions=
function(a){return"object"===typeof a&&void 0===a.buttons};a.pkp.controllers.modal.ModalHandler.prototype.mergeOptions=function(b){return a.extend(!0,{},this.self("DEFAULT_OPTIONS_"),b)};a.pkp.controllers.modal.ModalHandler.prototype.modalBuild=function(){var b=a('<div class="pkp_modal_panel"></div>');"undefined"!==this.options.title&&b.append('<div class="header">'+this.options.title+"</div>");this.options.canClose&&b.append('<a href="#" class="close pkpModalCloseButton"><span class="pkp_screen_reader">'+
this.options.closeButtonText+"</span></a>");b.append('<div class="content"></div>');return b};a.pkp.controllers.modal.ModalHandler.prototype.modalOpen=function(b){a("body").append(b);setTimeout(function(){b.addClass("is_visible")},10);setTimeout(function(){b.focus()},300);b.trigger("pkpModalOpen",[b])};a.pkp.controllers.modal.ModalHandler.prototype.modalClose=function(){var a=this,c=this.getHtmlElement(),d=c.find("form").first();1==d.length&&d.trigger("containerClose");c.removeClass("is_visible");
this.trigger("pkpModalClose");setTimeout(function(){a.getHtmlElement().empty();a.remove()},300);return!1};a.pkp.controllers.modal.ModalHandler.prototype.handleWrapperEvents=function(b,c){"click"==c.type&&b==c.target?a.pkp.classes.Handler.getHandler(a(b)).modalClose():"keyup"==c.type&&27==c.which&&a.pkp.classes.Handler.getHandler(a(b)).modalClose()};a.pkp.controllers.modal.ModalHandler.prototype.redirectNotifyUserEventHandler_=function(b,c,d){a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent(this,
d)}})(jQuery);(function(a){a.pkp.controllers.modal.ConfirmationModalHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ConfirmationModalHandler,a.pkp.controllers.modal.ModalHandler);a.pkp.controllers.modal.ConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.okButton&&(!1===a.cancelButton||"string"===typeof a.cancelButton)&&"string"===typeof a.dialogText};a.pkp.controllers.modal.ConfirmationModalHandler.prototype.modalBuild=
function(){var a=this.parent("modalBuild"),c='<a href="#" class="ok pkpModalConfirmButton">'+this.options.okButton+"</a>";a.addClass("pkp_modal_confirmation").find(".content").append('<div class="message">'+this.options.dialogText+"</div>");this.options.cancelButton&&(c+='<a href="#" class="cancel pkpModalCloseButton">'+this.options.cancelButton+"</a>");a.append('<div class="footer">'+c+"</div>");return a};a.pkp.controllers.modal.ConfirmationModalHandler.prototype.modalConfirm=function(a){this.modalClose(a)}})(jQuery);(function(a){a.pkp.controllers.modal.RedirectConfirmationModalHandler=function(a,c){this.parent(a,c);this.remoteUrl_=c.remoteUrl};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.RedirectConfirmationModalHandler,a.pkp.controllers.modal.ConfirmationModalHandler);a.pkp.controllers.modal.RedirectConfirmationModalHandler.prototype.remoteUrl_=null;a.pkp.controllers.modal.RedirectConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.cancelButton&&
"string"===typeof a.remoteUrl};a.pkp.controllers.modal.RedirectConfirmationModalHandler.prototype.modalConfirm=function(){document.location=this.remoteUrl_}})(jQuery);(function(a){a.pkp.controllers.modal.RemoteActionConfirmationModalHandler=function(a,c){this.parent(a,c);this.remoteAction_=c.remoteAction;a.find(".pkpModalConfirmButton").on("click",this.callbackWrapper(this.modalConfirm))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.RemoteActionConfirmationModalHandler,a.pkp.controllers.modal.ConfirmationModalHandler);a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.remoteAction_=null;a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.checkOptions=
function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.cancelButton&&"string"===typeof a.remoteAction};a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.modalConfirm=function(b,c){c.preventDefault();a.post(this.remoteAction_,this.callbackWrapper(this.remoteResponse),"json")};a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.remoteResponse=function(a,c){!1!==this.parent("remoteResponse",a,c)&&this.modalClose(a);return!1}})(jQuery);(function(a){a.pkp.controllers.modal.ButtonConfirmationModalHandler=function(a,c){this.parent(a,c);a.find(".pkpModalConfirmButton").on("click",this.callbackWrapper(this.modalConfirm))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ButtonConfirmationModalHandler,a.pkp.controllers.modal.ConfirmationModalHandler);a.pkp.controllers.modal.ButtonConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"object"==typeof a.$button&&1==a.$button.length};a.pkp.controllers.modal.ButtonConfirmationModalHandler.prototype.modalConfirm=
function(a){var c=this.options.$button;this.modalClose(a);"submit"==c.attr("type")?c.trigger("submit"):c.click()}})(jQuery);(function(a){a.pkp.controllers.modal.JsEventConfirmationModalHandler=function(a,c){this.parent(a,c);this.jsEvent_=c.jsEvent;this.extraArguments_=c.extraArguments};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.JsEventConfirmationModalHandler,a.pkp.controllers.modal.ConfirmationModalHandler);a.pkp.controllers.modal.JsEventConfirmationModalHandler.prototype.jsEvent_=null;a.pkp.controllers.modal.JsEventConfirmationModalHandler.prototype.extraArguments_=null;a.pkp.controllers.modal.JsEventConfirmationModalHandler.prototype.checkOptions=
function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.cancelButton&&"string"===typeof a.jsEvent};a.pkp.controllers.modal.JsEventConfirmationModalHandler.prototype.modalConfirm=function(a){this.trigger(this.jsEvent_,this.extraArguments_);this.modalClose(a)}})(jQuery);(function(a){a.pkp.controllers.modal.AjaxModalHandler=function(a,c){this.parent(a,c);this.bind("formSubmitted",this.formSubmitted);this.bind("formCanceled",this.modalClose);this.bind("ajaxHtmlError",this.modalClose)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.AjaxModalHandler,a.pkp.controllers.modal.ModalHandler);a.pkp.controllers.modal.AjaxModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.url};a.pkp.controllers.modal.AjaxModalHandler.prototype.mergeOptions=
function(a){return this.parent("mergeOptions",a)};a.pkp.controllers.modal.AjaxModalHandler.prototype.modalOpen=function(a){this.parent("modalOpen",a);a.find(".content").pkpAjaxHtml(this.options.url)};a.pkp.controllers.modal.AjaxModalHandler.prototype.formSubmitted=function(){this.getHtmlElement().parent().trigger("notifyUser");this.modalClose()}})(jQuery);(function(a){a.pkp.controllers.modal.WizardModalHandler=function(a,c){this.parent(a,c);this.bind("wizardClose",this.wizardClose);this.bind("wizardCancel",this.wizardClose)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.WizardModalHandler,a.pkp.controllers.modal.AjaxModalHandler);a.pkp.controllers.modal.WizardModalHandler.prototype.modalClose=function(b,c,d){d?this.parent("modalClose",b,c):(d=new a.Event("wizardCancelRequested"),d.stopPropagation(),this.getHtmlElement().children().first().trigger(d),
d.isDefaultPrevented()||this.parent("modalClose",b,c));return!1};a.pkp.controllers.modal.WizardModalHandler.prototype.wizardClose=function(a,c){this.modalClose(a,c,!0)}})(jQuery);(function(a){a.pkp.controllers.modals=a.pkp.controllers.modals||{editorDecision:{form:{}}};a.pkp.controllers.modals.editorDecision.form.EditorDecisionFormHandler=function(b,c){this.parent(b,c);this.peerReviewUrl_=c.peerReviewUrl;a("#importPeerReviews",b).click(this.callbackWrapper(this.importPeerReviews))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modals.editorDecision.form.EditorDecisionFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.modals.editorDecision.form.EditorDecisionFormHandler.peerReviewUrl_=
null;a.pkp.controllers.modals.editorDecision.form.EditorDecisionFormHandler.prototype.importPeerReviews=function(){a.getJSON(this.peerReviewUrl_,this.callbackWrapper(this.insertPeerReviews));return!1};a.pkp.controllers.modals.editorDecision.form.EditorDecisionFormHandler.prototype.insertPeerReviews=function(b,c){var d=this.handleJson(c),e=this.getHtmlElement(),f;!1!==d&&(e=a('textarea[id^="personalMessage"]',e),f=e.val(),f.match(/__________/)?e.val(f.replace(/__________/,d.content+"__________")):
e.val(f+d.content))}})(jQuery);(function(a){jQuery.pkp.controllers.linkAction=jQuery.pkp.controllers.linkAction||{};a.pkp.controllers.linkAction.LinkActionHandler=function(b,c){this.parent(b,c);this.staticId_=c.staticId?c.staticId:b.attr("id");if(!c.actionRequest||!c.actionRequestOptions)throw Error('The "actionRequest" and "actionRequestOptions"settings are required in a LinkActionHandler');c.actionRequestOptions.finishCallback=this.callbackWrapper(this.enableLink);this.linkActionRequest_=a.pkp.classes.Helper.objectFactory(c.actionRequest,
[b,c.actionRequestOptions]);this.bindActionRequest();this.publishEvent("dataChanged");this.bind("dataChanged",this.dataChangedHandler_);this.bind("pkpModalClose",this.removeDisabledAttribute_);c.selfActivate&&this.trigger("click")};a.pkp.classes.Helper.inherits(a.pkp.controllers.linkAction.LinkActionHandler,a.pkp.classes.Handler);a.pkp.controllers.linkAction.LinkActionHandler.prototype.linkActionRequest_=null;a.pkp.controllers.linkAction.LinkActionHandler.prototype.staticId_=null;a.pkp.controllers.linkAction.LinkActionHandler.prototype.getStaticId=
function(){return this.staticId_};a.pkp.controllers.linkAction.LinkActionHandler.prototype.getUrl=function(){return this.linkActionRequest_.getUrl()};a.pkp.controllers.linkAction.LinkActionHandler.prototype.activateAction=function(a,c){this.linkActionRequest_.shouldDebounce()&&this.disableLink();return this.linkActionRequest_.activate.call(this.linkActionRequest_,a,c)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.bindActionRequest=function(){this.bind("click",this.activateAction)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.enableLink=
function(){var b,c;b=a(this.getHtmlElement());this.getHtmlElement().is(":submit")||this.removeDisabledAttribute_();c=this.getUrl();this.getHtmlElement().is("a")&&c&&b.attr("href",c);this.unbind("click",this.noAction_);this.bindActionRequest()};a.pkp.controllers.linkAction.LinkActionHandler.prototype.disableLink=function(){var b=a(this.getHtmlElement());b.attr("disabled","disabled");this.getHtmlElement().is("a")&&b.attr("href","#");this.unbind("click",this.activateAction);this.bind("click",this.noAction_)};
a.pkp.controllers.linkAction.LinkActionHandler.prototype.removeDisabledAttribute_=function(){a(this.getHtmlElement()).removeAttr("disabled")};a.pkp.controllers.linkAction.LinkActionHandler.prototype.dataChangedHandler_=function(a,c,d){0===this.getHtmlElement().parents(".pkp_controllers_grid").length&&this.trigger("redirectDataChangedToGrid",[d]);this.trigger("notifyUser",[this.getHtmlElement()])};a.pkp.controllers.linkAction.LinkActionHandler.prototype.noAction_=function(){return!1}})(jQuery);(function(a){a.pkp.controllers.wizard=a.pkp.controllers.wizard||{};a.pkp.controllers.wizard.WizardHandler=function(a,c){this.parent(a,c);this.addWizardButtons_(a,c);this.startWizard();this.bindWizardEvents();this.bind("formValid",this.formValid);this.bind("formInvalid",this.formInvalid);this.bind("formSubmitted",this.formSubmitted)};a.pkp.classes.Helper.inherits(a.pkp.controllers.wizard.WizardHandler,a.pkp.controllers.TabHandler);a.pkp.controllers.wizard.WizardHandler.prototype.$continueButton_=null;
a.pkp.controllers.wizard.WizardHandler.prototype.$progressIndicator_=null;a.pkp.controllers.wizard.WizardHandler.prototype.continueButtonText_=null;a.pkp.controllers.wizard.WizardHandler.prototype.finishButtonText_=null;a.pkp.controllers.wizard.WizardHandler.prototype.continueRequest=function(){var b=new a.Event("wizardAdvanceRequested");this.getCurrentTab().children().first().trigger(b);b.isDefaultPrevented()||this.advanceOrClose_();return!1};a.pkp.controllers.wizard.WizardHandler.prototype.formValid=
function(){this.getContinueButton().button("enable")};a.pkp.controllers.wizard.WizardHandler.prototype.formInvalid=function(){this.getContinueButton().button("disable")};a.pkp.controllers.wizard.WizardHandler.prototype.formSubmitted=function(){this.advanceOrClose_()};a.pkp.controllers.wizard.WizardHandler.prototype.cancelRequest=function(){this.checkForm_(!1);var b=new a.Event("wizardCancelRequested");this.getCurrentTab().children().first().trigger(b);b.isDefaultPrevented()||this.trigger("wizardCancel");
return!1};a.pkp.controllers.wizard.WizardHandler.prototype.wizardCancelRequested=function(){return this.checkForm_(!0)?!1:!0};a.pkp.controllers.wizard.WizardHandler.prototype.wizardAdvanceRequested=function(a,c){var d=this.getForm_();d&&(d.submit()&&(this.getContinueButton().button("disable"),this.getProgressIndicator().show()),c.preventDefault())};a.pkp.controllers.wizard.WizardHandler.prototype.wizardAdvance=function(){var a=this.getCurrentStep(),c=this.getNumberOfSteps()-1,d=a+1,e;if(d>c)throw Error("Trying to set an invalid wizard step!");
e=this.getHtmlElement();e.tabs("enable",d);e.tabs("option","active",d);e.tabs("disable",a);a=this.getContinueButton();d===c&&a.button("option","label",this.getFinishButtonText());this.getProgressIndicator().hide();a.button("enable")};a.pkp.controllers.wizard.WizardHandler.prototype.startWizard=function(){var a=this.getHtmlElement(),c,d;0!==this.getCurrentStep()&&(a.tabs("enable",0),a.tabs("option","active",0),c=this.getContinueButton(),c.button("option","label",this.getContinueButtonText()));c=[];
for(d=1;d<this.getNumberOfSteps();d++)c.push(d);a.tabs("option","disabled",c)};a.pkp.controllers.wizard.WizardHandler.prototype.bindWizardEvents=function(){this.bind("wizardCancelRequested",this.wizardCancelRequested);this.bind("wizardAdvanceRequested",this.wizardAdvanceRequested);this.bind("wizardAdvance",this.wizardAdvance)};a.pkp.controllers.wizard.WizardHandler.prototype.getCurrentStep=function(){return this.getCurrentTabIndex()};a.pkp.controllers.wizard.WizardHandler.prototype.getContinueButton=
function(){return this.$continueButton_};a.pkp.controllers.wizard.WizardHandler.prototype.getProgressIndicator=function(){return this.$progressIndicator_};a.pkp.controllers.wizard.WizardHandler.prototype.getContinueButtonText=function(){return this.continueButtonText_};a.pkp.controllers.wizard.WizardHandler.prototype.getFinishButtonText=function(){return this.finishButtonText_};a.pkp.controllers.wizard.WizardHandler.prototype.getNumberOfSteps=function(){return this.getHtmlElement().find("ul").first().children().length};
a.pkp.controllers.wizard.WizardHandler.prototype.getForm_=function(){var b,c,d;d=this.getCurrentTab().children();for(b=0;b<d.length;b++)if(c=a(d[b]),c.is("form"))return c;return null};a.pkp.controllers.wizard.WizardHandler.prototype.advanceOrClose_=function(){var a=this.getCurrentStep(),c=this.getNumberOfSteps()-1;a<c?this.trigger("wizardAdvance"):this.trigger("wizardClose")};a.pkp.controllers.wizard.WizardHandler.prototype.checkForm_=function(b){var c=this.getForm_();if(null!==c)if(c=a.pkp.classes.Handler.getHandler(a("#"+
c.attr("id"))),b){if(c.formChangesTracked)if(confirm(a.pkp.locale.form_dataHasChanged))c.unregisterForm();else return!0}else c.unregisterForm();return!1};a.pkp.controllers.wizard.WizardHandler.prototype.addWizardButtons_=function(b,c){var d=a('<div id="wizardButtons" class="modal-buttons"></div>'),e,f;c.cancelButtonText&&(e=a(['<a id="cancelButton" href="#">',c.cancelButtonText,"</a>"].join("")),d.append(e),e.bind("click",this.callbackWrapper(this.cancelRequest)));c.continueButtonText&&(e=a(['<button id="continueButton"class="button pkp_helpers_align_right">',
c.continueButtonText,"</button>"].join("")).button(),d.append(e),f=a('<span class="pkp_spinner"></span>'),d.append(f),e.bind("click",this.callbackWrapper(this.continueRequest)),this.$continueButton_=e,this.$progressIndicator_=f,this.continueButtonText_=c.continueButtonText,this.finishButtonText_=c.finishButtonText?c.finishButtonText:c.continueButtonText);b.after(d)}})(jQuery);(function(a){a.pkp.controllers.grid.queries=a.pkp.controllers.grid.queries||{};a.pkp.controllers.grid.queries.ReadQueryHandler=function(a,c){this.fetchNoteFormUrl_=c.fetchNoteFormUrl;this.fetchParticipantsListUrl_=c.fetchParticipantsListUrl;a.find(".openNoteForm a").click(this.callbackWrapper(this.showNoteFormHandler_));a.bind("dataChanged",this.callbackWrapper(this.reloadParticipantsList_));this.loadParticipantsList()};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.queries.ReadQueryHandler,
a.pkp.classes.Handler);a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.fetchNoteFormUrl_=null;a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.fetchParticipantsListUrl_=null;a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.loadParticipantsList=function(){a.get(this.fetchParticipantsListUrl_,this.callbackWrapper(this.showFetchedParticipantsList_),"json")};a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.showNoteFormHandler_=function(b){a(b).parents(".openNoteForm").addClass("is_loading");
a.get(this.fetchNoteFormUrl_,this.callbackWrapper(this.showFetchedNoteForm_),"json")};a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.showFetchedNoteForm_=function(b,c){var d=this.handleJson(c),e=a("#newNotePlaceholder",this.getHtmlElement());a(".openNoteForm.is_loading",this.getHtmlElement()).remove();e.html(d.content)};a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.showFetchedParticipantsList_=function(b,c){var d=this.handleJson(c),e=a("#participantsListPlaceholder",this.getHtmlElement());
e.children().remove();e.append(d.content)};a.pkp.controllers.grid.queries.ReadQueryHandler.prototype.reloadParticipantsList_=function(){this.loadParticipantsList()}})(jQuery);(function(a){a.pkp.controllers.wizard.fileUpload=a.pkp.controllers.wizard.fileUpload||{};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler=function(a,c){this.parent(a,c);this.deleteUrl_=c.deleteUrl;this.metadataUrl_=c.metadataUrl;this.finishUrl_=c.finishUrl;this.bind("fileUploaded",this.handleFileUploaded);this.getContinueButton().button("disable")};a.pkp.classes.Helper.inherits(a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler,a.pkp.controllers.wizard.WizardHandler);a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.deleteUrl_=
"";a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.metadataUrl_="";a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.finishUrl_="";a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.uploadedFile_=null;a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.tabsBeforeActivate=function(a,c,d){if(0<d.newTab.index()){if(!this.uploadedFile_)throw Error("Uploaded file missing!");this.getHtmlElement();var e="";switch(d.newTab.index()){case 1:e=
this.metadataUrl_;break;case 2:e=this.finishUrl_;break;default:throw Error("Unsupported tab index.");}e=e+"&fileId="+this.uploadedFile_.fileId;d.newTab.find(".ui-tabs-anchor").attr("href",e)}return this.parent("tabsBeforeActivate",a,c,d)};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.wizardAdvance=function(){var a=this.getCurrentStep(),c=this.getNumberOfSteps()-1,d=a+1,e=this.getHtmlElement();if(d>c)throw Error("Trying to set an invalid wizard step!");e.tabs("enable",d);e.tabs("option",
"active",d);0===a&&e.tabs("disable",a);d===c&&(a=this.getContinueButton(),a.button("option","label",this.getFinishButtonText()),a.button("enable"))};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.tabsLoad=function(b,c,d){var e=this.getHtmlElement(),f=this.getProgressIndicator();if(2===d.tab.index()){e=a("#newFile",e);if(1!==e.length)throw Error('Did not find "new file" button!');e.button();e.bind("click",this.callbackWrapper(this.startWizard))}f.hide();return this.parent("tabsLoad",
b,c,d)};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.formValid=function(a,c){0===this.getCurrentStep()&&0===this.getHtmlElement().find("#uploadConfirmationForm").length&&!this.uploadedFile_||this.parent("formValid",a,c)};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.wizardCancelRequested=function(b,c){if(this.parent("wizardCancelRequested",b,c))if(this.uploadedFile_)a.post(this.deleteUrl_,this.uploadedFile_,a.pkp.classes.Helper.curry(this.wizardCancelSuccess,
this,b,c),"json"),this.uploadedFile_=null,c.preventDefault();else return!0;return!1};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.wizardCancelSuccess=function(a,c,d){!1!==this.handleJson(d)&&this.trigger("wizardCancel")};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.handleFileUploaded=function(a,c,d){this.uploadedFile_=d};a.pkp.controllers.wizard.fileUpload.FileUploadWizardHandler.prototype.startWizard=function(){this.uploadedFile_=null;this.parent("startWizard")}})(jQuery);(function(a){a.pkp.controllers.wizard.fileUpload.form=a.pkp.controllers.wizard.fileUpload.form||{};a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler=function(a,c){this.parent(a,c);this.hasFileSelector_=c.hasFileSelector;this.hasGenreSelector_=c.hasGenreSelector;c.presetRevisedFileId&&(this.presetRevisedFileId_=c.presetRevisedFileId);this.fileGenres_=c.fileGenres;this.attachUploader_(c.$uploader,c.uploaderOptions);this.uploaderSetup(c.$uploader);var d;a.find("#revisedFileId").change(this.callbackWrapper(this.revisedFileChange));
this.hasGenreSelector_&&(d=a.find("#genreId"),d.change(this.callbackWrapper(this.genreChange)),a.find(".plupload_button.plupload_start").hide())};a.pkp.classes.Helper.inherits(a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.hasFileSelector_=!1;a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.hasGenreSelector_=!1;a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.presetRevisedFileId_=
null;a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.fileGenres_=null;a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.uploaderSetup=function(a){a=a.plupload("getUploader");a.bind("BeforeUpload",this.callbackWrapper(this.prepareFileUploadRequest));a.bind("FileUploaded",this.callbackWrapper(this.handleUploadResponse))};a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.prepareFileUploadRequest=function(a,c){var d=this.getHtmlElement(),e=
{},f=d.find("#uploaderUserGroupId");f.attr("disabled","disabled");e.uploaderUserGroupId=f.val();this.hasFileSelector_?(f=d.find("#revisedFileId"),f.attr("disabled","disabled"),e.revisedFileId=f.val()):e.revisedFileId=null!==this.presetRevisedFileId_?this.presetRevisedFileId_:0;this.hasGenreSelector_?(d=d.find("#genreId"),d.attr("disabled","disabled"),e.genreId=d.val()):e.genreId="";c.settings.multipart_params=e};a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.handleUploadResponse=
function(b,c,d,e){b=this.handleJson(a.parseJSON(e.response));c=this.getHtmlElement();!1!==b&&(this.trigger("fileUploaded",b.uploadedFile),""===b.content?(c.find(":file").attr("disabled","disabled"),c.find("a.plupload_add").button("disable"),this.trigger("formValid")):this.getHtmlElement().replaceWith(b.content))};a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.submitForm=function(){this.trigger("formSubmitted")};a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.revisedFileChange=
function(){var a=this.getHtmlElement(),c=a.find("#revisedFileId"),d=a.find("#genreId");""===c.val()?d.removeAttr("disabled"):(d.val(this.fileGenres_[c.val()]),d.attr("disabled","disabled"),a.find(".plupload_button.plupload_start").show());return!1};a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.genreChange=function(){var a=this.getHtmlElement();""===a.find("#genreId").val()?a.find(".plupload_button.plupload_start").hide():a.find(".plupload_button.plupload_start").show()};
a.pkp.controllers.wizard.fileUpload.form.FileUploadFormHandler.prototype.attachUploader_=function(a,c){a.pkpHandler("$.pkp.controllers.UploaderHandler",c)}})(jQuery);(function(a){a.pkp.controllers.wizard.fileUpload.form.RevisionConfirmationHandler=function(a,c){this.parent(a,c);a.find("#possibleRevision").show("slide");this.trigger("unregisterChangedForm");this.bind("wizardAdvanceRequested",this.wizardAdvanceRequested);this.trackFormChanges=!1};a.pkp.classes.Helper.inherits(a.pkp.controllers.wizard.fileUpload.form.RevisionConfirmationHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.wizard.fileUpload.form.RevisionConfirmationHandler.prototype.wizardAdvanceRequested=
function(a,c){var d=this.getHtmlElement();0<parseInt(d.find("#revisedFileId").val(),10)&&(d.submit(),c.preventDefault())};a.pkp.controllers.wizard.fileUpload.form.RevisionConfirmationHandler.prototype.handleResponse=function(a,c){!0===c.status&&this.trigger("fileUploaded",c.uploadedFile);return this.parent("handleResponse",a,c)}})(jQuery);(function(a){a.pkp.controllers.tab=a.pkp.controllers.tab||{settings:{form:{}}};a.pkp.controllers.tab.settings.form.FileViewFormHandler=function(a,c){this.parent(a,c);this.fetchFileUrl_=c.fetchFileUrl;this.bind("dataChanged",this.refreshForm_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.settings.form.FileViewFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.tab.settings.form.FileViewFormHandler.prototype.fetchFileUrl_=null;a.pkp.controllers.tab.settings.form.FileViewFormHandler.prototype.refreshForm_=
function(b,c,d){a.get(this.fetchFileUrl_,{settingName:d},this.callbackWrapper(this.refreshResponseHandler_),"json")};a.pkp.controllers.tab.settings.form.FileViewFormHandler.prototype.refreshResponseHandler_=function(a,c){var d,e=this.handleJson(c);e.noData?(d=this.getFileHtmlElement_(e.noData),d.empty()):(d=this.getFileHtmlElement_(e.elementId),d.html(e.content))};a.pkp.controllers.tab.settings.form.FileViewFormHandler.prototype.getFileHtmlElement_=function(b){var c=this.getHtmlElement();return a("#"+
b,c)}})(jQuery);(function(a){a.pkp.controllers.tab.settings.announcements=a.pkp.controllers.tab.settings.announcements||{form:{}};a.pkp.controllers.tab.settings.announcements.form.AnnouncementSettingsFormHandler=function(b,c){this.parent(b,c);a("#enableAnnouncementsHomepage",b).click(this.callbackWrapper(this.toggleEnableAnnouncementsHomepage))};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.settings.announcements.form.AnnouncementSettingsFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.tab.settings.announcements.form.AnnouncementSettingsFormHandler.prototype.toggleEnableAnnouncementsHomepage=
function(){var b=a("#numAnnouncementsHomepage",this.getHtmlElement());b.attr("disabled")?b.removeAttr("disabled"):b.attr("disabled","disabled")}})(jQuery);(function(a){a.pkp.controllers.tab.settings.permissions=a.pkp.controllers.tab.settings.permissions||{form:{}};a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler=function(b,c){this.parent(b,c);a("#licenseURLSelect",b).change(this.callbackWrapper(this.licenseURLSelectChange));a('input[id^="licenseURL-"]',b).keyup(this.callbackWrapper(this.licenseURLOtherChange));a('input[id^="copyrightHolderType-"]',b).change(this.callbackWrapper(this.copyrightHolderRadioSelect));a("#resetPermissionsButton",
b).button().click(this.callbackWrapper(this.resetPermissionsHandler));this.resetPermissionsUrl=c.resetPermissionsUrl;this.resetPermissionsConfirmText=c.resetPermissionsConfirmText};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler.prototype.resetPermissionsUrl=null;a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler.prototype.resetPermissionsConfirmText=
null;a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler.prototype.licenseURLSelectChange=function(){var a=this.getHtmlElement(),c=a.find("#licenseURLSelect");a.find('input[id^="licenseURL-"]').val(c.val())};a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler.prototype.licenseURLOtherChange=function(){this.getHtmlElement().find("#licenseURLSelect").val("")};a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler.prototype.copyrightHolderRadioSelect=
function(b){var c=this.getHtmlElement(),b=a(b),c=c.find('input[id^="copyrightHolderOther-"]');"other"===b.val()?c.removeAttr("disabled"):c.attr("disabled","disabled")};a.pkp.controllers.tab.settings.permissions.form.PermissionSettingsFormHandler.prototype.resetPermissionsHandler=function(){confirm(this.resetPermissionsConfirmText)&&a.post(this.resetPermissionsUrl,{},function(){a("body").trigger("notifyUser")})}})(jQuery);(function(a){a.pkp.controllers.tab.settings.paymentMethod=a.pkp.controllers.tab.settings.paymentMethod||{};a.pkp.controllers.tab.settings.paymentMethod.PaymentMethodHandler=function(a,c){this.parent(a,c);this.paymentMethodFormUrlTemplate_=c.paymentMethodFormUrlTemplate;this.bind("selectPaymentMethod",this.selectPaymentMethodHandler)};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.settings.paymentMethod.PaymentMethodHandler,a.pkp.classes.Handler);a.pkp.controllers.tab.settings.paymentMethod.PaymentMethodHandler.prototype.paymentMethodFormUrlTemplate_=
"";a.pkp.controllers.tab.settings.paymentMethod.PaymentMethodHandler.prototype.getPaymentMethodFormUrl_=function(b){a("#paymentPluginName").val(b);return this.paymentMethodFormUrlTemplate_.replace("PAYMENT_PLUGIN_NAME",b)};a.pkp.controllers.tab.settings.paymentMethod.PaymentMethodHandler.prototype.selectPaymentMethodHandler=function(b,c,d){0!==d?a.get(this.getPaymentMethodFormUrl_(d),this.callbackWrapper(this.showFetchedPaymentMethodForm_),"json"):a("#paymentMethodFormContainer").children().remove()};
a.pkp.controllers.tab.settings.paymentMethod.PaymentMethodHandler.prototype.showFetchedPaymentMethodForm_=function(b,c){var d=this.handleJson(c),e=a("#paymentMethodFormContainer");e.children().remove();e.append(d.content)}})(jQuery);(function(a){a.pkp.controllers.grid.notifications=a.pkp.controllers.grid.notifications||{};a.pkp.controllers.grid.notifications.NotificationsGridHandler=function(a,c){a.find('a[id*="markNew"]').mousedown(this.callbackWrapper(this.markNewHandler_));a.find('a[id*="markRead"]').mousedown(this.callbackWrapper(this.markReadHandler_));a.find('a[id*="deleteNotifications"]').mousedown(this.callbackWrapper(this.deleteHandler_));this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.notifications.NotificationsGridHandler,
a.pkp.controllers.grid.GridHandler);a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.markNewUrl_=null;a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.markReadUrl_=null;a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.deleteUrl_=null;a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.initialize=function(a){this.markNewUrl_=a.markNewUrl;this.markReadUrl_=a.markReadUrl;this.deleteUrl_=a.deleteUrl;this.parent("initialize",
a)};a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.getSelectedNotifications_=function(){var b=[];this.getHtmlElement().find("input:checkbox:checked").each(function(){b.push(a(this).val())});return b};a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.markNewHandler_=function(){a.post(this.markNewUrl_,{selectedElements:this.getSelectedNotifications_()},this.callbackWrapper(this.responseHandler_,null),"json");return!1};a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.markReadHandler_=
function(){a.post(this.markReadUrl_,{selectedElements:this.getSelectedNotifications_()},this.callbackWrapper(this.responseHandler_,null),"json");return!1};a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.deleteHandler_=function(){a.post(this.deleteUrl_,{selectedElements:this.getSelectedNotifications_()},this.callbackWrapper(this.responseHandler_,null),"json");return!1};a.pkp.controllers.grid.notifications.NotificationsGridHandler.prototype.responseHandler_=function(a,c){var d=
this.getFetchExtraParams();d.selectedNotificationIds=c.content;this.setFetchExtraParams(d);this.handleJson(c)}})(jQuery);(function(a){a.pkp.pages=a.pkp.pages||{header:{}};a.pkp.pages.header.HeaderHandler=function(a,c){this.options_=c;this.parent(a,c);a.find('[id^="toggleHelp"]').click(this.callbackWrapper(this.toggleInlineHelpHandler_));this.publishEvent("toggleInlineHelp")};a.pkp.classes.Helper.inherits(a.pkp.pages.header.HeaderHandler,a.pkp.classes.Handler);a.pkp.pages.header.HeaderHandler.prototype.options_=null;a.pkp.pages.header.HeaderHandler.prototype.toggleInlineHelpHandler_=function(){this.trigger("toggleInlineHelp");
return!1}})(jQuery);(function(a){a.pkp.pages.header.TasksHandler=function(b,c){this.options_=c;this.parent(b,c);a("#notificationsToggle").click(this.callbackWrapper(this.appendToggleIndicator_));this.bind("updateUnreadNotificationsCount",this.fetchUnreadNotificationsCountHandler_)};a.pkp.classes.Helper.inherits(a.pkp.pages.header.TasksHandler,a.pkp.classes.Handler);a.pkp.pages.header.TasksHandler.prototype.options_=null;a.pkp.pages.header.TasksHandler.prototype.appendToggleIndicator_=function(){var a=this.getHtmlElement(),
c=a.find("#notificationsPopover"),d=a.find("li.notificationsLinkContainer"),a=a.find("#notificationsToggle");c.toggle();d.toggleClass("expandedIndicator");a.toggleClass("expandedIndicator");d.hasClass("expandedIndicator")&&this.trigger("callWhenClickOutside",[{container:c.add(d),callback:this.callbackWrapper(this.appendToggleIndicator_),skipWhenVisibleModals:!0}])};a.pkp.pages.header.TasksHandler.prototype.fetchUnreadNotificationsCountHandler_=function(){a.get(this.options_.fetchUnreadNotificationsCountUrl,
this.callbackWrapper(this.updateUnreadNotificationsCountHandler_),"json")};a.pkp.pages.header.TasksHandler.prototype.updateUnreadNotificationsCountHandler_=function(a,c){var d=this.getHtmlElement().find("#unreadNotificationCount");d.html(c.content);"0"==c.content?d.removeClass("hasTasks"):d.addClass("hasTasks")}})(jQuery);(function(a){a.pkp.pages.admin=a.pkp.pages.admin||{};a.pkp.pages.admin.ContextsHandler=function(b,c){var d=a("#openWizard a");d&&d.attr("style","display:none");this.parent(b,c)};a.pkp.classes.Helper.inherits(a.pkp.pages.admin.ContextsHandler,a.pkp.classes.Handler)})(jQuery);(function(a){a.pkp.pages.submission=a.pkp.pages.submission||{};a.pkp.pages.submission.SubmissionTabHandler=function(a,c){this.parent(a,c);this.submissionProgress_=c.submissionProgress;this.bind("setStep",this.setStepHandler);this.getHtmlElement().tabs("option","disabled",this.getDisabledSteps(this.submissionProgress_))};a.pkp.classes.Helper.inherits(a.pkp.pages.submission.SubmissionTabHandler,a.pkp.controllers.TabHandler);a.pkp.pages.submission.SubmissionTabHandler.prototype.submissionProgress_=null;
a.pkp.pages.submission.SubmissionTabHandler.prototype.setStepHandler=function(a,c,d){this.getHtmlElement().tabs("option","disabled",this.getDisabledSteps(d));this.getHtmlElement().tabs("option","active",d-1)};a.pkp.pages.submission.SubmissionTabHandler.prototype.getDisabledSteps=function(a){switch(parseInt(a,10)){case 0:return[];case 1:return[1,2,3,4];case 2:return[2,3,4];case 3:return[3,4];case 4:return[]}throw Error("Illegal submission step number!");}})(jQuery);(function(a){a.pkp.controllers.grid.settings=a.pkp.controllers.grid.settings||{user:{form:{}}};a.pkp.controllers.grid.settings.user.form.UserFormHandler=function(b,c){this.parent(b,c);a('[id^="generatePassword"]',b).click(this.callbackWrapper(this.setGenerateRandom));a('[id^="generatePassword"]',b).attr("checked")&&this.setGenerateRandom('[id^="generatePassword"]')};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.settings.user.form.UserFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.grid.settings.user.form.UserFormHandler.prototype.submitForm=
function(b,c){var d=this.getHtmlElement();a(":password",d).removeAttr("disabled");this.parent("submitForm",b,c)};a.pkp.controllers.grid.settings.user.form.UserFormHandler.prototype.setGenerateRandom=function(b){var b=a(b),c=this.getHtmlElement(),d="",e=0;b.prop("checked")?(d="********",e="disabled"):e=d="";a(":password",c).prop("disabled",e).val(d);a('[id^="sendNotify"]',c).attr("disabled",e).prop("checked",e)}})(jQuery);(function(a){a.pkp.controllers.grid.settings.roles=a.pkp.controllers.grid.settings.roles||{form:{}};a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler=function(b,c){var d=a('[id^="roleId"]',b);this.parent(b,c);c.selfRegistrationRoleIds&&(this.selfRegistrationRoleIds_=c.selfRegistrationRoleIds);this.roleForbiddenStages_=c.roleForbiddenStagesJSON.content;this.stagesSelector_=c.stagesSelector;this.updatePermitSelfRegistration(d.val());this.updateStageOptions(d.val());d.change(this.callbackWrapper(this.changeRoleId))};
a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler.prototype.selfRegistrationRoleIds_=null;a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler.prototype.roleForbiddenStages_=null;a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler.prototype.stagesSelector_=null;a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler.prototype.changeRoleId=
function(b){b=a(b).val();this.updatePermitSelfRegistration(b);this.updateStageOptions(b)};a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler.prototype.updatePermitSelfRegistration=function(b){var c=a('[id^="permitSelfRegistration"]');this.getHtmlElement();var d,e=!1;for(d=0;d<this.selfRegistrationRoleIds_.length;d++)this.selfRegistrationRoleIds_[d]==b&&(e=!0);e?c.removeAttr("disabled"):(c.attr("disabled","disabled"),c.removeAttr("checked"))};a.pkp.controllers.grid.settings.roles.form.UserGroupFormHandler.prototype.updateStageOptions=
function(b){var c=this.getHtmlElement(),d=c.find("#userGroupStageContainer"),e=a(this.stagesSelector_,c).filter("input"),f,g=null;e.removeAttr("disabled");if(void 0!=this.roleForbiddenStages_[b])for(f=0;f<this.roleForbiddenStages_[b].length;f++)g=this.roleForbiddenStages_[b][f],e.filter('input[value="'+g+'"]').attr("disabled","disabled");0==c.find("input[id^='assignedStages-']:enabled").length?(d.hide("slow"),a("#showTitle").attr("disabled","disabled")):(d.show("slow"),a("#showTitle").removeAttr("disabled"))}})(jQuery);(function(a){a.pkp.controllers.grid.files=a.pkp.controllers.grid.files||{signoff:{form:{}}};a.pkp.controllers.grid.files.signoff.form.AddAuditorFormHandler=function(b,c){this.parent(b,c);var d=new Date,e=d.getMonth()+1,f=d.getDate()+7,d=d.getFullYear();a('input[id^="responseDueDate"]').datepicker({dateFormat:"mm-dd-yy",minDate:"0",autoSize:!0});a('input[id^="responseDueDate"]').datepicker("setDate",e+"-"+f+"-"+d)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.files.signoff.form.AddAuditorFormHandler,
a.pkp.controllers.form.AjaxFormHandler)})(jQuery);(function(a){a.pkp.controllers.tab.settings.siteAccessOptions=a.pkp.controllers.tab.settings.siteAccessOptions||{form:{}};a.pkp.controllers.tab.settings.siteAccessOptions.form.SiteAccessOptionsFormHandler=function(b,c){this.parent(b,c);a("#disableUserReg-0",b).click(this.callbackWrapper(this.changeRegOptsState));a("#disableUserReg-1",b).click(this.callbackWrapper(this.changeRegOptsState))};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.settings.siteAccessOptions.form.SiteAccessOptionsFormHandler,
a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.tab.settings.siteAccessOptions.form.SiteAccessOptionsFormHandler.prototype.changeRegOptsState=function(a){"disableUserReg-0"===a.id?this.setRegOptsDisabled_(!1):(this.setRegOptsDisabled_(!0),this.setRegOptsChecked_(!1))};a.pkp.controllers.tab.settings.siteAccessOptions.form.SiteAccessOptionsFormHandler.prototype.setRegOptsDisabled_=function(b){b?a('[id^="allow"]').attr("disabled","disabled"):a('[id^="allow"]').removeAttr("disabled")};a.pkp.controllers.tab.settings.siteAccessOptions.form.SiteAccessOptionsFormHandler.prototype.setRegOptsChecked_=
function(b){b?a('[id^="allow"]').attr("checked","checked"):a('[id^="allow"]').removeAttr("checked")}})(jQuery);(function(a){a.pkp.controllers.tab.settings.managementSettings=a.pkp.controllers.tab.managementSettings||{};a.pkp.controllers.tab.settings.managementSettings.UsersAndRolesTabHandler=function(a,c){this.parent(a,c);this.bind("confirmationModalConfirmed",this.confirmationModalConfirmedHandler_);c.userGridContentUrl&&(this.userGridContentUrl_=c.userGridContentUrl)};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.settings.managementSettings.UsersAndRolesTabHandler,a.pkp.controllers.TabHandler);a.pkp.controllers.tab.settings.managementSettings.UsersAndRolesTabHandler.prototype.userGridContentUrl_=
null;a.pkp.controllers.tab.settings.managementSettings.UsersAndRolesTabHandler.prototype.confirmationModalConfirmedHandler_=function(b,c,d){b=a.parseJSON(d);this.userGridContentUrl_&&b.content.oldUserId&&(this.getHtmlElement(),a.get(this.userGridContentUrl_+"&oldUserId="+encodeURIComponent(b.content.oldUserId),null,this.callbackWrapper(this.updateTabsHandler_),"json"))};a.pkp.controllers.tab.settings.managementSettings.UsersAndRolesTabHandler.prototype.updateTabsHandler_=function(b,c){var d=this.handleJson(c),
e=this.getHtmlElement().find("div").first();a(e).replaceWith(d.content)}})(jQuery);(function(a){a.pkp.controllers.tab.workflow=a.pkp.controllers.tab.workflow||{};a.pkp.controllers.tab.workflow.WorkflowTabHandler=function(a,c){var d,e,f,g;this.parent(a,c);if(d=document.location.toString().match("workflow/([^/]+)/")){d=d[1];g=a.find("li a");for(f=0;f<g.length;f++)e=RegExp(d),g[f].getAttribute("class").match(e)&&(c.selected=f)}};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.workflow.WorkflowTabHandler,a.pkp.controllers.TabHandler)})(jQuery);(function(a){a.pkp.controllers.tab.representations=a.pkp.controllers.tab.representations||{};a.pkp.controllers.tab.representations.RepresentationsTabHandler=function(b,c){if(void 0!==c.currentRepresentationTabId){var d=a("#representation"+c.currentRepresentationTabId,b).parent("li");d.length&&(c.selected=b.children().children().index(d))}this.parent(b,c);this.tabsUrl_=c.tabsUrl;this.bind("refreshTabs",this.refreshTabsHandler_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.representations.RepresentationsTabHandler,
a.pkp.controllers.TabHandler);a.pkp.controllers.tab.representations.RepresentationsTabHandler.prototype.tabsUrl_=null;a.pkp.controllers.tab.representations.RepresentationsTabHandler.prototype.refreshTabsHandler_=function(){if(this.tabsUrl_){var b=null;this.getHtmlElement();var c=a("li.ui-tabs-selected",this.getHtmlElement()).find("a");c.length&&(b=c.attr("id"),b=a.trim(b.replace("representation"," ")));a.get(this.tabsUrl_,{currentRepresentationTabId:b},this.callbackWrapper(this.updateTabsHandler_),
"json")}};a.pkp.controllers.tab.representations.RepresentationsTabHandler.prototype.updateTabsHandler_=function(a,c){this.trigger("gridRefreshRequested");var d=this.handleJson(c),e=this.getHtmlElement();!1!==d&&e.replaceWith(d.content)}})(jQuery);(function(a){a.pkp.controllers.dashboard=a.pkp.controllers.dashboard||{form:{}};a.pkp.controllers.dashboard.form.DashboardTaskFormHandler=function(b,c){this.parent(b,c);this.singleContextSubmissionUrl_=c.singleContextSubmissionUrl;a("#singleContext",b).click(this.callbackWrapper(this.startSingleContextSubmission_));a("#multipleContext",b).change(this.callbackWrapper(this.startMultipleContextSubmission_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.dashboard.form.DashboardTaskFormHandler,a.pkp.controllers.form.FormHandler);
a.pkp.controllers.dashboard.form.DashboardTaskFormHandler.prototype.singleContextSubmissionUrl_=null;a.pkp.controllers.dashboard.form.DashboardTaskFormHandler.prototype.startSingleContextSubmission_=function(){window.location.href=this.singleContextSubmissionUrl_};a.pkp.controllers.dashboard.form.DashboardTaskFormHandler.prototype.startMultipleContextSubmission_=function(){var a=this.getHtmlElement().find("#multipleContext").val();0!=a&&(window.location.href=a)}})(jQuery);jQuery.pkp.controllers.informationCenter=jQuery.pkp.controllers.informationCenter||{};
(function(a){a.pkp.controllers.informationCenter.NotesHandler=function(a,c){this.parent(a,c);this.fetchNotesUrl_=c.fetchNotesUrl;this.fetchPastNotesUrl_=c.fetchPastNotesUrl;this.bind("formSubmitted",this.handleRefreshNoteList);this.loadPastNoteList_();this.loadNoteList_()};a.pkp.classes.Helper.inherits(a.pkp.controllers.informationCenter.NotesHandler,a.pkp.classes.Handler);a.pkp.controllers.informationCenter.NotesHandler.prototype.fetchNotesUrl_="";a.pkp.controllers.informationCenter.NotesHandler.prototype.fetchPastNotesUrl_=
"";a.pkp.controllers.informationCenter.NotesHandler.prototype.handleRefreshNoteList=function(b){a(b).find('[id^="newNote"]').val("");this.loadNoteList_()};a.pkp.controllers.informationCenter.NotesHandler.prototype.loadNoteList_=function(){a.get(this.fetchNotesUrl_,this.callbackWrapper(this.setNoteList_),"json")};a.pkp.controllers.informationCenter.NotesHandler.prototype.setNoteList_=function(b,c){var d=this.handleJson(c);a("#notesList").replaceWith(d.content);this.getHtmlElement().find(".showMore, .showLess").bind("click",
this.switchViz);a("#notesAccordion").hasClass("ui-accordion")?a("#notesAccordion").accordion("destroy").accordion({clearStyle:!0}):a("#notesAccordion").accordion({clearStyle:!0})};a.pkp.controllers.informationCenter.NotesHandler.prototype.loadPastNoteList_=function(){a("#pastNotesList").length&&a.get(this.fetchPastNotesUrl_,this.callbackWrapper(this.setPastNoteList_),"json")};a.pkp.controllers.informationCenter.NotesHandler.prototype.setPastNoteList_=function(b,c){this.handleJson(c);a("#pastNotesList").replaceWith(c.content)}})(jQuery);(function(a){a.pkp.controllers.informationCenter.SignoffNotesHandler=function(a,c){this.parent(a,c);this.signoffNotesFormUrl_=c.signoffNotesFormUrl;this.bind("selectSignoff",this.handleRefreshNotesForm_);this.bind("dropDownOptionSet",this.handleDropDownOptionSet_);var d=null;c.signoffId&&(d=c.signoffId);this.loadNoteForm_(d)};a.pkp.classes.Helper.inherits(a.pkp.controllers.informationCenter.SignoffNotesHandler,a.pkp.classes.Handler);a.pkp.controllers.informationCenter.SignoffNotesHandler.prototype.signoffNotesFormUrl_=
"";a.pkp.controllers.informationCenter.SignoffNotesHandler.prototype.handleRefreshNotesForm_=function(b,c,d){0!==d?this.loadNoteForm_(d):a("#signoffNotesFormContainer").children().remove()};a.pkp.controllers.informationCenter.SignoffNotesHandler.prototype.handleDropDownOptionSet_=function(){var b=a("#signoffSelect",this.getHtmlElement()),c;2==a("option",b).length&&(c=a("option",b).next().val(),b.val(c),this.loadNoteForm_(c))};a.pkp.controllers.informationCenter.SignoffNotesHandler.prototype.loadNoteForm_=
function(b){void 0!==b&&b&&a.get(this.signoffNotesFormUrl_,{signoffId:b},this.callbackWrapper(this.showFetchedNoteForm_),"json")};a.pkp.controllers.informationCenter.SignoffNotesHandler.prototype.showFetchedNoteForm_=function(b,c){var d=this.handleJson(c),e=a("#signoffNotesFormContainer");e.children().remove();e.append(d.content)}})(jQuery);(function(a){a.pkp.controllers.statistics=a.pkp.controllers.statistics||{};a.pkp.controllers.statistics.ReportGeneratorFormHandler=function(b,c){var d;c.trackFormChanges=!1;c.transformButtons=!1;this.parent(b,c);this.getHtmlElement().find(":submit").button();a("#reportUrlFormArea",b).hide();this.timeFilterWrapperSelector_=c.timeFilterWrapperSelector;this.rangeByDaySelector_=c.rangeByDaySelector;this.rangeByMonthSelector_=c.rangeByMonthSelector;this.startDayElementSelector_=c.startDayElementSelector;
this.endDayElementSelector_=c.endDayElementSelector;this.fetchFormUrl_=c.fetchFormUrl;this.$metricTypeSelectElement_=d=a(c.metricTypeSelectSelector,this.getHtmlElement());1==d.length&&d.change(this.callbackWrapper(this.fetchFormHandler_));this.$reportTemplateSelectElement_=d=a(c.reportTemplateSelectSelector,this.getHtmlElement());1==d.length&&d.change(this.callbackWrapper(this.fetchFormHandler_));this.columnsSelector_=c.columnsSelector;d=a(c.aggregationOptionsSelector);0<d.length&&d.change(this.callbackWrapper(this.aggregationOptionsChangeHandler_));
d=a(c.currentMonthSelector,this.getHtmlElement()).add(c.currentDaySelector,this.getHtmlElement()[0]);2==d.length&&d.click(this.callbackWrapper(this.currentTimeElementsClickHandler_));d=a(c.rangeByMonthSelector,this.getHtmlElement()).add(c.rangeByDaySelector,this.getHtmlElement()[0]);2==d.length&&d.click(this.callbackWrapper(this.rangeTimeElementsClickHandler_));this.dateRangeElementsWrapper_=a(c.dateRangeWrapperSelector,this.getHtmlElement());1==d.filter("input:checked").length?d.filter("input:checked").click():
this.dateRangeElementsWrapper_.hide();this.fileAssocTypes_=c.fileAssocTypes;this.$fileTypeSelectElement_=a(c.fileTypeSelectSelector,this.getHtmlElement());d=a(c.objectTypeSelectSelector,this.getHtmlElement());1==this.$fileTypeSelectElement_.length&&(this.$fileTypeSelectElement_.attr("disabled","disabled"),d.change(this.callbackWrapper(this.updateFileTypeSelectHandler_)));d.change();this.fetchRegionsUrl_=c.fetchRegionsUrl;this.$regionSelectElement_=a(c.regionSelectSelector,this.getHtmlElement());1==
this.$regionSelectElement_.length&&(d=a(c.countrySelectSelector,this.getHtmlElement()),d.change(this.callbackWrapper(this.fetchRegionHandler_)))};a.pkp.classes.Helper.inherits(a.pkp.controllers.statistics.ReportGeneratorFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.fetchFormUrl_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.fetchArticlesUrl_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.$metricTypeSelectElement_=
{};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.$reportTemplateSelectElement_={};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.$regionSelectElement_={};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.fetchRegionsUrl_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.$fileAssocTypes_={};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.rangeByDaySelector_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.rangeByMonthSelector_=
null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.startDayElementSelector_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.endDayElementSelector_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.timeFilterWrapperSelector_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.columnsSelector_=null;a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.handleResponse=function(b,c){var d=this.handleJson(c);
!1!==d&&void 0!==d.reportUrl&&(a("#reportUrlFormArea",this.getHtmlElement()).show().find(":input").val(d.reportUrl),window.location=d.reportUrl);this.parent("handleResponse",b,c);return!1};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.fetchFormHandler_=function(){var b,c={};b=a(this.timeFilterWrapperSelector_,this.getHtmlElement()).serializeArray();a.each(b,function(a,b){c[b.name]=b.value});b=a("option:selected",this.$metricTypeSelectElement_);void 0!==b[0]&&void 0!==b[0].value&&
(c.metricType=b[0].value);b=a("option:selected",this.$reportTemplateSelectElement_);void 0!==b[0]&&void 0!==b[0].value&&(c.reportTemplate=b[0].value);c.refreshForm=!0;a.get(this.fetchFormUrl_,c,this.callbackWrapper(this.handleResponse,null),"json");return!1};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.updateFileTypeSelectHandler_=function(b){var c,b=a(b),b=a("option:selected",b);if(1==b.length)for(c in b=b[0].value,this.fileAssocTypes_)if(this.fileAssocTypes_[c]==b)return this.$fileTypeSelectElement_.removeAttr("disabled"),
!1;this.$fileTypeSelectElement_.attr("disabled","disabled");return!1};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.fetchRegionHandler_=function(b){this.$regionSelectElement_.empty();b=a(b);b=a("option:selected",b);1==b.length&&(b=b[0].label,a.get(this.fetchRegionsUrl_,{countryId:b},this.callbackWrapper(this.updateRegionSelectCallback_,null),"json"));return!1};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.updateRegionSelectCallback_=function(b,c){var d,e,f,
g;d=this.$regionSelectElement_;d.empty();e=this.handleJson(c);if(!1!==e){f=e.content;g=0;for(e=f.length;g<e;g++)d.append(a("<option />").val(f[g].id).text(f[g].name))}return!1};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.currentTimeElementsClickHandler_=function(){this.dateRangeElementsWrapper_.hide();return!0};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.rangeTimeElementsClickHandler_=function(b){var c=a(this.startDayElementSelector_).add(this.endDayElementSelector_);
this.dateRangeElementsWrapper_.show();"#"+a(b).attr("id")==this.rangeByDaySelector_&&c.show();"#"+a(b).attr("id")==this.rangeByMonthSelector_&&c.hide();return!0};a.pkp.controllers.statistics.ReportGeneratorFormHandler.prototype.aggregationOptionsChangeHandler_=function(b){var c;c=a(this.columnsSelector_);b=a(b);c=c.find('option[value="'+b.attr("value")+'"]');b.attr("checked")?c.attr("selected","selected"):c.removeAttr("selected");return!1}})(jQuery);jQuery.pkp.pages.submission=jQuery.pkp.pages.submission||{};(function(a){a.pkp.pages.submission.SubmissionStep2FormHandler=function(a,c){this.parent(a,c);this.bind("urlInDivLoaded",this.showFileUploadWizard_)};a.pkp.classes.Helper.inherits(a.pkp.pages.submission.SubmissionStep2FormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.pages.submission.SubmissionStep2FormHandler.prototype.showFileUploadWizard_=function(b,c,d){"submissionFilesGridDiv"==d&&a("#"+d).find('[id*="-addFile-button-"]').click()}})(jQuery);jQuery.pkp.pages.submission=jQuery.pkp.pages.submission||{};
(function(a){a.pkp.pages.submission.SubmissionStep3FormHandler=function(b,c){this.parent(b,c);this.bind("gridRefreshRequested",this.fetchChaptersGrid_);this.authorsGridContainer_=c.authorsGridContainer;this.chaptersGridContainer_=c.chaptersGridContainer;(this.canExpedite_=c.canExpedite)&&a("#metadataAccordion").accordion({clearStyle:!0,collapsible:!0,active:!1})};a.pkp.classes.Helper.inherits(a.pkp.pages.submission.SubmissionStep3FormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.pages.submission.SubmissionStep3FormHandler.prototype.chaptersGridContainer_=
"";a.pkp.pages.submission.SubmissionStep3FormHandler.prototype.canExpedite_=!1;a.pkp.pages.submission.SubmissionStep3FormHandler.prototype.fetchChaptersGrid_=function(b,c){c.target.id==this.authorsGridContainer_&&a("#"+this.chaptersGridContainer_).find(".pkp_controllers_grid").trigger("dataChanged")}})(jQuery);(function(a){a.pkp.pages.workflow=a.pkp.pages.workflow||{};a.pkp.pages.workflow.WorkflowHandler=function(a,c){this.parent(a,c);this.bind("stageParticipantsChanged",this.handleStageParticipantsChanged_);this.bind("dataChanged",this.dataChangedHandler_)};a.pkp.classes.Helper.inherits(a.pkp.pages.workflow.WorkflowHandler,a.pkp.classes.Handler);a.pkp.pages.workflow.WorkflowHandler.prototype.handleStageParticipantsChanged_=function(){var b,c,d,e,f=this.getHtmlElement().find(".editorDecisionActions"),g=
this.getHtmlElement().find("#submissionProgressBarDiv");this.getHtmlElement().find("#stageTabs").find("li").each(function(){if(a(this).hasClass("ui-state-active")){c=a(this).find("a").attr("class");if(b=c.match(/stageId(\d)/)){d=b[1];var f=a.pkp.classes.Handler.getHandler(g);e=f.getSourceUrl();f.setSourceUrl(e.replace(/stageId=\d/,"stageId="+d))}return!1}});f.add(g).each(function(){a.pkp.classes.Handler.getHandler(a(this)).reload()})};a.pkp.pages.workflow.WorkflowHandler.prototype.dataChangedHandler_=
function(b,c,d){b=a(c.target,this.getHtmlElement()).children("a");b.length&&b.attr("id").match(/submissionEntry/)&&(b=a('[id^="formatsGridContainer"]',this.getHtmlElement()).children("div"),b.trigger("dataChanged",[d]),b.trigger("notifyUser",[b]))}})(jQuery);(function(a){a.pkp.pages.workflow.SubmissionHeaderHandler=function(b,c){this.parent(b,c);this.participantToggleSelector_=c.participantToggleSelector;a(this.participantToggleSelector_).click(this.callbackWrapper(this.appendToggleIndicator_));this.bind("gridRefreshRequested",this.refreshWorkflowContent_);this.publishEvent("stageParticipantsChanged")};a.pkp.classes.Helper.inherits(a.pkp.pages.workflow.SubmissionHeaderHandler,a.pkp.classes.Handler);a.pkp.pages.workflow.SubmissionHeaderHandler.prototype.participantToggleSelector_=
null;a.pkp.pages.workflow.SubmissionHeaderHandler.prototype.refreshWorkflowContent_=function(b,c){a(c.target).attr("id").match(/^stageParticipantGridContainer/)&&(this.trigger("stageParticipantsChanged"),a(this.participantToggleSelector_).click())};a.pkp.pages.workflow.SubmissionHeaderHandler.prototype.appendToggleIndicator_=function(){var a=this.getHtmlElement(),c=a.find(".participant_popover"),a=a.find(".pkp_submission_actions .participants");c.toggleClass("is_visible");a.toggleClass("is_open");
a.hasClass("is_open")&&this.trigger("callWhenClickOutside",[{container:c.add(a),callback:this.callbackWrapper(this.appendToggleIndicator_),skipWhenVisibleModals:!0}])}})(jQuery);(function(a){a.pkp.pages.workflow.EditorDecisionsHandler=function(b,c){this.parent(b,c);a("a",b).button()};a.pkp.classes.Helper.inherits(a.pkp.pages.workflow.EditorDecisionsHandler,a.pkp.classes.Handler)})(jQuery);(function(a){a.pkp.controllers.grid.users=a.pkp.controllers.grid.users||{reviewer:{form:{}}};a.pkp.controllers.grid.users.reviewer.AdvancedReviewerSearchHandler=function(b,c){this.parent(b,c);b.find(".button").button();a("#selectReviewerButton").click(this.callbackWrapper(this.reviewerSelected));a("#regularReviewerForm").hide();this.bind("refreshForm",this.handleRefresh_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.reviewer.AdvancedReviewerSearchHandler,a.pkp.classes.Handler);a.pkp.controllers.grid.users.reviewer.AdvancedReviewerSearchHandler.prototype.reviewerSelected=
function(){var b=this.getHtmlElement().find("#reviewerSelectGridContainer").find("input:checked"),c=b.val();c&&(b=a.trim(b.parent().next().children("span").text()),a("#reviewerId").val(c),a('input[id^="selectedReviewerName"]',this.getHtmlElement()).val(b),a("#searchGridAndButton").hide(),a("#regularReviewerForm").show())};a.pkp.controllers.grid.users.reviewer.AdvancedReviewerSearchHandler.prototype.handleRefresh_=function(a,c,d){d&&this.getHtmlElement().replaceWith(d)}})(jQuery);(function(a){a.pkp.controllers.grid.users.reviewer=a.pkp.controllers.grid.users.reviewer||{form:{}};a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler=function(a,c){this.parent(a,c);a.change(this.callbackWrapper(this.handleFormChange));this.bind("urlInDivLoaded",this.handleFileListLoad_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler.prototype.handleFormChange=
function(){this.getHtmlElement().find('input[name="selectedFiles[]"]:checked').length?this.hideWarning():this.showWarning()};a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler.prototype.hideWarning=function(){this.getHtmlElement().find("#noFilesWarning").hide(250)};a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler.prototype.showWarning=function(){this.getHtmlElement().find("#noFilesWarning").show(250)};a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler.prototype.handleFileListLoad_=
function(){this.getHtmlElement().change()}})(jQuery);(function(a){a.pkp.controllers.grid.users.reviewer.form.AddReviewerFormHandler=function(a,c){this.parent(a,c);c.templateUrl&&(this.templateUrl_=c.templateUrl);a.find("#template").change(this.callbackWrapper(this.selectTemplateHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.reviewer.form.AddReviewerFormHandler,a.pkp.controllers.grid.users.reviewer.form.EditReviewFormHandler);a.pkp.controllers.grid.users.reviewer.form.AddReviewerFormHandler.prototype.templateUrl_=null;a.pkp.controllers.grid.users.reviewer.form.AddReviewerFormHandler.prototype.showWarning=
function(){this.parent("showWarning");this.getHtmlElement().find("#reviewerFormFooter").trigger("expandFileList")};a.pkp.controllers.grid.users.reviewer.form.AddReviewerFormHandler.prototype.selectTemplateHandler_=function(){var b=this.getHtmlElement();a.post(this.templateUrl_,b.find("#template").serialize(),this.callbackWrapper(this.updateTemplate),"json")};a.pkp.controllers.grid.users.reviewer.form.AddReviewerFormHandler.prototype.updateTemplate=function(a,c){var d=this.getHtmlElement(),e=this.handleJson(c);
!1!==e&&""!==e.content&&d.find('textarea[name="personalMessage"]').val(e.content);return e.status}})(jQuery);(function(a){a.pkp.controllers.grid.users.reviewer.form.ReviewerFormFooterHandler=function(b,c){this.parent(b,c);a("#filesAccordion").accordion({collapsible:!0,active:!1,heightStyle:"content"});this.bind("expandFileList",this.handleExpandFileList_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.reviewer.form.ReviewerFormFooterHandler,a.pkp.classes.Handler);a.pkp.controllers.grid.users.reviewer.form.ReviewerFormFooterHandler.prototype.handleExpandFileList_=function(){var a=this.getHtmlElement().find("#filesAccordion");
!1===a.accordion("option","active")&&a.accordion("option","active","0")}})(jQuery);(function(a){a.pkp.controllers.grid.users.reviewer.form.AdvancedSearchReviewerFilterFormHandler=function(a,c){this.parent(a,c);this.initSlider_("#completeRange",0,100,'[id^="doneMin-"]','[id^="doneMax-"]');this.initSlider_("#activeRange",0,100,'[id^="activeMin-"]','[id^="activeMax-"]');this.initSlider_("#averageRange",0,365,'[id^="avgMin-"]','[id^="avgMax-"]');this.initSlider_("#lastRange",0,365,'[id^="lastMin-"]','[id^="lastMax-"]')};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.reviewer.form.AdvancedSearchReviewerFilterFormHandler,
a.pkp.controllers.form.ClientFormHandler);a.pkp.controllers.grid.users.reviewer.form.AdvancedSearchReviewerFilterFormHandler.prototype.initSlider_=function(b,c,d,e,f){var g=a(e),h=a(f);a(b).slider({range:!0,min:c,max:d,values:[g.val(),h.val()],slide:function(a,b){g.val(b.values[0]);h.val(b.values[1])}})}})(jQuery);(function(a){a.pkp.controllers.grid.users.stageParticipant=a.pkp.controllers.grid.users.stageParticipant||{form:{}};a.pkp.controllers.grid.users.stageParticipant.form.StageParticipantNotifyHandler=function(a,c){this.parent(a,c);c.templateUrl&&(this.templateUrl_=c.templateUrl);a.find("#template").change(this.callbackWrapper(this.selectTemplateHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.stageParticipant.form.StageParticipantNotifyHandler,a.pkp.controllers.form.AjaxFormHandler);
a.pkp.controllers.grid.users.stageParticipant.form.StageParticipantNotifyHandler.prototype.templateUrl_=null;a.pkp.controllers.grid.users.stageParticipant.form.StageParticipantNotifyHandler.prototype.selectTemplateHandler_=function(){var b=this.getHtmlElement();a.post(this.templateUrl_,b.find("#template").serialize(),this.callbackWrapper(this.updateTemplate),"json")};a.pkp.controllers.grid.users.stageParticipant.form.StageParticipantNotifyHandler.prototype.updateTemplate=function(a,c){var d=this.getHtmlElement(),
e=this.handleJson(c),f=c.content,d=d.find('textarea[name="message"]'),g=tinyMCE.EditorManager.get(d.attr("id"));d.attr("data-variables",JSON.stringify(f.variables));g.setContent(f.body);return e.status}})(jQuery);(function(a){a.pkp.controllers.grid.users.stageParticipant.form=a.pkp.controllers.grid.users.stageParticipant.form||{};a.pkp.controllers.grid.users.stageParticipant.form.AddParticipantFormHandler=function(b,c){this.parent(b,c);this.fetchUserListUrl_=c.fetchUserListUrl;a("#userGroupId",b).change(this.callbackWrapper(this.updateUserList));this.updateUserList()};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.users.stageParticipant.form.AddParticipantFormHandler,a.pkp.controllers.grid.users.stageParticipant.form.StageParticipantNotifyHandler);
a.pkp.controllers.grid.users.stageParticipant.form.AddParticipantFormHandler.prototype.fetchUserListUrl_=null;a.pkp.controllers.grid.users.stageParticipant.form.AddParticipantFormHandler.prototype.updateUserList=function(){var b=this.fetchUserListUrl_,c=this.getHtmlElement().find("#userGroupId"),b=b.replace(/(&userGroupId=\d+)?$/,"&userGroupId="+c.val());a.get(b,null,this.callbackWrapper(this.updateUserListHandler_),"json")};a.pkp.controllers.grid.users.stageParticipant.form.AddParticipantFormHandler.prototype.updateUserListHandler_=
function(b,c){var d=this.handleJson(c),e=this.getHtmlElement().find("#userId"),f,g;e.find('option[value!=""]').remove();for(f in d.content)g=a("<option/>"),g.attr("value",f),g.text(d.content[f]),e.append(g)}})(jQuery);(function(a){a.pkp.pages.reviewer=a.pkp.pages.reviewer||{};a.pkp.pages.reviewer.ReviewerTabHandler=function(a,c){this.parent(a,c);this.reviewStep_=c.reviewStep;this.bind("setStep",this.setStepHandler);this.getHtmlElement().tabs("option","disabled",this.getDisabledSteps(this.reviewStep_))};a.pkp.classes.Helper.inherits(a.pkp.pages.reviewer.ReviewerTabHandler,a.pkp.controllers.TabHandler);a.pkp.pages.reviewer.ReviewerTabHandler.prototype.reviewStep_=null;a.pkp.pages.reviewer.ReviewerTabHandler.prototype.setStepHandler=
function(a,c,d){this.getHtmlElement().tabs("option","disabled",this.getDisabledSteps(d));this.getHtmlElement().tabs("option","active",d-1)};a.pkp.pages.reviewer.ReviewerTabHandler.prototype.getDisabledSteps=function(a){switch(a){case 1:return[1,2,3];case 2:return[2,3];case 3:return[3];case 4:return[]}throw Error("Illegal review step number.");}})(jQuery);(function(a){a.pkp.pages.authorDashboard=a.pkp.pages.authorDashboard||{};a.pkp.pages.authorDashboard.SubmissionEmailHandler=function(a,c){this.parent(a,c);a.find('a[id^="submissionEmail"]').click(this.callbackWrapper(this.activateAction))};a.pkp.classes.Helper.inherits(a.pkp.pages.authorDashboard.SubmissionEmailHandler,a.pkp.controllers.linkAction.LinkActionHandler)})(jQuery);(function(a){a.pkp.controllers.grid.content=a.pkp.controllers.grid.content||{spotlights:{form:{}}};a.pkp.controllers.grid.content.spotlights.form.SpotlightFormHandler=function(b,c){this.parent(b,c);this.autocompleteUrl_=c.autocompleteUrl;a('[id^="assocId_input"]',b).keyup(this.callbackWrapper(this.addNameToAutocompleteUrl))};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.content.spotlights.form.SpotlightFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.grid.content.spotlights.form.SpotlightFormHandler.prototype.autocompleteUrl_=
null;a.pkp.controllers.grid.content.spotlights.form.SpotlightFormHandler.prototype.addNameToAutocompleteUrl=function(b){var c=this.getHtmlElement().find("#assocId_container"),c=a.pkp.classes.Handler.getHandler(c),d=this.autocompleteUrl_.replace("/(&name=[^&]*)/",""),d=d+("&name="+encodeURIComponent(b.value));c.setAutocompleteUrl(d)}})(jQuery);(function(a){a.pkp.controllers.modals.editorDecision.ApproveProofsHandler=function(a,c){this.parent(a,c);this.bind("gridRefreshRequested",this.callbackWrapper(function(){this.trigger("dataChanged")}))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modals.editorDecision.ApproveProofsHandler,a.pkp.classes.Handler)})(jQuery);(function(a){a.pkp.controllers.modals.catalogEntry=a.pkp.controllers.modals.catalogEntry||{form:{}};a.pkp.controllers.modals.catalogEntry.form.RepresentativeFormHandler=function(a,c){this.parent(a,c);a.find(":radio").change(this.callbackWrapper(this.radioToggleHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modals.catalogEntry.form.RepresentativeFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.modals.catalogEntry.form.RepresentativeFormHandler.prototype.radioToggleHandler_=
function(a){var c=this.getHtmlElement();"agent"==a.id?(c.find("#agentRole").parent().removeClass("hidden"),c.find("#agentRole").show(),c.find("#supplierRole").hide()):"supplier"==a.id&&(c.find("#agentRole").hide(),c.find("#supplierRole").parent().removeClass("hidden"),c.find("#supplierRole").show())}})(jQuery);(function(a){a.pkp.controllers.modals.catalogEntry.form.PublicationFormatMetadataFormHandler=function(a,c){this.parent(a,c);a.find("#override").click(this.callbackWrapper(this.overrideToggleHandler_));a.find("#override").triggerHandler("click")};a.pkp.classes.Helper.inherits(a.pkp.controllers.modals.catalogEntry.form.PublicationFormatMetadataFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.modals.catalogEntry.form.PublicationFormatMetadataFormHandler.prototype.overrideToggleHandler_=
function(b){var c=this.getHtmlElement().find('[id^="fileSize"]');a(b).is(":checked")?c.attr("disabled",""):c.attr("disabled","disabled")}})(jQuery);(function(a){a.pkp.controllers.modals.submissionMetadata=a.pkp.controllers.modals.submissionMetadata||{};a.pkp.controllers.modals.submissionMetadata.MonographlessCatalogEntryHandler=function(a,c){this.parent(a,c);this.metadataFormUrlTemplate_=c.metadataFormUrlTemplate;this.bind("selectMonograph",this.selectMonographHandler)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modals.submissionMetadata.MonographlessCatalogEntryHandler,a.pkp.classes.Handler);a.pkp.controllers.modals.submissionMetadata.MonographlessCatalogEntryHandler.prototype.metadataFormUrlTemplate_=
"";a.pkp.controllers.modals.submissionMetadata.MonographlessCatalogEntryHandler.prototype.getMetadataEditFormUrl_=function(a,c){return this.metadataFormUrlTemplate_.replace("MONOGRAPH_ID",a).replace("STAGE_ID",c)};a.pkp.controllers.modals.submissionMetadata.MonographlessCatalogEntryHandler.prototype.selectMonographHandler=function(b,c,d){parseInt(d,10)?a.get(this.getMetadataEditFormUrl_(d,a.pkp.cons.WORKFLOW_STAGE_ID_PRODUCTION),this.callbackWrapper(this.showFetchedMetadataForm_),"json"):a("#metadataFormContainer").children().remove()};
a.pkp.controllers.modals.submissionMetadata.MonographlessCatalogEntryHandler.prototype.showFetchedMetadataForm_=function(b,c){var d=this.handleJson(c),e=a("#metadataFormContainer");e.children().remove();e.append(d.content)}})(jQuery);(function(a){a.pkp.controllers.modals.expeditedSubmission=a.pkp.controllers.modals.expeditedSubmission||{form:{}};a.pkp.controllers.modals.expeditedSubmission.form.ExpeditedSubmissionMetadataFormHandler=function(b,c){this.parent(b,c);a('[name^="salesType"]',b).change(this.callbackWrapper(this.setPrices))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modals.expeditedSubmission.form.ExpeditedSubmissionMetadataFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.modals.expeditedSubmission.form.ExpeditedSubmissionMetadataFormHandler.prototype.setPrices=
function(){var a=this.getHtmlElement(),c=a.find('[name^="salesType"]:checked').val(),a=a.find('[id^="price"]');"openAccess"==c?(a.attr("disabled","disabled"),a.val("0")):"notAvailable"==c?(a.attr("disabled","disabled"),a.val("")):a.removeAttr("disabled")}})(jQuery);(function(a){a.pkp.controllers.grid.files.proof=a.pkp.controllers.grid.files.proof||{form:{}};a.pkp.controllers.grid.files.proof.form.ApprovedProofFormHandler=function(b,c){this.parent(b,c);this.salesType_=c.salesType;b.find("#notAvailable, #openAccess, #directSales").click(this.callbackWrapper(this.checkHandler_));var d=a('input[id^="price"]');d.change(this.callbackWrapper(this.changeHandler_));""!==this.salesType_&&(""===d.attr("value")?(a("#notAvailable").attr("checked","true"),d.attr("disabled",
"true")):"0"===d.attr("value")?(a("#openAccess").attr("checked","true"),d.attr("disabled","true").attr("value","")):a("#directSales").attr("checked","true"))};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.files.proof.form.ApprovedProofFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.grid.files.proof.form.ApprovedProofFormHandler.prototype.salesType_=null;a.pkp.controllers.grid.files.proof.form.ApprovedProofFormHandler.prototype.checkHandler_=function(b){var c=a('input[id^="price"]');
"directSales"===a(b).attr("id")?(c.removeAttr("disabled"),""===c.val()?this.disableFormControls():this.enableFormControls()):(c.attr("disabled","true"),this.enableFormControls());return!0};a.pkp.controllers.grid.files.proof.form.ApprovedProofFormHandler.prototype.changeHandler_=function(b){b=a(b);""===b.val()||isNaN(b.val())?this.disableFormControls():this.enableFormControls();return!0}})(jQuery);(function(a){a.pkp.controllers.tab.catalogEntry=a.pkp.controllers.tab.catalogEntry||{};a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler=function(a,c){c.selectedFormatId&&(c.selected=this.getTabPositionByFormatId_(c.selectedFormatId,a));this.parent(a,c);this.bind("gridRefreshRequested",this.gridRefreshRequested);c.tabsUrl&&(this.tabsUrl_=c.tabsUrl);c.tabContentUrl&&(this.tabContentUrl_=c.tabContentUrl);this.bind("gridInitialized",this.addFormatsGridRowActionHandlers_);this.publishEvent("gridInitialized")};
a.pkp.classes.Helper.inherits(a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler,a.pkp.controllers.TabHandler);a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.tabContentUrl_=null;a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.gridRefreshRequested=function(b,c){var d=a(c.target);d.attr("id").match(/^formatsGridContainer/)&&(this.tabsUrl_&&this.tabContentUrl_)&&(this.getHtmlElement(),a.get(this.tabsUrl_,null,this.callbackWrapper(this.updateTabsHandler_),
"json"));d.attr("id").match(/approvedProofGrid/)&&this.trigger("dataChanged")};a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.updateTabsHandler_=function(a,c){var d=this.handleJson(c),e=this.getHtmlElement(),f=e.find("li a"),g={},h=/publication(\d+)/,j,i,k;for(i=0;i<f.length;i++)k=f[i].getAttribute("id"),k=h.exec(k),null!==k&&(g[k[1]]=i);for(j in d.formats)g.hasOwnProperty(j)||(f=this.tabContentUrl_+"&representationId="+encodeURIComponent(j),f=f.replace(/[$]/g,"$$$$"),e.tabs("add",
f,d.formats[j]),e.find("li a").filter(":last").attr("id","publication"+j));for(j in g)d.formats.hasOwnProperty(j)?e.find("li a").filter('[id="publication'+j+'"]').html(d.formats[j]):e.tabs("remove",g[j])};a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.addFormatsGridRowActionHandlers_=function(){var b=a('[id^="formatsGridContainer"]',this.getHtmlElement());b.length&&(b=a('a[id*="publicationFormatTab"]',b),b.click(this.callbackWrapper(this.formatsGridLinkClickHandler_)))};a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.formatsGridLinkClickHandler_=
function(b){var c=a('[id^="formatsGridContainer"]',this.getHtmlElement()).children("div"),c=a.pkp.classes.Handler.getHandler(c),b=c.getParentRow(a(b)),b=c.getRowDataId(b);this.getHtmlElement().tabs({active:this.getTabPositionByFormatId_(b,this.getHtmlElement())})};a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.getTabPositionByFormatId_=function(b,c){var d=a("#publication"+b,c).parent("li");return d.length?c.find("li").index(d):null};a.pkp.controllers.tab.catalogEntry.CatalogEntryTabHandler.prototype.tabsReloadRequested=
function(b,c,d){var e=this.getHtmlElement();a.get(d.tabsUrl,function(b){b=a.parseJSON(b);e.unwrap();e.prev("div").remove();e.replaceWith(b.content)})}})(jQuery);(function(a){a.pkp.controllers.catalog=a.pkp.controllers.catalog||{form:{}};a.pkp.controllers.catalog.form.CatalogMetadataFormHandler=function(b,c){this.parent(b,c);a("#audienceRangeExact",b).change(this.callbackWrapper(this.ensureValidAudienceRanges_));c.arePermissionsAttached&&b.find("#attachPermissions").prop("checked",!0);a('input[id^="copyrightHolder-"]',b).keyup(this.callbackWrapper(this.checkAttachMetadata));a('input[id^="copyrightYear-"]',b).keyup(this.callbackWrapper(this.checkAttachMetadata));
a('input[id^="licenseURL-"]',b).keyup(this.callbackWrapper(this.checkAttachMetadata));a('input[id="confirm"]',b).change(function(){this.checked&&a("#attachPermissions").prop("checked",!0)})};a.pkp.classes.Helper.inherits(a.pkp.controllers.catalog.form.CatalogMetadataFormHandler,a.pkp.controllers.form.FileUploadFormHandler);a.pkp.controllers.catalog.form.CatalogMetadataFormHandler.prototype.audienceValues_=null;a.pkp.controllers.catalog.form.CatalogMetadataFormHandler.prototype.ensureValidAudienceRanges_=
function(b){var c=this.getHtmlElement();""!==a(b).val()?(this.audienceValues_=[c.find("#audienceRangeFrom").val(),c.find("#audienceRangeTo").val()],c.find("#audienceRangeFrom, #audienceRangeTo").val("").attr("disabled","disabled")):(c.find("#audienceRangeFrom, #audienceRangeTo").attr("disabled",""),c.find("#audienceRangeFrom").val(this.audienceValues_[0]),c.find("#audienceRangeTo").val(this.audienceValues_[1]))};a.pkp.controllers.catalog.form.CatalogMetadataFormHandler.prototype.checkAttachMetadata=
function(){this.getHtmlElement().find("#attachPermissions").prop("checked",!0)}})(jQuery);(function(a){a.pkp.controllers.monographList=a.pkp.controllers.monographList||{};a.pkp.controllers.monographList.MonographListHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.monographList.MonographListHandler,a.pkp.classes.Handler);a.pkp.controllers.monographList.MonographListHandler.prototype.getMonographs=function(){throw Error("Method must be implemented by subclasses.");};a.pkp.controllers.monographList.MonographListHandler.prototype.formatList=function(){for(var a=
this.getMonographs(),c=a.first().width()+10,d=this.getHtmlElement().width(),c=Math.floor(d/c),d=0;d<a.size();d+=c)a.slice(d,d+c).equalizeElementHeights()}})(jQuery);(function(a){a.pkp.pages.manageCatalog=a.pkp.pages.manageCatalog||{};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler=function(b,c){this.parent(b,c);this.searchTabIndex_=c.searchTabIndex;this.spotlightTabName_=c.spotlightTabName;this.seriesFetchUrlTemplate_=c.seriesFetchUrlTemplate;this.categoryFetchUrlTemplate_=c.categoryFetchUrlTemplate;this.spotlightsUrl_=c.spotlightsUrl;var d=a("#catalogTabs").tabs();d.tabs("disable",this.searchTabIndex_);this.bind("searchCatalog",this.searchCatalogHandler_);
this.bind("selectCategory",this.selectCategoryHandler_);this.bind("selectSeries",this.selectSeriesHandler_);d.bind("tabsselect",this.callbackWrapper(this.selectTabHandler_));d.bind("tabsshow",this.callbackWrapper(this.showTabHandler_));this.bind("dataChanged",this.dataChangedHandler_)};a.pkp.classes.Helper.inherits(a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler,a.pkp.classes.Handler);a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.searchTabIndex_=0;a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.spotlightTabName_=
null;a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.seriesFetchUrlTemplate_=null;a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.categoryFetchUrlTemplate_=null;a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.spotlightsUrl_=null;a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.getSeriesFetchUrl_=function(a){return this.seriesFetchUrlTemplate_.replace("SERIES_PATH",a)};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.getCategoryFetchUrl_=
function(a){return this.categoryFetchUrlTemplate_.replace("CATEGORY_PATH",a)};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.searchCatalogHandler_=function(b,c,d){var b=this.searchTabIndex_,c=a("#catalogTabs"),e=c.tabs("option","active");a("a[name='manageSearchResults']").attr("href",d);e===b?c.tabs("load",b):c.tabs("enable",b).tabs("option","active",b)};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.selectSeriesHandler_=function(b,c,d){a("#seriesContainer").children().remove();
"0"!==d&&a.get(this.getSeriesFetchUrl_(d),this.callbackWrapper(this.showFetchedSeries_),"json")};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.selectCategoryHandler_=function(b,c,d){a("#categoryContainer").children().remove();"0"!==d&&a.get(this.getCategoryFetchUrl_(d),this.callbackWrapper(this.showFetchedCategory_),"json")};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.selectTabHandler_=function(b,c,d){var e,f;"categoryTab"==d.panel.id&&(e=a(b).find("#categorySelect"),
f=e.find("option").first().val(),void 0!==f&&(e.find("option").eq(0).attr("selected","selected"),this.selectCategoryHandler_(b,c,f)));"seriesTab"==d.panel.id&&(e=a(b).find("#seriesSelect"),d=e.find("option").first().val(),void 0!==d&&(e.find("option").eq(0).attr("selected","selected"),this.selectSeriesHandler_(b,c,d)));return!0};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.showTabHandler_=function(){var b;a("#catalogTabs").tabs().tabs("option","active")!==this.searchTabIndex_&&(b=
this.getHtmlElement(),b.find('[id^="catalogSearch"]').val(""));return!0};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.loadSpotlightsContent_=function(b){a.get(b,function(b){b=a.parseJSON(b);a("#spotlightsTab").html(b.content)})};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.dataChangedHandler_=function(){var b=a("#catalogTabs").tabs(),c=b.tabs("option","active");switch(c){case 0:b.tabs("load",0);break;case 1:a("#selectCategoryForm",this.getHtmlElement()).trigger("containerReloadRequested");
break;case 2:a("#selectSeriesForm",this.getHtmlElement()).trigger("containerReloadRequested");break;case 3:case 4:this.searchTabIndex_==c?a("#catalogSearchForm",this.getHtmlElement()).trigger("submit"):this.loadSpotlightsContent_(this.spotlightsUrl_)}};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.showFetchedSeries_=function(b,c){var d=this.handleJson(c);a("#seriesContainer").append(d.content)};a.pkp.pages.manageCatalog.ManageCatalogHeaderHandler.prototype.showFetchedCategory_=function(b,
c){var d=this.handleJson(c);a("#categoryContainer").append(d.content)}})(jQuery);(function(a){a.pkp.pages.manageCatalog.ManageCatalogModalHandler=function(b,c){this.parent(b,c);a("#cancelFormButton",b).click(this.callbackWrapper(this.cancelForm))};a.pkp.classes.Helper.inherits(a.pkp.pages.manageCatalog.ManageCatalogModalHandler,a.pkp.controllers.form.FormHandler);a.pkp.pages.manageCatalog.ManageCatalogModalHandler.prototype.cancelForm=function(){this.trigger("containerReloadRequested");this.trigger("formCanceled");return!1}})(jQuery);(function(a){a.pkp.pages.manageCatalog.ManageCatalogSearchFormHandler=function(a,c){c.submitHandler=this.submitForm;this.parent(a,c);this.publishEvent("searchCatalog")};a.pkp.classes.Helper.inherits(a.pkp.pages.manageCatalog.ManageCatalogSearchFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.pages.manageCatalog.ManageCatalogSearchFormHandler.prototype.submitForm=function(){var a=this.getHtmlElement(),c=a.attr("action"),a=a.find(":input").val();this.trigger("searchCatalog",[c.replace("SEARCH_TEXT_DUMMY",
encodeURIComponent(a))])}})(jQuery);(function(a){a.pkp.pages.manageCatalog.MonographManagementListHandler=function(a,c){this.parent(a,c);a.find(".feature").click(this.callbackWrapper(this.featureButtonHandler_));this.bind("monographListChanged",this.monographListChangedHandler_);this.bind("monographSequencesChanged",this.monographSequencesChangedHandler_);this.useGridView()};a.pkp.classes.Helper.inherits(a.pkp.pages.manageCatalog.MonographManagementListHandler,a.pkp.controllers.monographList.MonographListHandler);a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.inFeatureMode_=
!1;a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.inGridMode_=null;a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.useGridView=function(){var b=a(this.getHtmlElement());b.find(".pkp_manageCatalog_monographList").removeClass("list_view").addClass("grid_view");this.resetElementHeights_();b=b.find(".submission_actions");b.find(".grid_view").addClass("ui-state-active");b.find(".list_view").removeClass("ui-state-active");this.inGridMode_=!0;return!1};a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.getMonographs=
function(){return this.getHtmlElement().find(".pkp_manageCatalog_monograph")};a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.featureButtonHandler_=function(){this.inFeatureMode_=!this.inFeatureMode_;var b=a(this.getHtmlElement()),c=b.find(".submission_actions").find(".feature"),b=b.find("ul.pkp_manageCatalog_monographList"),d=b.find(".pkp_manageCatalog_featureTools");this.inFeatureMode_?(c.css("font-weight","bold"),d.removeClass("pkp_helpers_invisible")):(c.css("font-weight","normal"),
d.addClass("pkp_helpers_invisible"));b.children().trigger("changeDragMode",[this.inFeatureMode_]);this.trigger("monographListChanged");return!1};a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.monographListChangedHandler_=function(){this.getHtmlElement().find("ul.pkp_manageCatalog_monographList").children("li").sortElements(function(b,c){var d=a.pkp.classes.Handler.getHandler(a(b)),e=a.pkp.classes.Handler.getHandler(a(c));return d.getFeatured()&&!e.getFeatured()?-1:e.getFeatured()&&
!d.getFeatured()?1:d.getFeatured()&&e.getFeatured()?d.getSeq()-e.getSeq():e.getDatePublished()-d.getDatePublished()});this.getHtmlElement().sortable("destroy");this.getHtmlElement().sortable({disabled:!this.inFeatureMode_,items:"li.pkp_manageCatalog_monograph:not(.not_sortable)",update:this.callbackWrapper(this.sortUpdateHandler_),start:function(b,c){a(c.placeholder).slideUp()},change:function(b,c){a(c.placeholder).hide().slideDown()}});this.resetElementHeights_();return!1};a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.monographSequencesChangedHandler_=
function(b,c,d){this.getHtmlElement().find("ul.pkp_manageCatalog_monographList").children("li").each(function(b,c){var g=a.pkp.classes.Handler.getHandler(a(c)),h=d[g.getId()];h&&g.trigger("setSequence",[h,!1])});this.trigger("monographListChanged");return!1};a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.sortUpdateHandler_=function(b,c,d){b=d.item;c=b.prev();d=b.next();if(c.length)c=a.pkp.classes.Handler.getHandler(c),c=c.getSeq()+1;else if(d.length)c=a.pkp.classes.Handler.getHandler(d),
c=c.getSeq()-1;else return!1;b.trigger("setSequence",[c]);return!1};a.pkp.pages.manageCatalog.MonographManagementListHandler.prototype.resetElementHeights_=function(){this.formatList()}})(jQuery);(function(a){a.pkp.pages.manageCatalog.MonographHandler=function(a,c){this.parent(a,c);this.submissionId_=c.submissionId;this.seq_=c.seq;this.setFeaturedUrlTemplate_=c.setFeaturedUrlTemplate;this.setNewReleaseUrlTemplate_=c.setNewReleaseUrlTemplate;this.isFeatured_=c.isFeatured;this.isNewRelease_=c.isNewRelease;this.datePublished_=c.datePublished;this.workflowUrl_=c.workflowUrl;this.catalogUrl_=c.catalogUrl;a.find('a[id^="featureMonograph"]').click(this.callbackWrapper(this.featureButtonHandler_));
a.find('a[id^="releaseMonograph"]').click(this.callbackWrapper(this.releaseButtonHandler_));a.unbind("click");a.find('a[id^="catalogEntry"]').click(this.callbackWrapper(this.activateAction));a.find('a[id^="itemWorkflow"]').click(this.callbackWrapper(this.workflowButtonHandler_));a.find('a[id^="publicCatalog"]').click(this.callbackWrapper(this.publicCatalogButtonHandler_));this.publishEvent("monographListChanged");this.publishEvent("monographSequencesChanged");this.bind("changeDragMode",this.changeDragModeHandler_);
this.bind("setSequence",this.setSequenceHandler_);var d=a.find(".pkp_manageCatalog_monograph_image").position(),e=a.find(".pkp_manageCatalog_featureTools").position();a.find(".pkp_manageCatalog_featureTools").css("position","relative").css("top",d.top-e.top)};a.pkp.classes.Helper.inherits(a.pkp.pages.manageCatalog.MonographHandler,a.pkp.controllers.linkAction.LinkActionHandler);a.pkp.pages.manageCatalog.MonographHandler.prototype.seq_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.datePublished_=
null;a.pkp.pages.manageCatalog.MonographHandler.prototype.submissionId_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.isFeatured_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.isNewRelease_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.workflowUrl_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.catalogUrl_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.setFeaturedUrlTemplate_=null;a.pkp.pages.manageCatalog.MonographHandler.prototype.setNewReleaseUrlTemplate_=
null;a.pkp.pages.manageCatalog.MonographHandler.prototype.getDatePublished=function(){return this.datePublished_};a.pkp.pages.manageCatalog.MonographHandler.prototype.getFeatured=function(){return this.isFeatured_};a.pkp.pages.manageCatalog.MonographHandler.prototype.getSeq=function(){return this.seq_};a.pkp.pages.manageCatalog.MonographHandler.prototype.getId=function(){return this.submissionId_};a.pkp.pages.manageCatalog.MonographHandler.prototype.getSetFeaturedUrl_=function(){return this.setFeaturedUrlTemplate_.replace("FEATURED_DUMMY",
this.isFeatured_?"1":"0").replace("SEQ_DUMMY",this.isFeatured_?this.seq_:a.pkp.cons.REALLY_BIG_NUMBER)};a.pkp.pages.manageCatalog.MonographHandler.prototype.getSetNewReleaseUrl_=function(){return this.setNewReleaseUrlTemplate_.replace("RELEASE_DUMMY",this.isNewRelease_?"1":"0")};a.pkp.pages.manageCatalog.MonographHandler.prototype.featureButtonHandler_=function(){this.isFeatured_=this.isFeatured_?!1:!0;a.get(this.getSetFeaturedUrl_(),this.callbackWrapper(this.handleSetFeaturedResponse_),"json");return!1};
a.pkp.pages.manageCatalog.MonographHandler.prototype.releaseButtonHandler_=function(){this.isNewRelease_=this.isNewRelease_?!1:!0;a.get(this.getSetNewReleaseUrl_(),this.callbackWrapper(this.handleSetNewReleaseResponse_),"json");return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.workflowButtonHandler_=function(){this.workflowUrl_&&(document.location=this.workflowUrl_);return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.publicCatalogButtonHandler_=function(){this.catalogUrl_&&
(document.location=this.catalogUrl_);return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.handleSetFeaturedResponse_=function(a,c){var d=this.handleJson(c),e=this.getHtmlElement();this.isFeatured_=null!==d.content?!0:!1;this.seq_=d.content;this.isFeatured_?(e.removeClass("not_sortable").addClass("pkp_helpers_moveicon"),e.find(".star").removeClass("star").addClass("star_highlighted")):(e.addClass("not_sortable").removeClass("pkp_helpers_moveicon"),e.find(".star_highlighted").addClass("star").removeClass("star_highlighted"));
this.trigger("monographListChanged");return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.handleSetNewReleaseResponse_=function(a,c){var d=this.handleJson(c),e=this.getHtmlElement();(this.isNewRelease_=null!==d.content?!0:!1)?e.find(".release").removeClass("release").addClass("release_highlighted"):e.find(".release_highlighted").addClass("release").removeClass("release_highlighted");return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.changeDragModeHandler_=function(a,c,d){a=this.getHtmlElement();
d?a.hasClass("not_sortable")||a.addClass("pkp_helpers_moveicon"):a.removeClass("pkp_helpers_moveicon");return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.setSequenceHandler_=function(b,c,d,e){void 0===e&&(e=!0);this.seq_=d;b=this.callbackWrapper(this.handleSetSequenceResponse_);e&&a.get(this.getSetFeaturedUrl_(),b,"json");return!1};a.pkp.pages.manageCatalog.MonographHandler.prototype.handleSetSequenceResponse_=function(a,c){var d=this.handleJson(c);this.trigger("monographSequencesChanged",
d.content);return!1}})(jQuery);(function(a){a.fn.pkpHandler=function(b,c){this.each(function(){var d=a(this);c=c||{};a.pkp.classes.Helper.objectFactory(b,[d,c])});return this};a.fn.pkpAjaxHtml=function(b,c){var d=this.first();a.ajax({url:b,dataType:"json",success:function(a){d.find("#loading").hide();!0===a.status?(a.content&&d.html(a.content),c&&c()):(d.trigger("ajaxHtmlError",a.content),alert(a.content))},error:function(){alert("Failed Ajax request or invalid JSON returned.")}});d.html("<div id='loading' class='throbber'></div>");
return this}})(jQuery);
