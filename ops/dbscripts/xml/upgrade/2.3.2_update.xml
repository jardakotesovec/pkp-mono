<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data SYSTEM "../../../lib/pkp/dtd/xmlData.dtd">

<!--
  * 2.3.2_update.xml
  *
  * Copyright (c) 2003-2010 John Willinsky
  * Distributed under the GNU GPL v2. For full terms see the file docs/COPYING.
  *
  * 2.3.2 database updates XML file.
  *
  * $Id$
  -->
<data>
	<!-- Bug #5124: port review forms to pkp-lib -->
	<sql>
		<query>UPDATE review_forms SET assoc_type = 256</query><!-- ASSOC_TYPE_JOURNAL -->
	</sql>
	<!-- Bug #4888: add "included" flag to review form elements -->
	<sql>
		<query>UPDATE review_form_elements SET included = 1</query>
	</sql>
	<!-- Bug #5234: add JQuery-based notification support -->
	<sql>
		<query>UPDATE notifications SET level = 2</query><!-- NOTIFICATION_LEVEL_NORMAL -->
	</sql>
	<!-- Bug #5310: Empty IP ranges stored in db -->
	<sql>
		<query>DELETE FROM institutional_subscription_ip WHERE ip_start = 0 AND ip_end IS NULL</query>
	</sql>
	<!-- Bug #5440: Migrate submission notes into PKP "notes" -->
	<sql>
		<query>UPDATE notes SET assoc_type = 257</query><!-- ASSOC_TYPE_ARTICLE -->
	</sql>
	<!-- Bug #5543: Implement multilingual specification -->
	<sql>
		<query driver="mysql">
			UPDATE articles a, journals j SET a.locale = j.primary_locale WHERE a.journal_id = j.journal_id
		</query>
		<query driver="postgres7">
			UPDATE articles SET locale = j.primary_locale FROM journals j WHERE articles.journal_id = j.journal_id
		</query>
		<!-- Use the current set of form locales as a default for supported submission locales -->
		<query>
			DELETE FROM journal_settings WHERE setting_name = 'supportedSubmissionLocales'
		</query>
		<query>
			INSERT INTO journal_settings (journal_id, locale, setting_name, setting_value, setting_type) SELECT journal_id, locale, 'supportedSubmissionLocales', setting_value, setting_type FROM journal_settings WHERE setting_name = 'supportedFormLocales'
		</query>
	</sql>
	<!-- Bug #5522: Add a publish/do not publish flag for group emails -->
	<sql>
		<query>UPDATE groups SET publish_email = 1</query>
	</sql>
</data>
