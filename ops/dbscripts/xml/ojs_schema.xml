<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE schema SYSTEM "../../lib/pkp/dtd/xmlSchema.dtd">

<!--
  * ojs_schema.xml
  *
  * Copyright (c) 2014-2019 Simon Fraser University
  * Copyright (c) 2003-2019 John Willinsky
  * Distributed under the GNU GPL v2. For full terms see the file docs/COPYING.
  *
  * OJS database schema in XML.
  *
  -->

<schema version="0.2">

	<!--
	  *
	  * TABLE journals
	  *
	  -->
	<table name="journals">
		<field name="journal_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="path" type="C2" size="32">
			<NOTNULL/>
		</field>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
			<descr>Used to order lists of journals</descr>
		</field>
		<field name="primary_locale" type="C2" size="14">
			<NOTNULL/>
		</field>
		<field name="enabled" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="1"/>
			<descr>Controls whether or not the journal is considered "live" and will appear on the website. (Note that disabled journals may still be accessible, but only if the user knows the URL.)</descr>
		</field>
		<descr>Journals and basic journal settings.</descr>
		<index name="journals_path">
			<col>path</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE journal_settings
	  *
	  -->
	<table name="journal_settings">
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="locale" type="C2" size="14">
			<NOTNULL/>
			<DEFAULT VALUE=""/>
		</field>
		<field name="setting_name" type="C2" size="255">
			<NOTNULL/>
		</field>
		<field name="setting_value" type="X"/>
		<descr>Journal settings.</descr>
		<index name="journal_settings_journal_id">
			<col>journal_id</col>
		</index>
		<index name="journal_settings_pkey">
			<col>journal_id</col>
			<col>locale</col>
			<col>setting_name</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE sections
	  *
	  -->
	<table name="sections">
		<field name="section_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="review_form_id" type="I8" />
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="editor_restricted" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="meta_indexed" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="meta_reviewed" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="1"/>
		</field>
		<field name="abstracts_not_required" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="hide_title" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="hide_author" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="abstract_word_count" type="I8" />
		<descr>Journal sections.</descr>
		<index name="sections_journal_id">
			<col>journal_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE section_settings
	  *
	  -->
	<table name="section_settings">
		<field name="section_id" type="I8">
			<NOTNULL />
		</field>
		<field name="locale" type="C2" size="14">
			<NOTNULL />
			<DEFAULT VALUE=""/>
		</field>
		<field name="setting_name" type="C2" size="255">
			<NOTNULL />
		</field>
		<field name="setting_value" type="X"/>
		<field name="setting_type" type="C2" size="6">
			<NOTNULL/>
			<descr>(bool|int|float|string|object)</descr>
		</field>
		<descr>Section-specific settings</descr>
		<index name="section_settings_section_id">
			<col>section_id</col>
		</index>
		<index name="section_settings_pkey">
			<col>section_id</col>
			<col>locale</col>
			<col>setting_name</col>
			<UNIQUE />
		</index>
	</table>

	<table name="custom_section_orders">
		<field name="issue_id" type="I8">
			<NOTNULL />
		</field>
		<field name="section_id" type="I8">
			<NOTNULL />
		</field>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<descr>Custom sequencing information for journal sections by issue, when available.</descr>
		<index name="custom_section_orders_pkey">
			<col>issue_id</col>
			<col>section_id</col>
			<UNIQUE/>
		</index>
	</table>

	<!--
      *
      * TABLE submission_tombstones
      *
      -->
    <table name="submission_tombstones">
        <field name="tombstone_id" type="I8">
            <KEY />
            <AUTOINCREMENT />
        </field>
        <field name="submission_id" type="I8">
            <NOTNULL />
        </field>
        <field name="date_deleted" type="T">
            <NOTNULL />
        </field>
        <field name="journal_id" type="I8">
            <NOTNULL />
        </field>
        <field name="section_id" type="I8">
            <NOTNULL />
        </field>
        <field name="set_spec" type="C2" size="255">
            <NOTNULL />
        </field>
        <field name="set_name" type="C2" size="255">
            <NOTNULL />
        </field>
        <field name="oai_identifier" type="C2" size="255">
            <NOTNULL />
        </field>
        <descr>Archived, removed from TOC, unscheduled or unpublished journal articles.</descr>
		<index name="submission_tombstones_journal_id">
			<col>journal_id</col>
		</index>
		<index name="submission_tombstones_submission_id">
			<col>submission_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE submissions
	  *
	  -->
	<table name="submissions">
		<field name="submission_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="locale" type="C2" size="14" />
		<field name="context_id" type="I8">
			<NOTNULL />
		</field>
		<field name="section_id" type="I8" />
		<field name="language" type="C2" size="10">
			<DEFAULT VALUE="en"/>
		</field>
		<field name="citations" type="X"/>
		<field name="date_submitted" type="T"/>
		<field name="last_modified" type="T"/>
		<field name="date_status_modified" type="T"/>
		<field name="status" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="1"/>
		</field>
		<field name="submission_progress" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="1"/>
		</field>

		<field name="pages" type="C2" size="255"/>
		<field name="hide_author" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="stage_id" type="I8">
			<NOTNULL/>
			<DEFAULT VALUE="1"/><!-- WORKFLOW_STAGE_ID_SUBMISSION -->
		</field>
		<field name="submission_version" type="I8">
      <NOTNULL/>
      <DEFAULT VALUE="1" />
    </field>
		<descr>Submissions</descr>
		<index name="submissions_journal_id">
			<col>journal_id</col>
		</index>
		<index name="submissions_section_id">
			<col>section_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE submission_settings
	  *
	  -->
	<table name="submission_settings">
		<field name="submission_id" type="I8">
			<NOTNULL />
		</field>
		<field name="locale" type="C2" size="14">
			<NOTNULL />
			<DEFAULT VALUE=""/>
		</field>
		<field name="setting_name" type="C2" size="255">
			<NOTNULL />
		</field>
		<field name="setting_value" type="X"/>
		<field name="setting_type" type="C2" size="6">
			<NOTNULL/>
			<descr>(bool|int|float|string|object)</descr>
		</field>
		<field name="submission_version" type="I8">
			<NOTNULL />
			<DEFAULT VALUE="1"/>
		</field>
		<descr>Submission metadata</descr>
		<index name="submission_settings_submission_id">
			<col>submission_id</col>
		</index>
		<index name="submission_settings_pkey">
			<col>submission_id</col>
			<col>submission_version</col>
			<col>locale</col>
			<col>setting_name</col>
			<UNIQUE/>
		</index>
	</table>

	<!--
	  *
	  * TABLE published_submissions
	  *
	  -->
	<table name="published_submissions">
		<field name="published_submission_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="submission_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="issue_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="date_published" type="T"/>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="access_status" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="published_submission_version" type="I8">
			<NOTNULL/>
			<DEFAULT VALUE="1" />
		</field>
		<field name="prev_ver_id" type="I8" />
		<field name="is_current_submission_version" type="I1">
			<NOTNULL />
			<DEFAULT VALUE="1" />
		</field>
		<descr>Published submissions</descr>
		<index name="published_submissions_submission_id">
			<col>submission_id</col>
		</index>
		<index name="published_submissions_issue_id">
			<col>issue_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE submission_galleys
	  *
	  -->
	<table name="submission_galleys">
		<field name="galley_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="locale" type="C2" size="14"/>
		<field name="submission_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="label" type="C2" size="255"/>
		<field name="file_id" type="I8"/>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="remote_url" type="C2" size="2047"/>
		<field name="is_approved" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="submission_version" type="I8">
			<NOTNULL/>
			<DEFAULT VALUE="1" />
		</field>
		<field name="prev_ver_id" type="I8" />
		<field name="is_current_submission_version" type="I1">
			<NOTNULL />
			<DEFAULT VALUE="1" />
		</field>
		<descr>Submission galleys</descr>
		<index name="submission_galleys_submission_id">
			<col>submission_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE submission_galley_settings
	  *
	  -->
	<table name="submission_galley_settings">
		<field name="galley_id" type="I8">
			<NOTNULL />
		</field>
		<field name="locale" type="C2" size="14">
			<NOTNULL />
			<DEFAULT VALUE=""/>
		</field>
		<field name="setting_name" type="C2" size="255">
			<NOTNULL />
		</field>
		<field name="setting_value" type="X"/>
		<field name="setting_type" type="C2" size="6">
			<NOTNULL/>
			<descr>(bool|int|float|string|object)</descr>
		</field>
		<descr>Article galley metadata.</descr>
		<index name="submission_galley_settings_galley_id">
			<col>galley_id</col>
		</index>
		<index name="submission_galley_settings_pkey">
			<col>galley_id</col>
			<col>locale</col>
			<col>setting_name</col>
			<UNIQUE/>
		</index>
	</table>

	<!--
	 *
	 * TABLE submission_search_keyword_list
	 *
	 -->
	<table name="submission_search_keyword_list">
		<field name="keyword_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="keyword_text" type="C2" size="60">
			<NOTNULL/>
		</field>
		<descr>List of all keywords.</descr>
		<index name="submission_search_keyword_text">
			<col>keyword_text</col>
			<UNIQUE/>
		</index>
	</table>

	<!--
	 *
	 * TABLE submission_search_objects
	 *
	 -->
	<table name="submission_search_objects">
		<field name="object_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="submission_id" type="I8">
			<NOTNULL />
		</field>
		<field name="type" type="I4">
			<NOTNULL />
			<descr>Type of item. E.g., abstract, fulltext, etc.</descr>
		</field>
		<field name="assoc_id" type="I8">
			<descr>Optional ID of an associated record (e.g., a file_id)</descr>
		</field>
		<descr>Indexed objects.</descr>
	</table>

	<!--
	 *
	 * TABLE submission_search_object_keywords
	 *
	 -->
	<table name="submission_search_object_keywords">
		<field name="object_id" type="I8">
			<NOTNULL />
		</field>
		<field name="keyword_id" type="I8">
			<NOTNULL />
		</field>
		<field name="pos" type="I4">
			<NOTNULL />
			<descr>Word position of the keyword in the object.</descr>
		</field>
		<descr>Keyword occurrences for each indexed object.</descr>
		<index name="submission_search_object_keywords_keyword_id">
			<col>keyword_id</col>
		</index>
		<index name="submission_search_object_keywords_pkey">
			<col>object_id</col>
			<col>pos</col>
			<UNIQUE />
		</index>
	</table>

	<!-- Reading Tools Tables -->

	<!--
	 *
	 * TABLE rt_versions
	 *
	 -->
	<table name="rt_versions">
		<field name="version_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="version_key" type="C2" size="40">
			<NOTNULL/>
		</field>
		<field name="locale" type="C2" size="14">
			<DEFAULT VALUE="en_US"/>
		</field>
		<field name="title" type="C2" size="120">
			<NOTNULL/>
		</field>
		<field name="description" type="X"/>
		<descr>Reading Tools versions.</descr>
		<index name="rt_versions_journal_id">
			<col>journal_id</col>
		</index>
		<index name="rt_versions_version_key">
			<col>version_key</col>
		</index>
	</table>

	<!--
	 *
	 * TABLE rt_contexts
	 *
	 -->
	<table name="rt_contexts">
		<field name="context_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="version_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="title" type="C2" size="120">
			<NOTNULL/>
		</field>
		<field name="abbrev" type="C2" size="32">
			<NOTNULL/>
		</field>
		<field name="description" type="X"/>
		<field name="cited_by" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="author_terms" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="define_terms" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="geo_terms" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<descr>Reading Tools contexts (within versions).</descr>
		<index name="rt_contexts_version_id">
			<col>version_id</col>
		</index>
	</table>

	<!--
	 *
	 * TABLE rt_searches
	 *
	 -->
	<table name="rt_searches">
		<field name="search_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="context_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="title" type="C2" size="120">
			<NOTNULL/>
		</field>
		<field name="description" type="X"/>
		<field name="url" type="X"/>
		<field name="search_url" type="X"/>
		<field name="search_post" type="X"/>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<descr>Reading Tools searches (within contexts).</descr>
		<index name="rt_searches_context_id">
			<col>context_id</col>
		</index>
	</table>

</schema>
