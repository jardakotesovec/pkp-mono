<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE schema SYSTEM "../dtd/xmlSchema.dtd">

<!--
  * pkp_schema.xml
  *
  * Copyright (c) 2000-2008 John Willinsky
  * Distributed under the GNU GPL v2. For full terms see the file docs/COPYING.
  *
  * PKP database schema in XML.
  *
  * $Id$
  -->

<schema version="0.2">
	<!--
	  *
	  * TABLE versions
	  *
	  -->
	<table name="versions">
		<field name="major" type="I4">
			<NOTNULL />
			<DEFAULT VALUE="0"/>
		</field>
		<field name="minor" type="I4">
			<NOTNULL />
			<DEFAULT VALUE="0"/>
		</field>
		<field name="revision" type="I4">
			<NOTNULL />
			<DEFAULT VALUE="0"/>
		</field>
		<field name="build" type="I4">
			<NOTNULL />
			<DEFAULT VALUE="0"/>
		</field>
		<field name="date_installed" type="T">
			<NOTNULL/>
		</field>
		<field name="current" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<descr>Installation and upgrade version history.</descr>
		<index name="versions_pkey">
			<col>major</col>
			<col>minor</col>
			<col>revision</col>
			<col>build</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE site
	  *
	  -->
	<table name="site">
		<field name="redirect" type="I8">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
			<descr>If not 0, redirect to the specified journal/conference site.</descr>
		</field>
		<field name="primary_locale" type="C2" size="5">
			<NOTNULL/>
			<descr>Primary locale for the site.</descr>
		</field>
		<field name="min_password_length" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="6"/>
		</field>
		<field name="installed_locales" type="C2" size="255">
			<NOTNULL/>
			<DEFAULT VALUE="en_US"/>
			<descr>Locales for which support has been installed.</descr>
		</field>
		<field name="supported_locales" type="C2" size="255">
			<descr>Locales supported by the site (for hosted journals/conferences).</descr>
		</field>
		<field name="original_style_file_name" type="C2" size="255"/>
		<descr>Common site settings.</descr>
	</table>

	<!--
	  *
	  * TABLE site_settings
	  *
	  -->
	<table name="site_settings">
		<field name="setting_name" type="C2" size="255">
			<NOTNULL />
		</field>
		<field name="locale" type="C2" size="5">
			<NOTNULL />
			<DEFAULT VALUE=""/>
		</field>
		<field name="setting_value" type="X"/>
		<field name="setting_type" type="C2" size="6">
			<NOTNULL />
			<descr>(bool|int|float|string|object)</descr>
		</field>
		<descr>Site settings.</descr>
		<index name="site_settings_pkey">
			<col>setting_name</col>
			<col>locale</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE scheduled_tasks
	  *
	  -->
	<table name="scheduled_tasks">
		<field name="class_name" type="C2" size="255">
			<NOTNULL/>
		</field>
		<field name="last_run" type="T" />
		<descr>The last run times of all scheduled tasks.</descr>
		<index name="scheduled_tasks_pkey">
			<col>class_name</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE auth_sources
	  *
	  -->
	<table name="auth_sources">
		<field name="auth_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="title" type="C2" size="60">
			<NOTNULL/>
		</field>
		<field name="plugin" type="C2" size="32">
			<NOTNULL/>
		</field>
		<field name="auth_default" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="settings" type="X"/>
		<descr>User authentication sources.</descr>
	</table>

	<!--
	  *
	  * TABLE users
	  *
	  -->
	<table name="users">
		<field name="user_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="username" type="C2" size="32">
			<NOTNULL/>
		</field>
		<field name="password" type="C2" size="40">
			<NOTNULL/>
		</field>
		<field name="salutation" type="C2" size="40"/>
		<field name="first_name" type="C2" size="40">
			<NOTNULL/>
		</field>
		<field name="middle_name" type="C2" size="40"/>
		<field name="last_name" type="C2" size="90">
			<NOTNULL/>
		</field>
		<field name="gender" type="C" size="1"/>
		<field name="initials" type="C2" size="5"/>
		<field name="affiliation" type="C2" size="255"/>
		<field name="email" type="C2" size="90">
			<NOTNULL/>
		</field>
		<field name="url" type="C2" size="255"/>
		<field name="phone" type="C2" size="24"/>
		<field name="fax" type="C2" size="24"/>
		<field name="mailing_address" type="C2" size="255"/>
		<field name="country" type="C2" size="90"/>
		<field name="locales" type="C2" size="255"/>
		<field name="date_last_email" type="T"/>
		<field name="date_registered" type="T">
			<NOTNULL/>
		</field>
		<field name="date_validated" type="T"/>
		<field name="date_last_login" type="T">
			<NOTNULL/>
		</field>
		<field name="must_change_password" type="I1"/>
		<field name="auth_id" type="I8"/>
		<field name="auth_str" type="C2" size="255"/>
		<field name="disabled" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="disabled_reason" type="X"/>
		<descr>User authentication credentials and profile data.</descr>
		<index name="users_username">
			<col>username</col>
			<UNIQUE />
		</index>
		<index name="users_email">
			<col>email</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE sessions
	  *
	  -->
	<table name="sessions">
		<field name="session_id" type="C2" size="32">
			<NOTNULL/>
		</field>
		<field name="user_id" type="I8"/>
		<field name="ip_address" type="C2" size="39">
			<NOTNULL/>
		</field>
		<field name="user_agent" type="C2" size="255"/>
		<field name="created" type="I8">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="last_used" type="I8">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="remember" type="I1">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="data" type="X">
			<NOTNULL/>
			<DEFAULT VALUE=""/>
		</field>
		<descr>Browser/user sessions and session data.</descr>
		<index name="sessions_user_id">
			<col>user_id</col>
		</index>
		<index name="sessions_pkey">
			<col>session_id</col>
			<UNIQUE />
		</index>
	</table>

	<!--
	  *
	  * TABLE captchas
	  *
	  -->
	<table name="captchas">
		<field name="captcha_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="session_id" type="C2" size="32">
			<NOTNULL/>
		</field>
		<field name="value" type="C2" size="20">
			<NOTNULL/>
		</field>
		<field name="date_created" type="T">
			<NOTNULL/>
		</field>
	</table>

	<!--
	  *
	  * TABLE temporary_files
	  *
	  -->
	<table name="temporary_files">
		<field name="file_id" type="I8">
			<KEY />
			<AUTOINCREMENT/>
		</field>
		<field name="user_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="file_name" type="C2" size="90">
			<NOTNULL/>
		</field>
		<field name="file_type" type="C2" size="255">
		</field>
		<field name="file_size" type="I8">
			<NOTNULL/>
		</field>
		<field name="original_file_name" type="C2" size="127"/>
		<field name="date_uploaded" type="T">
			<NOTNULL/>
		</field>
		<descr>Temporary file storage; used to keep attachments across multiple email composition requests</descr>
		<index name="temporary_files_user_id">
			<col>user_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE access_keys
	  *
	  -->
	<table name="access_keys">
		<field name="access_key_id" type="I8">
			<KEY />
			<AUTOINCREMENT />
		</field>
		<field name="context" type="C2" size="40">
			<NOTNULL/>
		</field>
		<field name="key_hash" type="C2" size="40">
			<NOTNULL/>
		</field>
		<field name="user_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="assoc_id" type="I8"/>
		<field name="expiry_date" type="T">
			<NOTNULL/>
		</field>
		<descr>Access keys are used to provide pseudo-login functionality for security-minimal tasks. Passkeys can be emailed directly to users, who can use them for a limited time in lieu of standard username and password.</descr>
		<index name="access_keys_hash">
			<col>key_hash</col>
			<col>user_id</col>
			<col>context</col>
		</index>
	</table>
</schema>
