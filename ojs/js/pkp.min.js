(function(a){function c(){a.fn.ajaxSubmit.debug&&(window.console&&window.console.log)&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}a.fn.ajaxSubmit=function(b){function d(){function d(){if(!s++){k.detachEvent?k.detachEvent("onload",d):k.removeEventListener("load",d,!1);var b=!0;try{if(t)throw"timeout";var e,g;g=k.contentWindow?k.contentWindow.document:k.contentDocument?k.contentDocument:k.document;var h="xml"==f.dataType||g.XMLDocument||a.isXMLDoc(g);c("isXml="+h);
if(!h&&(null==g.body||""==g.body.innerHTML)){if(--u){s=0;setTimeout(d,100);return}c("Could not access iframe DOM after 50 tries.");return}l.responseText=g.body?g.body.innerHTML:null;l.responseXML=g.XMLDocument?g.XMLDocument:g;l.getResponseHeader=function(a){return{"content-type":f.dataType}[a]};if("json"==f.dataType||"script"==f.dataType){var j=g.getElementsByTagName("textarea")[0];if(j)l.responseText=j.value;else{var q=g.getElementsByTagName("pre")[0];q&&(l.responseText=q.innerHTML)}}else if("xml"==
f.dataType&&!l.responseXML&&null!=l.responseText){g=l;var m=l.responseText,h=void 0;window.ActiveXObject?(h=new ActiveXObject("Microsoft.XMLDOM"),h.async="false",h.loadXML(m)):h=(new DOMParser).parseFromString(m,"text/xml");g.responseXML=h&&h.documentElement&&"parsererror"!=h.documentElement.tagName?h:null}e=a.httpData(l,f.dataType)}catch(v){b=!1,a.handleError(f,l,"error",v)}b&&(f.success(e,"success"),p&&a.event.trigger("ajaxSuccess",[l,f]));p&&a.event.trigger("ajaxComplete",[l,f]);p&&!--a.active&&
a.event.trigger("ajaxStop");f.complete&&f.complete(l,b?"success":"error");setTimeout(function(){i.remove();l.responseXML=null},100)}}var e=h[0];if(a(":input[name=submit]",e).length)alert('Error: Form elements must not be named "submit".');else{var f=a.extend({},a.ajaxSettings,b),g=a.extend(!0,{},a.extend(!0,{},a.ajaxSettings),f),j="jqFormIO"+(new Date).getTime(),i=a('<iframe id="'+j+'" name="'+j+'" src="'+f.iframeSrc+'" />'),k=i[0];i.css({position:"absolute",top:"-1000px",left:"-1000px"});var l={aborted:0,
responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;i.attr("src",f.iframeSrc)}},p=f.global;p&&!a.active++&&a.event.trigger("ajaxStart");p&&a.event.trigger("ajaxSend",[l,f]);if(g.beforeSend&&!1===g.beforeSend(l,g))g.global&&a.active--;else if(!l.aborted){var s=0,t=0;if(g=e.clk){var m=g.name;m&&!g.disabled&&(b.extraData=b.extraData||{},b.extraData[m]=g.value,"image"==
g.type&&(b.extraData[m+".x"]=e.clk_x,b.extraData[m+".y"]=e.clk_y))}setTimeout(function(){var c=h.attr("target"),g=h.attr("action");e.setAttribute("target",j);"POST"!=e.getAttribute("method")&&e.setAttribute("method","POST");e.getAttribute("action")!=f.url&&e.setAttribute("action",f.url);b.skipEncodingOverride||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});f.timeout&&setTimeout(function(){t=!0;d()},f.timeout);var l=[];try{if(b.extraData)for(var m in b.extraData)l.push(a('<input type="hidden" name="'+
m+'" value="'+b.extraData[m]+'" />').appendTo(e)[0]);i.appendTo("body");k.attachEvent?k.attachEvent("onload",d):k.addEventListener("load",d,!1);e.submit()}finally{e.setAttribute("action",g),c?e.setAttribute("target",c):h.removeAttr("target"),a(l).remove()}},10);var u=50}}}if(!this.length)return c("ajaxSubmit: skipping submit process - no element selected"),this;"function"==typeof b&&(b={success:b});var e=a.trim(this.attr("action"));e&&(e=(e.match(/^([^#]+)/)||[])[1]);e=e||window.location.href||"";
b=a.extend({url:e,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},b||{});e={};this.trigger("form-pre-serialize",[this,b,e]);if(e.veto)return c("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&!1===b.beforeSerialize(this,b))return c("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var f=this.formToArray(b.semantic);if(b.data){b.extraData=b.data;for(var g in b.data)if(b.data[g]instanceof
Array)for(var j in b.data[g])f.push({name:g,value:b.data[g][j]});else f.push({name:g,value:b.data[g]})}if(b.beforeSubmit&&!1===b.beforeSubmit(f,this,b))return c("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[f,this,b,e]);if(e.veto)return c("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;g=a.param(f);"GET"==b.type.toUpperCase()?(b.url+=(0<=b.url.indexOf("?")?"&":"?")+g,b.data=null):b.data=g;var h=this,i=[];b.resetForm&&i.push(function(){h.resetForm()});
b.clearForm&&i.push(function(){h.clearForm()});if(!b.dataType&&b.target){var k=b.success||function(){};i.push(function(c){a(b.target).html(c).each(k,arguments)})}else b.success&&i.push(b.success);b.success=function(a,c){for(var d=0,e=i.length;d<e;d++)i[d].apply(b,[a,c,h])};g=a("input:file",this).fieldValue();j=!1;for(e=0;e<g.length;e++)g[e]&&(j=!0);g.length&&!1!==b.iframe||b.iframe||j?b.closeKeepAlive?a.get(b.closeKeepAlive,d):d():a.ajax(b);this.trigger("form-submit-notify",[this,b]);return this};
a.fn.ajaxForm=function(c){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){a(this).ajaxSubmit(c);return!1}).bind("click.form-plugin",function(c){var b=c.target,f=a(b);if(!f.is(":submit,input:image")){b=f.closest(":submit");if(0==b.length)return;b=b[0]}var g=this;g.clk=b;"image"==b.type&&(void 0!=c.offsetX?(g.clk_x=c.offsetX,g.clk_y=c.offsetY):"function"==typeof a.fn.offset?(f=f.offset(),g.clk_x=c.pageX-f.left,g.clk_y=c.pageY-f.top):(g.clk_x=c.pageX-b.offsetLeft,g.clk_y=c.pageY-b.offsetTop));
setTimeout(function(){g.clk=g.clk_x=g.clk_y=null},100)})};a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};a.fn.formToArray=function(c){var d=[];if(0==this.length)return d;var e=this[0],f=c?e.getElementsByTagName("*"):e.elements;if(!f)return d;for(var g=0,j=f.length;g<j;g++){var h=f[g],i=h.name;if(i)if(c&&e.clk&&"image"==h.type)!h.disabled&&e.clk==h&&(d.push({name:i,value:a(h).val()}),d.push({name:i+".x",value:e.clk_x},{name:i+".y",value:e.clk_y}));else if((h=
a.fieldValue(h,!0))&&h.constructor==Array)for(var k=0,n=h.length;k<n;k++)d.push({name:i,value:h[k]});else null!==h&&"undefined"!=typeof h&&d.push({name:i,value:h})}if(!c&&e.clk&&(c=a(e.clk),f=c[0],(i=f.name)&&!f.disabled&&"image"==f.type))d.push({name:i,value:c.val()}),d.push({name:i+".x",value:e.clk_x},{name:i+".y",value:e.clk_y});return d};a.fn.formSerialize=function(c){return a.param(this.formToArray(c))};a.fn.fieldSerialize=function(c){var d=[];this.each(function(){var e=this.name;if(e){var f=
a.fieldValue(this,c);if(f&&f.constructor==Array)for(var g=0,j=f.length;g<j;g++)d.push({name:e,value:f[g]});else null!==f&&"undefined"!=typeof f&&d.push({name:this.name,value:f})}});return a.param(d)};a.fn.fieldValue=function(c){for(var d=[],e=0,f=this.length;e<f;e++){var g=a.fieldValue(this[e],c);null===g||("undefined"==typeof g||g.constructor==Array&&!g.length)||(g.constructor==Array?a.merge(d,g):d.push(g))}return d};a.fieldValue=function(a,c){var e=a.name,f=a.type,g=a.tagName.toLowerCase();"undefined"==
typeof c&&(c=!0);if(c&&(!e||a.disabled||"reset"==f||"button"==f||("checkbox"==f||"radio"==f)&&!a.checked||("submit"==f||"image"==f)&&a.form&&a.form.clk!=a||"select"==g&&-1==a.selectedIndex))return null;if("select"==g){var j=a.selectedIndex;if(0>j)return null;for(var e=[],g=a.options,h=(f="select-one"==f)?j+1:g.length,j=f?j:0;j<h;j++){var i=g[j];if(i.selected){var k=i.value;k||(k=i.attributes&&i.attributes.value&&!i.attributes.value.specified?i.text:i.value);if(f)return k;e.push(k)}}return e}return a.value};
a.fn.clearForm=function(){return this.each(function(){a("input,select,textarea",this).clearFields()})};a.fn.clearFields=a.fn.clearInputs=function(){return this.each(function(){var a=this.type,c=this.tagName.toLowerCase();"text"==a||"password"==a||"textarea"==c?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==c&&(this.selectedIndex=-1)})};a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};
a.fn.enable=function(a){void 0==a&&(a=!0);return this.each(function(){this.disabled=!a})};a.fn.selected=function(c){void 0==c&&(c=!0);return this.each(function(){var d=this.type;"checkbox"==d||"radio"==d?this.checked=c:"option"==this.tagName.toLowerCase()&&(d=a(this).parent("select"),c&&(d[0]&&"select-one"==d[0].type)&&d.find("option").selected(!1),this.selected=c)})}})(jQuery);(function(a){a.widget("ui.tagit",{options:{itemName:"item",fieldName:"tags",availableTags:[],tagSource:null,removeConfirmation:!1,caseSensitive:!0,allowSpaces:!1,animate:!0,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,tabIndex:null,onTagAdded:null,onTagRemoved:null,onTagClicked:null},_create:function(){var c=this;this.element.is("input")?(this.tagList=a("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.css("display",
"none")):this.tagList=this.element.find("ul, ol").andSelf().last();this._tagInput=a('<input type="text" />').addClass("ui-widget-content");this.options.tabIndex&&this._tagInput.attr("tabindex",this.options.tabIndex);this.options.tagSource=this.options.tagSource||function(c,b){var d=c.term.toLowerCase(),j=a.grep(this.options.availableTags,function(a){return 0===a.toLowerCase().indexOf(d)});b(this._subtractArray(j,this.assignedTags()))};a.isFunction(this.options.tagSource)&&(this.options.tagSource=
a.proxy(this.options.tagSource,this));this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(a('<li class="tagit-new"></li>').append(this._tagInput)).click(function(b){var d=a(b.target);d.hasClass("tagit-label")?c._trigger("onTagClicked",b,d.closest(".tagit-choice")):c._tagInput.focus()});this.tagList.children("li").each(function(){a(this).hasClass("tagit-new")||(c.createTag(a(this).html(),a(this).attr("class"),!0),a(this).remove())});if(this.options.singleField)if(this.options.singleFieldNode){var b=
a(this.options.singleFieldNode),d=b.val().split(this.options.singleFieldDelimiter);b.val("");a.each(d,function(a,b){c.createTag(b,null,!1)})}else this.options.singleFieldNode=this.tagList.after('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />');this._tagInput.keydown(function(b){if(b.which==a.ui.keyCode.BACKSPACE&&""===c._tagInput.val()){var d=c._lastTag();!c.options.removeConfirmation||d.hasClass("remove")?c.removeTag(d):c.options.removeConfirmation&&d.addClass("remove ui-state-highlight")}else c.options.removeConfirmation&&
c._lastTag().removeClass("remove ui-state-highlight");if(b.which==a.ui.keyCode.COMMA||b.which==a.ui.keyCode.ENTER||b.which==a.ui.keyCode.TAB&&""!==c._tagInput.val()||b.which==a.ui.keyCode.SPACE&&!0!==c.options.allowSpaces&&('"'!=a.trim(c._tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==a.trim(c._tagInput.val()).charAt(0)&&'"'==a.trim(c._tagInput.val()).charAt(a.trim(c._tagInput.val()).length-1)&&0!==a.trim(c._tagInput.val()).length-1))b.preventDefault(),c.createTag(c._cleanedInput(),null,!1),c._tagInput.autocomplete("close")}).blur(function(){c.createTag(c._cleanedInput(),
null,!1)});this._autocompleteVal=null;this._selectAction=function(){if(c._tagInput.val()==c._autocompleteVal)return c.createTag(c._autocompleteVal,null,!0),c.tagList.children(".tagit-new").children("input").val(""),!1};(this.options.availableTags||this.options.tagSource)&&this._tagInput.autocomplete({source:this.options.tagSource,close:this._selectAction,select:this._selectAction,minLength:2,autoFocus:!0,focus:function(b,d){c._autocompleteVal=d.item.value;a(this).val(c._unescapeHTML(d.item.value));
return!1}})},_cleanedInput:function(){return a.trim(this._tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.children(".tagit-choice:last")},assignedTags:function(){var c=this,b=[];this.options.singleField?(b=a(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),""===b[0]&&(b=[])):this.tagList.children(".tagit-choice").each(function(){b.push(c.tagLabel(this))});return b},_updateSingleTagsField:function(c){a(this.options.singleFieldNode).val(c.join(this.options.singleFieldDelimiter))},
_subtractArray:function(c,b){for(var d=[],e=0;e<c.length;e++)-1==a.inArray(c[e],b)&&d.push(c[e]);return d},tagLabel:function(c){return this.options.singleField?a(c).children(".tagit-label").text():a(c).children("input").val()},_isNew:function(a){var b=this,d=!0;this.tagList.children(".tagit-choice").each(function(){if(b._formatStr(urlEncode(a))==b._formatStr(b.tagLabel(this)))return d=!1});return d},_formatStr:function(c){return this.options.caseSensitive?c:a.trim(c.toLowerCase())},_unescapeHTML:function(c){return a("<div/>").html(c).text()},
createTag:function(c,b,d){d&&(c=this._unescapeHTML(c));var e=this,c=a.trim(c);if(!this._isNew(c)||""===c)return!1;var d=a(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(c),f=a("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(b).append(d),b=a("<span></span>").addClass("ui-icon ui-icon-close"),b=a('<a><span class="text-icon">\u00d7</span></a>').addClass("tagit-close").append(b).click(function(){e.removeTag(f)});
f.append(b);this.options.singleField?(b=this.assignedTags(),b.push(c),this._updateSingleTagsField(b)):(c=urlEncode(c),f.append('<input type="hidden" style="display:none;" value="'+c+'" name="'+this.options.itemName+"["+this.options.fieldName+'][]" />'));this._trigger("onTagAdded",null,f);this._tagInput.val("");this._tagInput.parent().before(f)},removeTag:function(c,b){b=b||this.options.animate;c=a(c);this._trigger("onTagRemoved",null,c);if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(c),
d=a.grep(d,function(a){return a!=e});this._updateSingleTagsField(d)}b?c.fadeOut("fast").hide("blind",{direction:"horizontal"},"fast",function(){c.remove()}).dequeue():c.remove()},removeAll:function(){var a=this;this.tagList.children(".tagit-choice").each(function(b,d){a.removeTag(d,!1)})}})})(jQuery);jQuery.cookie=function(a,c,b){if("undefined"!=typeof c){b=b||{};null===c&&(c="",b.expires=-1);var d="";if(b.expires&&("number"==typeof b.expires||b.expires.toUTCString))"number"==typeof b.expires?(d=new Date,d.setTime(d.getTime()+864E5*b.expires)):d=b.expires,d="; expires="+d.toUTCString();var e=b.path?"; path="+b.path:"",f=b.domain?"; domain="+b.domain:"",b=b.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(c),d,e,f,b].join("")}else{c=null;if(document.cookie&&""!=document.cookie){b=
document.cookie.split(";");for(d=0;d<b.length;d++)if(e=jQuery.trim(b[d]),e.substring(0,a.length+1)==a+"="){c=decodeURIComponent(e.substring(a.length+1));break}}return c}};(function(a){a.fn.jLabel=function(c){function b(c){this.equals=function(a){return a.attr("id")==this.input.attr("id")};this.input=c;var b=a("label[for="+c.attr("id")+"]");0==b.size()&&(b=a("<label>").attr("for",c.attr("id")).text(c.attr("title")));c.before(b);b.css({"font-family":c.css("font-family"),"font-size":c.css("font-size"),"font-style":c.css("font-style"),"font-variant":c.css("font-variant"),"font-weight":c.css("font-weight"),"letter-spacing":c.css("letter-spacing"),"line-height":c.css("line-height"),
"text-decoration":c.css("text-decoration"),"text-transform":c.css("text-transform"),color:c.css("color"),cursor:c.css("cursor"),display:"inline-block"});b.mousedown(function(){return!1}).css({position:"relative","z-index":"100","margin-right":-b.width(),left:f.xShift+parseInt(c.css("padding-left"))+"px",top:f.yShift+"px"});this.label=b;""!=this.input.val()&&this.label.hide()}function d(c){var b;a.each(e,function(){if(this.equals(c))return b=this,!1});return b}var e=[],f=a.extend({},a.fn.jLabel.defaults,
c);return this.each(function(){var c=a(this);e.push(new b(c));c.focus(function(){var c=a(this);""==c.val()&&d(c).label.stop().fadeTo(f.speed,f.opacity)}).blur(function(){var c=a(this);""==c.val()&&d(c).label.stop().fadeTo(f.speed,1)}).keyup(function(){var c=a(this),b=d(c).label;""==c.val()?b.stop().fadeTo(f.speed,f.opacity):b.is(":visible")&&b.stop().fadeTo(f.speed,0,function(){b.hide()})})})};a.fn.jLabel.defaults={speed:200,opacity:0.4,xShift:2,yShift:0}})(jQuery);function fontSize(a,c,b,d,e,f){function g(a,c){void 0!=$.cookie&&$.cookie("font-size",a,{path:c})}$(a).html("<a href='javascript:void(0);' class='pkp_controllers_fontController_smallFont' title='Make font size smaller'>Make font size smaller</a> <a href='javascript:void(0);' class='pkp_controllers_fontController_defaultFont' title='Make font size default'>Make font size default</a> <a href='javascript:void(0);' class='pkp_controllers_fontController_largeFont' title='Make font size larger'>Make font size larger</a> ");
if(void 0!=$.cookie){var j=$.cookie("font-size");null!=j&&$(c).css("font-size",parseInt(j,10))}$(a+" .pkp_controllers_fontController_smallFont").click(function(){var d=parseInt($(c).css("font-size"),10)-1;d>=b&&$(c).css("font-size",d);d<=b&&$(a+" .pkp_controllers_fontController_smallFont").addClass("pkp_controllers_fontController_sdisabled");d<e&&$(a+" .pkp_controllers_fontController_largeFont").removeClass("pkp_controllers_fontController_ldisabled");g(d,f)});$(a+" .pkp_controllers_fontController_defaultFont").click(function(){$(c).css("font-size",
d);$(a+" .pkp_controllers_fontController_smallFont").removeClass("pkp_controllers_fontController_sdisabled");$(a+" .pkp_controllers_fontController_largeFont").removeClass("pkp_controllers_fontController_ldisabled");g(d,f)});$(a+" .pkp_controllers_fontController_largeFont").click(function(){var d=parseInt($(c).css("font-size"),10)+1;d<=e&&$(c).css("font-size",d);d>b&&$(a+" .pkp_controllers_fontController_smallFont").removeClass("pkp_controllers_fontController_sdisabled");d>=e&&$(a+" .pkp_controllers_fontController_largeFont").addClass("pkp_controllers_fontController_ldisabled");
g(d,f)})};function confirmAction(a,c){return confirm(c)?(a&&(document.location.href=a),!0):!1}function openHelp(a){window.open(a,"Help","width=700,height=600,screenX=100,screenY=100,toolbar=0,scrollbars=1")}function openComments(a){window.open(a,"Comments","width=700,height=600,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}function openWindow(a){window.open(a,"Window","width=600,height=550,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}
function openRTWindow(a){window.open(a,"RT","width=700,height=500,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}function openRTWindowWithToolbar(a){window.open(a,"RT","width=700,height=500,screenX=100,screenY=100,toolbar=1,resizable=1,scrollbars=1")}function getBrowserObject(a,c){var b=0,d;document.getElementById?d=document.getElementById(a):document.all?d=document.all[a]:document.layers&&(d=document.layers[a],b=1);c&&!b&&(d=d.style);return d}
function loadUrl(a){document.location.href=a}function createCookie(a,c,b){if(b){var d=new Date;d.setTime(d.getTime()+864E5*b);b="; expires="+d.toGMTString()}else b="";document.cookie=a+"="+c+b+"; path=/"}function readCookie(a){for(var a=a+"=",c=document.cookie.split(";"),b=0;b<c.length;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}
function makeAsyncRequest(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function sendAsyncRequest(a,c,b,d){a.open(d,c,!0);a.setRequestHeader("Content-Type","text/html; Charset=utf-8");a.send(b)}function changeFormAction(a,c){document.getElementById(a).action=c;document.getElementById(a).submit()}
function urlEncode(a){return encodeURIComponent(a).replace(/\%20/g,"+").replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/\~/g,"%7E")}function escapeHTML(a){return $("<div/>").text(a).html()}function unescapeHTML(a){return $("<div/>").html(a).text()};function jqueryValidatorI18n(a,c){var b;b=a+"/lib/pkp/js/lib/jquery/plugins/validate/localization/messages_";switch(c){case "fr_FR":case "ca_FR":eval($.getScript(b+"fr.js"));break;case "pt_BR":eval($.getScript(b+"ptbr.js"));break;case "pt_PT":eval($.getScript(b+"ptpt.js"));break;case "es_AR":case "es_ES":eval($.getScript(b+"es.js"))}};(function(a){a.pkp=a.pkp||{};a.pkp.classes=a.pkp.classes||{};a.pkp.controllers=a.pkp.controllers||{};a.pkp.plugins=a.pkp.plugins||{};a.pkp.plugins.blocks=a.pkp.plugins.blocks||{};a.pkp.plugins.generic=a.pkp.plugins.generic||{};a.pkp.classes.Helper=function(){throw Error("Trying to instantiate the Helper singleton!");};a.pkp.classes.Helper.CHARS_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");a.pkp.classes.Helper.uuid=function(){var c=a.pkp.classes.Helper.CHARS_,b=Array(36),
d=0,e,f;for(f=0;36>f;f++)8==f||13==f||18==f||23==f?b[f]="-":14==f?b[f]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),e=d&15,d>>=4,b[f]=c[19==f?e&3|8:e]);return b.join("")};a.pkp.classes.Helper.inherits=function(a,b){var d=function(){};d.prototype=b.prototype;a.parent_=b.prototype;a.prototype=new d;a.prototype.constructor=a;b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)};a.pkp.classes.Helper.objectFactory=function(c,b){var d,e;d=a.pkp.classes.Helper.resolveObjectName(c);
e=a.pkp.classes.Helper.getObjectProxyInstance();a.extend(!0,e,a.pkp.classes.ObjectProxy);a.pkp.classes.Helper.inherits(e,d);a.extend(!0,e.prototype,a.pkp.classes.ObjectProxy.prototype);return new e(c,b)};a.pkp.classes.Helper.resolveObjectName=function(c){var b,d,e;b=c.split(".");if("$"!=b.shift())throw Error(['Namespace "',b[0],'" for object"',c,'" is currently not supported!'].join(""));e=b[b.length-1];if(e.charAt(0).toUpperCase()!==e.charAt(0))throw Error(['The name "',c,'" does not point to aconstructor which must always be upper case!'].join(""));
e=a;for(d in b)if(e=e[b[d]],void 0===e)throw Error(['Constructor for object "',c,'" not found!'].join(""));if(!a.isFunction(e))throw Error(['The name "',c,'" does not point to a,constructor which must always be a function!'].join());return e};a.pkp.classes.Helper.getObjectProxyInstance=function(){var a=function(a,c){this.objectName_=a;this.parent.apply(this,c)};a.objectName_="";a.prototype.parent=function(){};return a};a.pkp.classes.Helper.injectMixin=function(c,b){var d=a.pkp.classes.Helper.objectFactory(b,
[]);a.extend(!0,c,d)};a.pkp.classes.Helper.curry=function(a,b,d){if(2<arguments.length){var e,f;e=Array.prototype.slice.call(arguments,2);return function(){f=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(f,e);return a.apply(b,f)}}return function(){return a.apply(b,arguments)}}})(jQuery);(function(a){a.pkp.classes.ObjectProxy=function(){};a.pkp.classes.ObjectProxy.prototype.objectName_="";a.pkp.classes.ObjectProxy.prototype.self=function(c,b){var d,e;for(d=this.constructor;d;d=d.parent_&&d.parent_.constructor)if(d.hasOwnProperty(c))return d=d[c],a.isFunction(d)?(e=Array.prototype.slice.call(arguments,1),d.apply(this,e)):d;throw Error(['Static property "',c,'" not found!'].join(""));};a.pkp.classes.ObjectProxy.prototype.parent=function(c,b){var d,e,f,g;d=a.pkp.classes.ObjectProxy.prototype.parent.caller;
if(d.parent_)return e=Array.prototype.slice.call(arguments),d.parent_.constructor.apply(this,e);e=Array.prototype.slice.call(arguments,1);if(this.hasOwnProperty(c)&&this[c]===d)return this.constructor.parent_[c].apply(this,e);f=!1;for(g=this.constructor;g;g=g.parent_&&g.parent_.constructor)if(g.prototype.hasOwnProperty(c)&&g.prototype[c]===d)f=!0;else if(f)return g.prototype[c].apply(this,e);throw Error("Trying to call parent from a method of one name to a method of a different name");};a.pkp.classes.ObjectProxy.prototype.getObjectName=
function(){return this.objectName_}})(jQuery);(function(a){a.pkp.classes.Handler=function(a,b){if(1<a.length)throw Error("jQuery selector contained more than one handler!");this.$htmlElement_=a;if(void 0!==this.data("handler"))throw Error(['The handler "',this.getObjectName(),'" has already been bound to the selected element!'].join(""));this.eventBindings_={};this.dataItems_={};this.publishedEvents_={};b.$eventBridge&&(this.$eventBridge_=b.$eventBridge);if(b.publishChangeEvents){this.publishChangeEvents_=b.publishChangeEvents;var d;for(d=0;d<
this.publishChangeEvents_.length;d++)this.publishEvent(this.publishChangeEvents_[d])}else this.publishChangeEvents_=[];this.data("handler",this)};a.pkp.classes.Handler.prototype.publishChangeEvents_=null;a.pkp.classes.Handler.prototype.$htmlElement_=null;a.pkp.classes.Handler.prototype.eventBindings_=null;a.pkp.classes.Handler.prototype.dataItems_=null;a.pkp.classes.Handler.prototype.publishedEvents_=null;a.pkp.classes.Handler.prototype.$eventBridge_=null;a.pkp.classes.Handler.getHandler=function(c){c=
c.data("pkp.handler");if(!(c instanceof a.pkp.classes.Handler))throw Error("There is no handler bound to this element!");return c};a.pkp.classes.Handler.prototype.getHtmlElement=function(){a.pkp.classes.Handler.checkContext_(this);return this.$htmlElement_};a.pkp.classes.Handler.prototype.publishChangeEvents=function(){var a;for(a=0;a<this.publishChangeEvents_.length;a++)this.trigger(this.publishChangeEvents_[a])};a.pkp.classes.Handler.prototype.handleEvent=function(c){var b,d,e,f,g,j;b=a(this);d=
a.pkp.classes.Handler.getHandler(b);if(b[0]!==d.getHtmlElement.call(d)[0])throw Error("An invalid handler is bound to the calling element of an event!");b=d.eventBindings_[c.type];if(void 0===b)return!1;e=a.makeArray(arguments);f=!0;e.unshift(this);g=0;for(j=b.length;g<j&&!(!1===b[g].apply(d,e)&&(f=!1),c.isImmediatePropagationStopped());g++);c.stopPropagation();return f};a.pkp.classes.Handler.prototype.callbackWrapper=function(c,b){a.pkp.classes.Handler.checkContext_(this);b||(b=this);return function(){var d;
d=a.makeArray(arguments);d.unshift(this);return c.apply(b,d)}};a.pkp.classes.Handler.prototype.remoteResponse=function(a,b){return this.handleJson(b)};a.pkp.classes.Handler.prototype.remove=function(){a.pkp.classes.Handler.checkContext_(this);var c,b;c=this.getHtmlElement();c.unbind(".pkpHandler");for(b in this.dataItems_)"pkp.handler"!==b&&c.removeData(b);c.trigger("pkpRemoveHandler");c.unbind(".pkpHandlerRemove");c.removeData("pkp.handler")};a.pkp.classes.Handler.prototype.handleJson=function(a){if(!a)throw Error("Server error: Server returned no or invalid data!");
if(!0===a.status)return a.event&&(a.event.data?this.trigger(a.event.name,a.event.data):this.trigger(a.event.name)),a;a.content&&alert(a.content);return!1};a.pkp.classes.Handler.prototype.setHtmlElement=function(c){a.pkp.classes.Handler.checkContext_(this);return this.$htmlElement_=c};a.pkp.classes.Handler.prototype.bind=function(c,b){a.pkp.classes.Handler.checkContext_(this);if(!this.eventBindings_[c]){this.eventBindings_[c]=[];var d;d=".pkpHandler";"pkpRemoveHandler"===c&&(d=".pkpHandlerRemove");
this.getHtmlElement().bind(c+d,this.handleEvent)}this.eventBindings_[c].push(b)};a.pkp.classes.Handler.prototype.unbind=function(c,b){a.pkp.classes.Handler.checkContext_(this);if(!this.eventBindings_[c])return!1;var d,e;d=0;for(e=this.eventBindings_[c].length;d<e;d++)if(this.eventBindings_[c][d]===b){this.eventBindings_[c].splice([d],1);break}0===this.eventBindings_[c].length&&(delete this.eventBindings_[c],this.getHtmlElement().unbind(c,this.handleEvent));return!0};a.pkp.classes.Handler.prototype.data=
function(c,b){a.pkp.classes.Handler.checkContext_(this);c="pkp."+c;void 0!==b&&(this.dataItems_[c]=!0);return this.getHtmlElement().data(c,b)};a.pkp.classes.Handler.prototype.trigger=function(a,b){void 0===b&&(b=null);this.getHtmlElement().triggerHandler(a,b);this.publishedEvents_[a]||this.triggerPublicEvent_(a,b)};a.pkp.classes.Handler.prototype.publishEvent=function(a){this.publishedEvents_[a]||(this.publishedEvents_[a]=!0,this.bind(a,function(b,d,e){var f=null;2<arguments.length&&(f=Array.prototype.slice.call(arguments,
2));this.triggerPublicEvent_(a,f)}))};a.pkp.classes.Handler.prototype.switchViz=function(c){a(c.currentTarget).parent().parent().find("span").toggle()};a.pkp.classes.Handler.prototype.initializeTinyMCE=function(){if("undefined"!==typeof tinyMCE){var c=this.getHtmlElement().attr("id");setTimeout(function(){a("#"+c).find(".richContent").each(function(){var c=a(this).attr("id");tinyMCE.execCommand("mceAddControl",!1,c)})},500)}};a.pkp.classes.Handler.prototype.triggerPublicEvent_=function(c,b){this.getHtmlElement().parent().trigger(c,
b);this.$eventBridge_&&a('[id^="'+this.$eventBridge_+'"]').trigger(c,b)};a.pkp.classes.Handler.checkContext_=function(c){if(!(c instanceof a.pkp.classes.Handler))throw Error("Trying to call handler method in non-handler context!");}})(jQuery);(function(a){a.pkp.classes.linkAction=a.pkp.classes.linkAction||{};a.pkp.classes.linkAction.LinkActionRequest=function(a,b){this.$linkActionElement=a;this.options=b;a.is("a")&&b.url&&a.attr("href",b.url)};a.pkp.classes.linkAction.LinkActionRequest.prototype.$linkActionElement=null;a.pkp.classes.linkAction.LinkActionRequest.prototype.options=null;a.pkp.classes.linkAction.LinkActionRequest.prototype.activate=function(){this.getLinkActionElement().trigger("actionStart");return!1};a.pkp.classes.linkAction.LinkActionRequest.prototype.finish=
function(){this.options.finishCallback&&this.options.finishCallback();this.getLinkActionElement().trigger("actionStop");return!1};a.pkp.classes.linkAction.LinkActionRequest.prototype.getUrl=function(){return this.options.url?this.options.url:null};a.pkp.classes.linkAction.LinkActionRequest.prototype.getOptions=function(){return this.options};a.pkp.classes.linkAction.LinkActionRequest.prototype.getLinkActionElement=function(){return this.$linkActionElement}})(jQuery);(function(a){a.pkp.classes.linkAction.RedirectRequest=function(a,b){this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.RedirectRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.RedirectRequest.prototype.activate=function(a,b){var d=this.getOptions();window.location=d.url;return this.parent("activate",a,b)}})(jQuery);(function(a){a.pkp.classes.linkAction.AjaxRequest=function(a,b){this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.AjaxRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.AjaxRequest.prototype.activate=function(c,b){var d=this.parent("activate",c,b),e=this.getOptions(),f=a.pkp.classes.Helper.curry(this.handleResponse,this);switch(e.requestType){case "get":a.getJSON(e.url,f);break;case "post":a.post(e.url,f,"json")}return d};a.pkp.classes.linkAction.AjaxRequest.prototype.handleResponse=
function(a){this.getLinkActionElement().data("pkp.handler").handleJson(a);this.finish()}})(jQuery);(function(a){a.pkp.classes.linkAction.ModalRequest=function(a,b){this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.ModalRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.ModalRequest.prototype.$dialog_=null;a.pkp.classes.linkAction.ModalRequest.prototype.activate=function(c,b){var d=this.getOptions(),e=this.getLinkActionElement(),f=e.text();void 0===d.title&&(""===f&&(f=e.attr("title")),d.title=f);e=a.pkp.classes.Helper.uuid();if(!d.modalHandler)throw Error('The "modalHandler" setting is required in a ModalRequest');
f=this.getLinkActionElement();f=a.pkp.classes.Handler.getHandler(f);f=a.extend(!0,{$eventBridge:f.getStaticId()},d);this.$dialog_=a("<div id="+e+"></div>").pkpHandler(d.modalHandler,f);a.pkp.classes.Handler.getHandler(this.$dialog_).bind("pkpRemoveHandler",a.pkp.classes.Helper.curry(this.finish,this));return this.parent("activate",c,b)};a.pkp.classes.linkAction.ModalRequest.prototype.finish=function(){this.$dialog_.remove();return this.parent("finish")}})(jQuery);(function(a){a.pkp.classes.notification=a.pkp.classes.notification||{};a.pkp.classes.notification.NotificationHelper=function(){};a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent=function(c,b){var d,e,f,g,j,h,i,k,n,q,r;if(void 0!==b.content)c.getHtmlElement().parent().trigger("notifyUser",[b]);else{d=c.getHtmlElement();e=!1;!(c instanceof a.pkp.controllers.SiteHandler)&&0<a(b).parents(".pkp_controllers_grid").length&&(d.parent().trigger("notifyUser"),e=!0);d=a(".pkp_notification",
d);f=[];g=0;for(j=d.length;g<j;g++)if(i=a(d[g]),!(0<i.parents(":hidden").length)){h=i.parents();n=0;for(q=h.length;n<q;n++)if(k=a(h[n]).data("pkp.handler"),k instanceof a.pkp.classes.Handler){r=a(h[n]);break}if(r.has(b[0]).length||r[0]==b){if(0<i.parents(".ui-accordion:first").length&&(h=i.parents(".ui-accordion:first"),!h.has(b[0])))continue;f.push(i)}}if(f.length)for(g=f.length-1;-1<g;g--)f[g].triggerHandler("notifyUser");else e||c.getHtmlElement().parent().trigger("notifyUser")}}})(jQuery);(function(a){a.pkp.classes.features=a.pkp.classes.features||{};a.pkp.classes.features.Feature=function(a,b){this.gridHandler=a;this.options_=b;this.addFeatureHtml(this.getGridHtmlElement(),b)};a.pkp.classes.features.Feature.prototype.gridHandler=null;a.pkp.classes.features.Feature.prototype.options_=null;a.pkp.classes.features.Feature.prototype.getOptions=function(){return this.options_};a.pkp.classes.features.Feature.prototype.init=function(){throw Error("Abstract method!");};a.pkp.classes.features.Feature.prototype.appendElement=
function(){return!1};a.pkp.classes.features.Feature.prototype.replaceElement=function(){return!1};a.pkp.classes.features.Feature.prototype.callbackWrapper=function(a,b){return this.gridHandler.callbackWrapper(a,b)};a.pkp.classes.features.Feature.prototype.addFeatureHtml=function(){};a.pkp.classes.features.Feature.prototype.getGridHtmlElement=function(){return this.gridHandler.getHtmlElement()}})(jQuery);(function(a){a.pkp.controllers.SiteHandler=function(c,b){this.parent(c,b);this.options_=b;this.unsavedFormElements_=[];a(".go").button();this.bind("redirectRequested",this.redirectToUrl);this.bind("notifyUser",this.fetchNotificationHandler_);this.bind("updateHeader",this.updateHeaderHandler_);this.bind("updateSidebar",this.updateSidebarHandler_);this.bind("callWhenClickOutside",this.callWhenClickOutsideHandler_);this.bind("mousedown",this.mouseDownHandler_);this.bind("gridInitialized",this.updateHelpDisplayHandler_);
this.bind("toggleInlineHelp",this.toggleInlineHelpHandler_);a(window).bind("beforeunload",this.pageUnloadHandler_);a.ajaxSetup({cache:!1});this.setMainMaxWidth_();a("select.applyPlugin",c).selectBox();b.hasSystemNotifications&&this.trigger("notifyUser");this.bind("formChanged",this.callbackWrapper(this.registerUnsavedFormElement_));this.bind("unregisterChangedForm",this.callbackWrapper(this.unregisterUnsavedFormElement_));this.bind("modalCanceled",this.callbackWrapper(this.unregisterUnsavedFormElement_));
this.bind("unregisterAllForms",this.callbackWrapper(this.unregisterAllFormElements_));this.outsideClickChecks_={}};a.pkp.classes.Helper.inherits(a.pkp.controllers.SiteHandler,a.pkp.classes.Handler);a.pkp.controllers.SiteHandler.prototype.options_=null;a.pkp.controllers.SiteHandler.prototype.outsideClickChecks_=null;a.pkp.controllers.SiteHandler.prototype.unsavedFormElements_=null;a.pkp.controllers.SiteHandler.prototype.triggerTinyMCEInitialized=function(c){a("#"+c.editorId).trigger("tinyMCEInitialized",
[c])};a.pkp.controllers.SiteHandler.prototype.redirectToUrl=function(a,b,d){window.location=d};a.pkp.controllers.SiteHandler.prototype.registerUnsavedFormElement_=function(c,b,d){c=a(d.target.lastElementChild).attr("id");-1==a.inArray(c,this.unsavedFormElements_)&&this.unsavedFormElements_.push(c)};a.pkp.controllers.SiteHandler.prototype.unregisterUnsavedFormElement_=function(c,b,d){c=a(d.target.lastElementChild).attr("id");c=a.inArray(c,this.unsavedFormElements_);-1!==c&&delete this.unsavedFormElements_[c]};
a.pkp.controllers.SiteHandler.prototype.unregisterAllFormElements_=function(){this.unsavedFormElements_=[]};a.pkp.controllers.SiteHandler.prototype.toggleInlineHelpHandler_=function(){a.ajax({url:this.options_.toggleHelpUrl});this.options_.inlineHelpState=this.options_.inlineHelpState?0:1;this.updateHelpDisplayHandler_();return!1};a.pkp.controllers.SiteHandler.prototype.updateHelpDisplayHandler_=function(){var a;a=this.getHtmlElement();this.options_.inlineHelpState?(a.find(".pkp_grid_description, #legend, .pkp_help").css("visibility",
"visible").show(),a.find('[id^="toggleHelp"]').html(this.options_.toggleHelpOffText)):(a.find(".pkp_grid_description, #legend, .pkp_help").hide(),a.find('[id^="toggleHelp"]').html(this.options_.toggleHelpOnText))};a.pkp.controllers.SiteHandler.prototype.fetchNotificationHandler_=function(c,b,d){void 0!==d?this.showNotification_(d):a.ajax({url:this.options_.fetchNotificationUrl,data:this.options_.requestOptions,success:this.callbackWrapper(this.showNotificationResponseHandler_),dataType:"json",async:!1})};
a.pkp.controllers.SiteHandler.prototype.updateHeaderHandler_=function(){a.pkp.classes.Handler.getHandler(a("#headerContainer")).reload()};a.pkp.controllers.SiteHandler.prototype.updateSidebarHandler_=function(){a.pkp.classes.Handler.getHandler(a("#sidebarContainer")).reload()};a.pkp.controllers.SiteHandler.prototype.callWhenClickOutsideHandler_=function(a,b,d){void 0!==d.container&&void 0!==d.callback&&(a=d.container.attr("id"),this.outsideClickChecks_[a]=d)};a.pkp.controllers.SiteHandler.prototype.mouseDownHandler_=
function(c,b){var d;if(!a.isEmptyObject(this.outsideClickChecks_))for(d in this.outsideClickChecks_)this.processOutsideClickCheck_(this.outsideClickChecks_[d],b);return!0};a.pkp.controllers.SiteHandler.prototype.processOutsideClickCheck_=function(a,b){if("click"!==b.type&&"mousedown"!==b.type&&"mouseup"!==b.type)throw Error("Can not check outside click with the passed event: "+b.type+".");var d=a.container;return d.is(":hidden")||void 0!==a.skipWhenVisibleModals&&a.skipWhenVisibleModals&&0<this.getHtmlElement().find("div.ui-dialog").length?
!1:0===d.has(b.target).length?(delete this.outsideClickChecks_[d.attr("id")],a.callback(),!0):!1};a.pkp.controllers.SiteHandler.prototype.pageUnloadHandler_=function(){var c,b,d;c=a.pkp.classes.Handler.getHandler(a("body"));b=0;for(d in c.unsavedFormElements_)d&&b++;return 0<b?a.pkp.locale.form_dataHasChanged:null};a.pkp.controllers.SiteHandler.prototype.isFormUnsaved=function(a){return null!==this.unsavedFormElements_&&void 0!==this.unsavedFormElements_[a]?!0:!1};a.pkp.controllers.SiteHandler.prototype.showNotificationResponseHandler_=
function(a,b){this.showNotification_(b)};a.pkp.controllers.SiteHandler.prototype.showNotification_=function(c){var b,d,c=this.handleJson(c);if(!1!==c&&c.content.general)for(b in c=c.content.general,c)for(d in c[b])a.pnotify(c[b][d])};a.pkp.controllers.SiteHandler.prototype.setMainMaxWidth_=function(){var c,b,d,e,f;c=this.getHtmlElement();b=a(".pkp_structure_content",c).width();d=a(".pkp_structure_sidebar_left",c).outerWidth(!0);e=a(".pkp_structure_sidebar_right",c).outerWidth(!0);c=a(".pkp_structure_main",
c);f=c.outerWidth(!0)-c.width();c.css("max-width",b-(d+e+f))}})(jQuery);(function(a){a.pkp.controllers.UploaderHandler=function(c,b){this.parent(c,b);if(!(c.is("div")&&""===c.text()))throw Error("An uploader widget controller can only be attached to an empty div!");var d=a.extend({},this.self("DEFAULT_PROPERTIES_"),{url:b.uploadUrl,flash_swf_url:b.baseUrl+"/lib/pkp/js/lib/plupload/plupload.flash.swf",silverlight_xap_url:b.baseUrl+"/lib/pkp/js/lib/plupload/plupload.silverlight.xap"});c.plupload(d);d=c.plupload("getUploader");d.refresh();/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)||
c.find("div.plupload").css("z-index",99999);c.find("a.plupload_add").css("z-index",99999);d.bind("FilesAdded",this.callbackWrapper(this.limitQueueSize));d.bind("QueueChanged",this.callbackWrapper(this.refreshUploader))};a.pkp.classes.Helper.inherits(a.pkp.controllers.UploaderHandler,a.pkp.classes.Handler);a.pkp.controllers.UploaderHandler.prototype.limitQueueSize=function(a,b){1<b.files.length&&(b.splice(0,1),b.refresh())};a.pkp.controllers.UploaderHandler.prototype.refreshUploader=function(a,b){b.refresh()};
a.pkp.controllers.UploaderHandler.DEFAULT_PROPERTIES_={runtimes:"html5,flash,silverlight",max_file_size:"20mb",multi_selection:!1,file_data_name:"uploadedFile",multipart:!0,headers:{browser_user_agent:navigator.userAgent}}})(jQuery);(function(a){a.pkp.controllers.NotificationHandler=function(a,b){this.parent(a,b);this.options_=b;this.bind("notifyUser",this.fetchNotificationHandler_);this.getHtmlElement().hide();this.getHtmlElement().triggerHandler("notifyUser")};a.pkp.classes.Helper.inherits(a.pkp.controllers.NotificationHandler,a.pkp.classes.Handler);a.pkp.controllers.NotificationHandler.prototype.options_=null;a.pkp.controllers.NotificationHandler.prototype.trivialTimer_=null;a.pkp.controllers.NotificationHandler.prototype.fetchNotificationHandler_=
function(){var c={};c.requestOptions=this.options_.requestOptions;a.ajax({type:"POST",url:this.options_.fetchNotificationUrl,data:c,success:this.callbackWrapper(this.showNotificationResponseHandler_),dataType:"json",async:!1})};a.pkp.controllers.NotificationHandler.prototype.showNotificationResponseHandler_=function(c,b){clearTimeout(this.trivialTimer_);var d=this.getHtmlElement(),e=this.handleJson(b),f,g,j;if(!1!==e)if(e.content.inPlace){f=this.concatenateNotifications_(e.content.inPlace);g=this.removeAlreadyShownNotifications_(e);
d.html(f);d.show();e=this.getTrivialNotifications_(e.content.inPlace);if(!this.visibleWithoutScrolling_()&&g)for(j in d.parent().trigger("notifyUser",[g]),e)g=e[j],a("#pkp_notification_"+g,this.getHtmlElement()).remove();0===d.children().length?d.hide():this.addTimerToNotifications(e)}else this.getHtmlElement().empty(),this.getHtmlElement().hide()};a.pkp.controllers.NotificationHandler.prototype.visibleWithoutScrolling_=function(){var c=this.getHtmlElement(),b=c.offset().top+this.getHtmlElement().height()/
2,d=a(window).scrollTop(),e=d+a(window).height(),f=c.parents(".ui-dialog-content");return 0<f.length&&(c=f.offset().top,f=c+f.height(),b<c||b>f)?!1:b<d||b>e?!1:!0};a.pkp.controllers.NotificationHandler.prototype.removeAlreadyShownNotifications_=function(c){var b=!0,d,e,f;for(d in c.content.inPlace)for(e in c.content.inPlace[d])f=a("#pkp_notification_"+e),0<f.length?(delete c.content.inPlace[d][e],delete c.content.general[d][e]):b=!1;return b?!1:c};a.pkp.controllers.NotificationHandler.prototype.concatenateNotifications_=
function(a){var b="",d,e;for(d in a)for(e in a[d])b+=a[d][e];return b};a.pkp.controllers.NotificationHandler.prototype.getTrivialNotifications_=function(a){var b=[],d,e;for(d in a)if(1==d)for(e in a[d])b.push(e);return b};a.pkp.controllers.NotificationHandler.prototype.addTimerToNotifications=function(c){var b=function(){a(this).remove()};c.length&&(this.trivialTimer_=setTimeout(function(){var d,e;for(d in c)e=a("#pkp_notification_"+c[d]),e.fadeOut(400,b())},6E3))}})(jQuery);(function(a){a.pkp.controllers.UrlInDivHandler=function(a,b){this.parent(a,b);this.sourceUrl_=b.sourceUrl;this.reload()};a.pkp.classes.Helper.inherits(a.pkp.controllers.UrlInDivHandler,a.pkp.classes.Handler);a.pkp.controllers.UrlInDivHandler.sourceUrl_=null;a.pkp.controllers.UrlInDivHandler.prototype.reload=function(){a.get(this.sourceUrl_,this.callbackWrapper(this.handleLoadedContent_),"json")};a.pkp.controllers.UrlInDivHandler.prototype.handleLoadedContent_=function(a,b){var d=this.handleJson(b);
!0===d.status?void 0===d.content?this.getHtmlElement().hide():this.getHtmlElement().hide().html(d.content).fadeIn(400):alert(d.content);return!1}})(jQuery);(function(a){a.pkp.controllers.AutocompleteHandler=function(c,b){var d;this.parent(c,b);this.sourceUrl_=b.sourceUrl;b.sourceUrl=void 0;this.jLabelText_=b.jLabelText;d={};d.source=this.callbackWrapper(this.fetchAutocomplete);d=a.extend({},this.self("DEFAULT_PROPERTIES_"),d,b);this.textInput=c.find(":text");this.textInput.keyup(this.callbackWrapper(this.synchronizeFields_));this.textInput.autocomplete(d);this.textInput.attr("title",this.jLabelText_);a("#"+this.textInput.attr("id")).jLabel();this.textInput.attr("title",
"");this.textLabel_=c.find("label");this.hiddenInput_=c.find("input:hidden");this.bind("autocompleteselect",this.itemSelected);this.bind("autocompletefocus",this.itemFocused);this.textInput.blur(this.callbackWrapper(this.textInputBlurHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.AutocompleteHandler,a.pkp.classes.Handler);a.pkp.controllers.AutocompleteHandler.textLabel_=null;a.pkp.controllers.AutocompleteHandler.jLabelText_=null;a.pkp.controllers.AutocompleteHandler.DEFAULT_PROPERTIES_=
{minLength:2};a.pkp.controllers.AutocompleteHandler.prototype.hiddenInput_=null;a.pkp.controllers.AutocompleteHandler.prototype.sourceUrl_=null;a.pkp.controllers.AutocompleteHandler.prototype.textInput=null;a.pkp.controllers.AutocompleteHandler.prototype.itemSelected=function(a,b,d){a=this.hiddenInput_;b=this.textInput;""!==d.item.value&&(a.val(d.item.value),b.val(d.item.label),b.trigger("keyup"));return!1};a.pkp.controllers.AutocompleteHandler.prototype.itemFocused=function(a,b,d){a=this.textInput;
""!==d.item.value&&a.val(d.item.label);return!1};a.pkp.controllers.AutocompleteHandler.prototype.fetchAutocomplete=function(c,b,d){var e;e=this.textInput;e.addClass("spinner");a.post(this.getAutocompleteUrl(),{term:b.term},function(a){e.removeClass("spinner");d(a.content)},"json")};a.pkp.controllers.AutocompleteHandler.prototype.getAutocompleteUrl=function(){return this.sourceUrl_};a.pkp.controllers.AutocompleteHandler.prototype.setAutocompleteUrl=function(a){this.sourceUrl_=a};a.pkp.controllers.AutocompleteHandler.prototype.textInputBlurHandler_=
function(){""===this.hiddenInput_.val()&&this.textInput.val("")};a.pkp.controllers.AutocompleteHandler.prototype.synchronizeFields_=function(){this.hiddenInput_.val(String(this.textInput.val()))}})(jQuery);(function(a){a.pkp.controllers.ExtrasOnDemandHandler=function(c,b){this.parent(c,b);a(".toggleExtras",c).show().click(this.callbackWrapper(this.toggleExtras));this.deactivateExtraContent_()};a.pkp.classes.Helper.inherits(a.pkp.controllers.ExtrasOnDemandHandler,a.pkp.classes.Handler);a.pkp.controllers.ExtrasOnDemandHandler.prototype.toggleExtras=function(c){var b=this.getHtmlElement();a(c,b).hasClass("active")?this.deactivateExtraContent_("slow"):this.activateExtraContent_("slow")};a.pkp.controllers.ExtrasOnDemandHandler.prototype.activateExtraContent_=
function(c){var b,d;b=this.getHtmlElement();a(".toggleExtras .toggleExtras-inactive",b).hide();a(".extrasContainer",b).show(c);a(".toggleExtras .toggleExtras-active",b).show();a(".toggleExtras",b).removeClass("inactive").addClass("active");a(".ui-icon",b).removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-s");d=b.closest(".scrollable");0<d.size()&&(a.browser.msie&&7>=parseInt(a.browser.version.substring(0,1),10)?setTimeout(function(){this.scrollToMakeVisible_(b,d)},500):this.scrollToMakeVisible_(b,
d))};a.pkp.controllers.ExtrasOnDemandHandler.prototype.deactivateExtraContent_=function(c){var b=this.getHtmlElement();a(".extrasContainer",b).hide(c);a(".toggleExtras .toggleExtras-active",b).hide();a(".toggleExtras .toggleExtras-inactive",b).show();a(".toggleExtras",b).removeClass("active").addClass("inactive");a(".ui-icon",b).removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e")};a.pkp.controllers.ExtrasOnDemandHandler.prototype.scrollToMakeVisible_=function(a,b){var d,e,f;d=a.position().top;
e=b.position().top;f=parseInt(b.scrollTop(),10);d>e?(d=Math.ceil(d+a.height()-b.height()),0<d&&b.scrollTop(f+d)):(f=Math.max(Math.floor(f+d-e),0),b.scrollTop(f))}})(jQuery);(function(a){a.pkp.controllers.form=a.pkp.controllers.form||{};a.pkp.controllers.form.FormHandler=function(c,b){this.parent(c,b);if(!c.is("form"))throw Error("A form handler controller can only be bound to an HTML form element!");!1!==b.transformButtons&&a(".button",c).button();b.submitHandler&&(this.callerSubmitHandler_=b.submitHandler);b.cancelRedirectUrl&&(this.cancelRedirectUrl_=b.cancelRedirectUrl);"undefined"!==typeof b.trackFormChanges&&(this.trackFormChanges=b.trackFormChanges);b.disableControlsOnSubmit&&
(this.disableControlsOnSubmit=b.disableControlsOnSubmit);b.enableDisablePairs&&(this.enableDisablePairs_=b.enableDisablePairs,this.setupEnableDisablePairs());var d=c.validate({onfocusout:this.callbackWrapper(this.onFocusOutValidation_),errorClass:"error",highlight:function(c,b){a(c).parent().parent().addClass(b)},unhighlight:function(c,b){a(c).parent().parent().removeClass(b)},submitHandler:this.callbackWrapper(this.submitHandler_),showErrors:this.callbackWrapper(this.showErrors)});a("#cancelFormButton",
c).click(this.callbackWrapper(this.cancelForm));a("#resetFormButton",c).click(this.callbackWrapper(this.resetForm));c.find(".showMore, .showLess").bind("click",this.switchViz);d.checkForm()?this.trigger("formValid"):this.trigger("formInvalid");this.initializeTinyMCE();a("#submitFormButton",c).click(this.callbackWrapper(this.pushTinyMCEChanges_));a(":input",c).change(this.callbackWrapper(this.formChange));this.publishEvent("tinyMCEInitialized");this.bind("tinyMCEInitialized",this.tinyMCEInitHandler_)};
a.pkp.classes.Helper.inherits(a.pkp.controllers.form.FormHandler,a.pkp.classes.Handler);a.pkp.controllers.form.FormHandler.prototype.disableControlsOnSubmit=!1;a.pkp.controllers.form.FormHandler.prototype.trackFormChanges=!0;a.pkp.controllers.form.FormHandler.prototype.callerSubmitHandler_=null;a.pkp.controllers.form.FormHandler.prototype.cancelRedirectUrl_=null;a.pkp.controllers.form.FormHandler.prototype.formChangesTracked=!1;a.pkp.controllers.form.FormHandler.prototype.enableDisablePairs_=null;
a.pkp.controllers.form.FormHandler.prototype.showErrors=function(c){"undefined"!==typeof tinyMCE&&tinyMCE.triggerSave();var b=a.extend(!0,{},c);setTimeout(this.callbackWrapper(function(){b.defaultShowErrors();b=null}),250);c.checkForm()?this.trigger("formValid"):(this.trigger("formInvalid"),this.enableFormControls())};a.pkp.controllers.form.FormHandler.prototype.formChange=function(){this.trackFormChanges&&!this.formChangesTracked&&(this.trigger("formChanged"),this.formChangesTracked=!0)};a.pkp.controllers.form.FormHandler.prototype.disableFormControls=
function(){this.disableControlsOnSubmit&&this.getHtmlElement().find(":submit").attr("disabled","disabled").addClass("ui-state-disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.enableFormControls=function(){this.getHtmlElement().find(":submit").removeAttr("disabled").removeClass("ui-state-disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.cancelForm=function(){this.unregisterForm();this.trigger("formCanceled");return!1};a.pkp.controllers.form.FormHandler.prototype.unregisterForm=
function(){this.formChangesTracked=!1;this.trigger("unregisterChangedForm")};a.pkp.controllers.form.FormHandler.prototype.resetForm=function(){this.formChangesTracked=!1;this.trigger("unregisterChangedForm");this.getHtmlElement().each(function(){this.reset()});return!1};a.pkp.controllers.form.FormHandler.prototype.setupEnableDisablePairs=function(){var c=this.getHtmlElement(),b;for(b in this.enableDisablePairs_)a(c).find("[id^='"+b+"']").bind("click",this.callbackWrapper(this.toggleDependentElement_));
return!0};a.pkp.controllers.form.FormHandler.prototype.submitFormWithoutValidation=function(a){a.settings.submitHandler=null;this.disableFormControls();this.getHtmlElement().submit();this.formChangesTracked=!1};a.pkp.controllers.form.FormHandler.prototype.initializeTinyMCE_=function(){if("undefined"!==typeof tinyMCE){var c;c=this.getHtmlElement().attr("id");setTimeout(function(){a("#"+c).find(".richContent").each(function(){tinyMCE.execCommand("mceAddControl",!1,a(this).attr("id").toString())})},
500)}};a.pkp.controllers.form.FormHandler.prototype.submitHandler_=function(c,b){var d=new a.Event("formSubmitRequested");a(b).find(".formWidget").trigger(d);d.isDefaultPrevented()||(a(b).find(".pkp_helpers_progressIndicator").show(),this.trigger("unregisterChangedForm"),null!==this.callerSubmitHandler_?(this.formChangesTracked=!1,this.callbackWrapper(this.callerSubmitHandler_).call(c,b)):this.submitFormWithoutValidation(c))};a.pkp.controllers.form.FormHandler.prototype.pushTinyMCEChanges_=function(){"undefined"!==
typeof tinyMCE&&tinyMCE.triggerSave();return!0};a.pkp.controllers.form.FormHandler.prototype.toggleDependentElement_=function(c){var b,d;b=this.getHtmlElement();d=a(c).attr("id");b=a(b).find("[id^='"+this.enableDisablePairs_[d]+"']");a(c).is(":checked")?a(b).attr("disabled",""):a(b).attr("disabled","disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.tinyMCEInitHandler_=function(c,b,d){var e=d.editorId;a(d.getWin()).blur(this.callbackWrapper(function(){d.save();var c=this.getHtmlElement(),
b=a("#"+e,c);c.validate().element(b)}))};a.pkp.controllers.form.FormHandler.prototype.onFocusOutValidation_=function(c,b){var d=this.getHtmlElement();a(b).parents("#"+d.attr("id")).length&&c.element(b);return!0}})(jQuery);(function(a){a.pkp.controllers.form.ClientFormHandler=function(a,b){b.submitHandler=this.submitForm;this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.ClientFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.controllers.form.ClientFormHandler.prototype.submitForm=function(){var c;c=this.getHtmlElement().serializeArray();c.push({name:"clientSubmit",value:!0});this.trigger("formSubmitted",[a.param(c)])}})(jQuery);(function(a){a.pkp.controllers.form.AjaxFormHandler=function(a,b){b.submitHandler=this.submitForm;this.parent(a,b);this.bind("refreshForm",this.refreshFormHandler_);this.publishEvent("containerReloadRequested")};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.AjaxFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.controllers.form.AjaxFormHandler.prototype.disableControlsOnSubmit=!0;a.pkp.controllers.form.AjaxFormHandler.prototype.submitForm=function(){var c=this.getHtmlElement();this.disableFormControls();
a.post(c.attr("action"),c.serialize(),this.callbackWrapper(this.handleResponse),"json")};a.pkp.controllers.form.AjaxFormHandler.prototype.refreshFormHandler_=function(a,b,d){d&&this.getHtmlElement().replaceWith(d)};a.pkp.controllers.form.AjaxFormHandler.prototype.handleResponse=function(c,b){var d,e;e=this.handleJson(b);if(!1!==e)if(""===e.content)d=new a.Event("formSubmitted"),a(this.getHtmlElement()).find(".formWidget").trigger(d),this.trigger("formSubmitted"),this.publishChangeEvents();else{if(void 0!==
e.reloadContainer)return this.trigger("dataChanged"),this.trigger("containerReloadRequested",[e]),e.status;d=this.getHtmlElement();d.replaceWith(e.content)}a(this.getHtmlElement()).find(".pkp_helpers_progressIndicator").hide();this.getHtmlElement().find(":submit").button();this.trigger("notifyUser",[this.getHtmlElement()]);return e.status}})(jQuery);(function(a){a.pkp.controllers.form.FileUploadFormHandler=function(a,b){this.parent(a,b);void 0!==b.resetUploader&&(this.resetUploader_=b.resetUploader);this.attachUploader_(b.$uploader,b.uploaderOptions);this.uploaderSetup(b.$uploader)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.FileUploadFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.form.FileUploadFormHandler.prototype.resetUploader_=!1;a.pkp.controllers.form.FileUploadFormHandler.prototype.handleResponse=function(c,
b){var d;this.resetUploader_&&(d=a("#plupload",this.getHtmlElement()).plupload("getUploader"),d.splice(),d.refresh(),a("#temporaryFileId",this.getHtmlElement()).val(""));return this.parent("handleResponse",c,b)};a.pkp.controllers.form.FileUploadFormHandler.prototype.uploaderSetup=function(a){a.plupload("getUploader").bind("FileUploaded",this.callbackWrapper(this.handleUploadResponse))};a.pkp.controllers.form.FileUploadFormHandler.prototype.handleUploadResponse=function(c,b,d,e){c=this.handleJson(a.parseJSON(e.response));
!1!==c&&(this.trigger("fileUploaded",[c.uploadedFile]),""===c.content?(b=this.getHtmlElement(),b=b.find("#temporaryFileId"),b.val(c.temporaryFileId)):this.getHtmlElement().replaceWith(c.content))};a.pkp.controllers.form.FileUploadFormHandler.prototype.attachUploader_=function(a,b){a.pkpHandler("$.pkp.controllers.UploaderHandler",b)}})(jQuery);(function(a){a.pkp.controllers.form.MultilingualInputHandler=function(a,b){this.parent(a,b);var d=null,d=a.hasClass("pkpTagit")?a.find(":input").filter(":visible"):a.find(":input").first();d.focus(this.callbackWrapper(this.focusHandler_));a.find(":input").blur(this.callbackWrapper(this.blurHandler_));this.publishEvent("tinyMCEInitialized");this.bind("tinyMCEInitialized",this.tinyMCEInitHandler_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.MultilingualInputHandler,a.pkp.classes.Handler);
a.pkp.controllers.form.MultilingualInputHandler.prototype.focusHandler_=function(){this.showPopover_()};a.pkp.controllers.form.MultilingualInputHandler.prototype.blurHandler_=function(){setTimeout(this.callbackWrapper(function(){this.hasElementInFocus_()||this.hidePopover_()}),0);return!0};a.pkp.controllers.form.MultilingualInputHandler.prototype.hidePopover_=function(){var a=this.getHtmlElement();a.removeClass("localization_popover_container_focus");a.find(".localization_popover").hide()};a.pkp.controllers.form.MultilingualInputHandler.prototype.showPopover_=
function(){var a=this.getHtmlElement();a.addClass("localization_popover_container_focus");a.find(".localization_popover").width(a.width());a.find(".localization_popover").show()};a.pkp.controllers.form.MultilingualInputHandler.prototype.hasElementInFocus_=function(){return this.getHtmlElement().has(document.activeElement).length?!0:!1};a.pkp.controllers.form.MultilingualInputHandler.prototype.tinyMCEInitHandler_=function(c,b,d){c=a("#"+d.editorId).height();a(d.getBody()).height(78*(c/100));a(d.getWin()).focus(this.callbackWrapper(function(){this.trigger("callWhenClickOutside",
{container:this.getHtmlElement(),callback:this.callbackWrapper(this.hidePopover_),skipWhenVisibleModals:!1});var c=this.callbackWrapper(function(c){c=a(c.getWin());this.getHtmlElement().hasClass("localization_popover_container_focus")||c.focus()});d.onSetContent.remove(c);d.onSetContent.add(c);this.showPopover_()}));a(d.getWin()).blur(this.callbackWrapper(function(){if(a(d.getContainer()).find("iframe").attr("id")==a(document.activeElement).attr("id"))return!1;setTimeout(this.callbackWrapper(function(){this.hasElementInFocus_()||
this.hidePopover_()}),0)}))}})(jQuery);(function(a){a.pkp.controllers.grid=a.pkp.controllers.grid||{};a.pkp.controllers.grid.GridHandler=function(a,b){this.parent(a,b);this.initialize(b);this.initFeatures_(b.features)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.GridHandler,a.pkp.classes.Handler);a.pkp.controllers.grid.GridHandler.prototype.bodySelector=null;a.pkp.controllers.grid.GridHandler.prototype.fetchRowUrl=null;a.pkp.controllers.grid.GridHandler.prototype.gridId_=null;a.pkp.controllers.grid.GridHandler.prototype.fetchGridUrl_=
null;a.pkp.controllers.grid.GridHandler.prototype.features_=null;a.pkp.controllers.grid.GridHandler.prototype.getFetchRowUrl=function(){return this.fetchRowUrl};a.pkp.controllers.grid.GridHandler.prototype.getRows=function(){return a(".gridRow",this.getHtmlElement())};a.pkp.controllers.grid.GridHandler.prototype.getGridIdPrefix=function(){return"component-"+this.gridId_};a.pkp.controllers.grid.GridHandler.prototype.getRowIdPrefix=function(){return this.getGridIdPrefix()+"-row-"};a.pkp.controllers.grid.GridHandler.prototype.getRowDataId=
function(a){var b,d,e,a=a.attr("class").split(" ");for(b in a)if(e=a[b].indexOf("element"),-1!=e){d=a[b].slice(7);break}return d};a.pkp.controllers.grid.GridHandler.prototype.getParentRow=function(a){return a.parents(".gridRow:first")};a.pkp.controllers.grid.GridHandler.prototype.getElementsByType=function(c){return c.hasClass("gridRow")?(c=c.parents("tbody:first"),a(".gridRow",c)):null};a.pkp.controllers.grid.GridHandler.prototype.getEmptyElement=function(a){return a.hasClass("gridRow")?a.parents("tbody:first").next(".empty"):
null};a.pkp.controllers.grid.GridHandler.prototype.toggleRowActions=function(c){c=a(c).parents("tr").next(".row_controls");this.applyToggleRowActionEffect_(c)};a.pkp.controllers.grid.GridHandler.prototype.hideAllVisibleRowActions=function(){var c,b,d;c=a(".row_controls:visible",this.getHtmlElement());b=0;for(d=c.length;b<d;b++)this.applyToggleRowActionEffect_(a(c[b]))};a.pkp.controllers.grid.GridHandler.prototype.hideRowActionsDiv=function(){var c,b,d,e;c=a(".gridRow div.row_actions",this.getHtmlElement());
c.hide();b=0;for(d=c.length;b<d;b++)e=a(c[b]),e.parents(".row_container:first").attr("style","padding-left:0px !important")};a.pkp.controllers.grid.GridHandler.prototype.showRowActionsDiv=function(){var c,b,d,e;c=a(".gridRow div.row_actions",this.getHtmlElement());c.show();b=0;for(d=c.length;b<d;b++)e=a(c[b]),e.parents(".row_container:first").removeAttr("style")};a.pkp.controllers.grid.GridHandler.prototype.changeLinkActionsState=function(c,b){void 0===b&&(b=a(".pkp_controllers_linkAction",this.getHtmlElement()));
b.each(function(){var b;b=a.pkp.classes.Handler.getHandler(a(this));c?b.enableLink():b.disableLink()})};a.pkp.controllers.grid.GridHandler.prototype.resequenceRows=function(c){var b,d;for(d in c)b=c[d],b=a("#"+b),this.appendElement(b);this.updateControlRowsPosition()};a.pkp.controllers.grid.GridHandler.prototype.updateControlRowsPosition=function(){var c,b,d,e,f;c=this.getRows();b=0;for(d=c.length;b<d;b++)e=a(c[b]),f=this.getControlRowByGridRow(e),0<f.length&&f.insertAfter(e)};a.pkp.controllers.grid.GridHandler.prototype.initialize=
function(a){this.bind("dataChanged",this.refreshGridHandler);this.bind("addRow",this.addRowHandler_);this.bind("formSubmitted",this.refreshGridWithFilterHandler_);this.gridId_=a.gridId;this.fetchRowUrl=a.fetchRowUrl;this.fetchGridUrl_=a.fetchGridUrl;this.bodySelector=a.bodySelector;this.activateRowActions_();this.trigger("gridInitialized")};a.pkp.controllers.grid.GridHandler.prototype.callFeaturesHook=function(c,b){var d;a.isArray(b)||(b=[b]);for(d in this.features_)this.features_[d][c].apply(this.features_[d],
b)};a.pkp.controllers.grid.GridHandler.prototype.refreshGridHandler=function(c,b,d,e){e||(d?a.get(this.fetchRowUrl,{rowId:d},this.callbackWrapper(this.replaceElementResponseHandler),"json"):a.get(this.fetchGridUrl_,null,this.callbackWrapper(this.replaceGridResponseHandler_),"json"));this.trigger("gridRefreshRequested");this.publishChangeEvents()};a.pkp.controllers.grid.GridHandler.prototype.deleteElement=function(c){var b,d;if(1!==c.length)throw Error("There were "+c.length+" rather than 1 element to delete!");
b=!1;1==this.getElementsByType(c).length&&(b=!0);c.hasClass("gridRow")&&this.deleteControlsRow_(c);d=this.getEmptyElement(c);c.fadeOut(500,function(){a(this).remove();b&&d.fadeIn(500)})};a.pkp.controllers.grid.GridHandler.prototype.appendElement=function(a,b){if(void 0===b||null===b)b=this.getHtmlElement().find(this.bodySelector);b.append(a);this.getEmptyElement(a).hide();this.callFeaturesHook("appendElement",a)};a.pkp.controllers.grid.GridHandler.prototype.replaceElement=function(a,b){b.hasClass("gridRow")&&
this.deleteControlsRow_(a);a.replaceWith(b);this.callFeaturesHook("replaceElement",b)};a.pkp.controllers.grid.GridHandler.prototype.hasSameNumOfColumns=function(a,b){var d,e;d=this.getHtmlElement().find("th").length;e=a.first().find("td");e=b?e.attr("colspan"):e.length;return d==e};a.pkp.controllers.grid.GridHandler.prototype.replaceElementResponseHandler=function(a,b){var d;d=this.handleJson(b);if(!1!==d)if(d.elementNotFound){d=d.elementNotFound;d=this.getHtmlElement().find(".element"+d);if(0===
d.length)return!1;this.deleteElement(d)}else this.insertOrReplaceElement_(d.content),this.activateRowActions_()};a.pkp.controllers.grid.GridHandler.prototype.refreshGridWithFilterHandler_=function(c,b,d){a.post(this.fetchGridUrl_,d,this.callbackWrapper(this.replaceGridResponseHandler_),"json")};a.pkp.controllers.grid.GridHandler.prototype.addRowHandler_=function(c,b,d){a.get(this.fetchRowUrl,d,this.callbackWrapper(this.replaceElementResponseHandler),"json")};a.pkp.controllers.grid.GridHandler.prototype.replaceGridResponseHandler_=
function(a,b){var d,e;d=this.handleJson(b);!1!==d&&(e=this.getHtmlElement(),e.replaceWith(d.content),this.activateRowActions_())};a.pkp.controllers.grid.GridHandler.prototype.insertOrReplaceElement_=function(c){var b,d,c=a(c);b=c.attr("id");d=this.getHtmlElement();b=b?d.find("#"+b):null;if(null!==b&&1<b.length)throw Error("There were "+b.length+" rather than 0 or 1 elements to be replaced!");this.hasSameNumOfColumns(c)?null!==b&&1===b.length?this.replaceElement(b,c):this.appendElement(c):a.get(this.fetchGridUrl_,
null,this.callbackWrapper(this.replaceGridResponseHandler_),"json")};a.pkp.controllers.grid.GridHandler.prototype.deleteControlsRow_=function(c){c=a("#"+c.attr("id")+"-control-row",this.getHtmlElement());c.is("tr")&&c.hasClass("row_controls")&&c.remove()};a.pkp.controllers.grid.GridHandler.prototype.getControlRowByGridRow=function(c){c=c.attr("id")+"-control-row";return a("#"+c)};a.pkp.controllers.grid.GridHandler.prototype.activateRowActions_=function(){this.getHtmlElement().find("a.settings").unbind("click").bind("click",
this.callbackWrapper(this.toggleRowActions))};a.pkp.controllers.grid.GridHandler.prototype.applyToggleRowActionEffect_=function(a){var b;b=a.prev().find("td:not(.indent_row)");b=b.add(a.prev());a.is(":visible")?(setTimeout(function(){b.removeClass("no_border")},0),a.hide(0)):(b.addClass("no_border"),a.show(0))};a.pkp.controllers.grid.GridHandler.prototype.addFeature_=function(a,b){this.features_||(this.features_=[]);this.features_[a]=b};a.pkp.controllers.grid.GridHandler.prototype.initFeatures_=function(c){var b,
d;for(b in c)d=a.pkp.classes.Helper.objectFactory(c[b].JSClass,[this,c[b].options]),this.addFeature_(b,d),this.features_[b].init()}})(jQuery);(function(a){a.pkp.controllers.grid.CategoryGridHandler=function(a,b){this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.CategoryGridHandler,a.pkp.controllers.grid.GridHandler);a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryIdPrefix=function(){return this.getGridIdPrefix()+"-category-"};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategories=function(){return a(".category_grid_body:not(.empty)",this.getHtmlElement())};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryByDataId=
function(c){return a("#"+this.getCategoryIdPrefix()+c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryRow=function(c){var b=this.getHtmlElement();void 0!==c&&(b=c);return a("tr.category",b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getRowsInCategory=function(c){return a("tr.gridRow",c).not(".category")};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryEmptyPlaceholder=function(c){c="#"+c.attr("id")+"-emptyPlaceholder";return a(c,this.getHtmlElement())};
a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryDataId=function(a){var a=a.attr("id"),b=this.getCategoryIdPrefix().length;return a.slice(b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryDataIdByRowId=function(c){c=c.replace(this.getCategoryIdPrefix()," ");c=c.match("(.*)-row");return a.trim(c[1])};a.pkp.controllers.grid.CategoryGridHandler.prototype.appendCategory=function(a){this.getHtmlElement().find(this.bodySelector).append(a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.resequenceCategories=
function(c){var b,d;for(d in c)b=c[d],b=a("#"+b),this.appendCategory(b);this.updateEmptyPlaceholderPosition()};a.pkp.controllers.grid.CategoryGridHandler.prototype.updateEmptyPlaceholderPosition=function(){var c=this.getCategories(),b,d,e,f;b=0;for(d=c.length;b<d;b++)e=a(c[b]),f=this.getCategoryEmptyPlaceholder(e),0<f.length&&f.insertAfter(e)};a.pkp.controllers.grid.CategoryGridHandler.prototype.initialize=function(a){this.fetchCategoryUrl_=a.fetchCategoryUrl;this.parent("initialize",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getElementsByType=
function(a){return a.hasClass("category_grid_body")?this.getCategories():this.parent("getElementsByType",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getEmptyElement=function(a){return a.hasClass("category_grid_body")?this.getHtmlElement().find(".empty").not(".category_placeholder"):this.parent("getEmptyElement",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.refreshGridHandler=function(c,b,d){var e=!1;void 0!==d&&(void 0!==d.parentElementId?(e={rowId:d[0],rowCategoryId:d.parentElementId},
this.currentCategoryId_=d.parentElementId,a.get(this.fetchRowUrl,e,this.callbackWrapper(this.replaceElementResponseHandler),"json")):a.get(this.fetchCategoryUrl_,{rowId:d},this.callbackWrapper(this.replaceElementResponseHandler),"json"),e=!0);this.parent("refreshGridHandler",c,b,d,e)};a.pkp.controllers.grid.CategoryGridHandler.prototype.deleteElement=function(c){var b,d,e,f;if(1<c.length&&(2==c.length&&(c.hasClass("category_grid_body")&&c.hasClass("category"))&&(c=c.filter(".category_grid_body")),
this.currentCategoryId_)){b=this.getCategoryByDataId(this.currentCategoryId_);d=0;for(e=c.length;d<e;d++)if(f=a(c[d]).parents("#"+b.attr("id")),1===f.length){c=a(c[d]);break}}c.hasClass("category_grid_body")&&(b=this.getCategoryEmptyPlaceholder(c),b.remove());this.parent("deleteElement",c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.appendElement=function(a){var b=null;a.hasClass("gridRow")&&(b=this.getCategoryDataIdByRowId(a.attr("id")),b=this.getCategoryByDataId(b));this.parent("appendElement",
a,b);a.hasClass("category_grid_body")&&(a=this.getEmptyElement(a),this.getHtmlElement().find(this.bodySelector).append(a))};a.pkp.controllers.grid.CategoryGridHandler.prototype.replaceElement=function(a,b){b.hasClass("category_grid_body")&&this.getCategoryEmptyPlaceholder(a).remove();this.parent("replaceElement",a,b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.hasSameNumOfColumns=function(a){var b=a,d=!1;a.hasClass("category_grid_body")&&(b=a.find("tr"),d=!0);return this.parent("hasSameNumOfColumns",
b,d)}})(jQuery);(function(a){jQuery.pkp.controllers.linkAction=jQuery.pkp.controllers.linkAction||{};a.pkp.controllers.linkAction.LinkActionHandler=function(c,b){this.parent(c,b);this.staticId_=b.staticId?b.staticId:c.attr("id");if(!b.actionRequest||!b.actionRequestOptions)throw Error('The "actionRequest" and "actionRequestOptions"settings are required in a LinkActionHandler');c.hasClass("image")&&this.bind("mouseover",this.imagePreviewHandler_);b.actionRequestOptions.finishCallback=this.callbackWrapper(this.enableLink);
this.linkActionRequest_=a.pkp.classes.Helper.objectFactory(b.actionRequest,[c,b.actionRequestOptions]);this.bindActionRequest();this.publishEvent("dataChanged");this.bind("dataChanged",this.dataChangedHandler_);this.bind("modalCanceled",this.removeDisabledCssClass_);b.selfActivate&&this.trigger("click")};a.pkp.classes.Helper.inherits(a.pkp.controllers.linkAction.LinkActionHandler,a.pkp.classes.Handler);a.pkp.controllers.linkAction.LinkActionHandler.prototype.linkActionRequest_=null;a.pkp.controllers.linkAction.LinkActionHandler.prototype.staticId_=
null;a.pkp.controllers.linkAction.LinkActionHandler.prototype.getStaticId=function(){return this.staticId_};a.pkp.controllers.linkAction.LinkActionHandler.prototype.getUrl=function(){return this.linkActionRequest_.getUrl()};a.pkp.controllers.linkAction.LinkActionHandler.prototype.imagePreviewHandler_=function(c){a(c).imgPreview({preloadImages:!1,imgCSS:{width:"300px"}})};a.pkp.controllers.linkAction.LinkActionHandler.prototype.activateAction=function(a,b){"$.pkp.classes.linkAction.NullAction"!=this.linkActionRequest_.getObjectName()&&
this.disableLink();return this.linkActionRequest_.activate.call(this.linkActionRequest_,a,b)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.bindActionRequest=function(){this.bind("click",this.activateAction)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.enableLink=function(){var c,b;c=a(this.getHtmlElement());this.getHtmlElement().is(":submit")||this.removeDisabledCssClass_();b=this.getUrl();this.getHtmlElement().is("a")&&b&&c.attr("href",b);this.unbind("click",this.noAction_);
this.bindActionRequest()};a.pkp.controllers.linkAction.LinkActionHandler.prototype.disableLink=function(){var c=a(this.getHtmlElement());c.addClass("ui-state-disabled");this.getHtmlElement().is("a")&&c.attr("href","#");this.unbind("click",this.activateAction);this.bind("click",this.noAction_)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.removeDisabledCssClass_=function(){a(this.getHtmlElement()).removeClass("ui-state-disabled")};a.pkp.controllers.linkAction.LinkActionHandler.prototype.dataChangedHandler_=
function(a,b,d){0===this.getHtmlElement().parents(".pkp_controllers_grid").length&&this.trigger("redirectDataChangedToGrid",[d]);this.trigger("notifyUser",[this.getHtmlElement()])};a.pkp.controllers.linkAction.LinkActionHandler.prototype.noAction_=function(){return!1}})(jQuery);(function(a){a.pkp.controllers.modal=a.pkp.controllers.modal||{};a.pkp.controllers.modal.ModalHandler=function(c,b){this.parent(c,b);if(!this.checkOptions(b))throw Error("Missing or invalid modal options!");var d=a.extend(!0,{},b),d=this.mergeOptions(d);c.dialog(d);this.fixTitleBar_(c,d);this.fixCloseButton_(c,d);400>c.width()&&c.dialog("option","width","400");710<c.width()&&c.dialog("option","width","710");c.dialog("option","position",["center",100]);this.bind("dialogclose",this.dialogClose);this.publishEvent("redirectRequested");
this.publishEvent("dataChanged");this.publishEvent("containerReloadRequested");this.publishEvent("modalCanceled");this.publishEvent("updateHeader");this.publishEvent("updateSidebar");this.bind("notifyUser",this.redirectNotifyUserEventHandler_);c.parent().next(".ui-widget-overlay").click(this.callbackWrapper(this.outsideClick))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ModalHandler,a.pkp.classes.Handler);a.pkp.controllers.modal.ModalHandler.DEFAULT_OPTIONS_={autoOpen:!0,width:710,modal:!0,
draggable:!1,resizable:!1,position:["center",100]};a.pkp.controllers.modal.ModalHandler.prototype.checkOptions=function(a){return"object"===typeof a&&void 0===a.buttons};a.pkp.controllers.modal.ModalHandler.prototype.mergeOptions=function(c){return a.extend(!0,{},this.self("DEFAULT_OPTIONS_"),c)};a.pkp.controllers.modal.ModalHandler.prototype.modalClose=function(c,b){b&&"cancelFormButton"==b.currentTarget.id&&this.trigger("modalCanceled");var d=this.getHtmlElement(),e=d.find("form").first();if(1==
e.length&&(e=a.pkp.classes.Handler.getHandler(a("#"+e.attr("id"))),e.formChangesTracked))if(confirm(a.pkp.locale.form_dataHasChanged))this.trigger("unregisterAllForms");else return!1;d.dialog("close");return!1};a.pkp.controllers.modal.ModalHandler.prototype.dialogClose=function(c){a(c).dialog("destroy");this.getHtmlElement().empty();this.remove()};a.pkp.controllers.modal.ModalHandler.prototype.outsideClick=function(a,b){this.modalClose(a,b)};a.pkp.controllers.modal.ModalHandler.prototype.fixTitleBar_=
function(c,b){var d=a('<div class="pkp_controllers_modal_titleBar"></div>'),e,f=b.title||null,g=b.titleIcon||"";e=a('<a class="close ui-corner-all" href="#"><span class="xIcon">close</span></a>"');e.click(this.callbackWrapper(this.modalClose));d.append(e);f&&d.append(['<div class="large_sprite modal_title '+g+'"></div><h2>',f,"</h2>"].join(""));d.append(a('<span style="clear:both" />'));c.parent().find(".ui-dialog-titlebar").replaceWith(d)};a.pkp.controllers.modal.ModalHandler.prototype.fixCloseButton_=
function(c){var b=a('<a id="cancelFormButton" class="cancelFormButton" href="#">Cancel</a>'),c=c.parent();c.find(".ui-dialog-buttonset").css({width:"90%",padding:"10px 20px"});c.find(".ui-dialog-buttonset button:first").css({"float":"right",margin:"0px"});c.find(".ui-dialog-buttonset button:last").replaceWith(b);c.find(".cancelFormButton").bind("click",this.callbackWrapper(this.modalClose))};a.pkp.controllers.modal.ModalHandler.prototype.redirectNotifyUserEventHandler_=function(c,b,d){a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent(this,
d)}})(jQuery);(function(a){a.pkp.controllers.modal.ConfirmationModalHandler=function(a,b){this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ConfirmationModalHandler,a.pkp.controllers.modal.ModalHandler);a.pkp.controllers.modal.ConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.okButton&&(!1===a.cancelButton||"string"===typeof a.cancelButton)&&"string"===typeof a.dialogText};a.pkp.controllers.modal.ConfirmationModalHandler.prototype.mergeOptions=
function(a){var b=this.parent("mergeOptions",a);b.buttons={};b.buttons[a.okButton]=this.callbackWrapper(this.modalConfirm);delete a.okButton;a.cancelButton&&(b.buttons[a.cancelButton]=this.callbackWrapper(this.modalClose),delete a.cancelButton);this.getHtmlElement().html(b.dialogText);delete b.dialogText;return b};a.pkp.controllers.modal.ConfirmationModalHandler.prototype.modalConfirm=function(a){this.modalClose(a)}})(jQuery);(function(a){a.pkp.controllers.modal.RemoteActionConfirmationModalHandler=function(a,b){this.parent(a,b);this.remoteAction_=b.remoteAction};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.RemoteActionConfirmationModalHandler,a.pkp.controllers.modal.ConfirmationModalHandler);a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.remoteAction_=null;a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",
a)?!1:"string"===typeof a.cancelButton&&"string"===typeof a.remoteAction};a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.modalConfirm=function(){a.post(this.remoteAction_,this.callbackWrapper(this.remoteResponse),"json")};a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.remoteResponse=function(a,b){!1!==this.parent("remoteResponse",a,b)&&this.modalClose(a);return!1}})(jQuery);(function(a){a.pkp.controllers.modal.AjaxModalHandler=function(a,b){this.parent(a,b);this.bind("formSubmitted",this.modalClose);this.bind("formCanceled",this.modalClose);this.bind("ajaxHtmlError",this.modalClose)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.AjaxModalHandler,a.pkp.controllers.modal.ModalHandler);a.pkp.controllers.modal.AjaxModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.url};a.pkp.controllers.modal.AjaxModalHandler.prototype.mergeOptions=
function(a){this.bind("dialogopen",this.dialogOpen);return this.parent("mergeOptions",a)};a.pkp.controllers.modal.AjaxModalHandler.prototype.modalClose=function(a,b){"formSubmitted"==b.type&&this.getHtmlElement().parent().trigger("notifyUser");return this.parent("modalClose")};a.pkp.controllers.modal.AjaxModalHandler.prototype.dialogOpen=function(c){var c=a(c),b;c.css({"max-height":600,"overflow-y":"auto","z-index":"10000"});b=c.dialog("option","url");c.pkpAjaxHtml(b)}})(jQuery);(function(a){a.pkp.controllers.grid.filter=a.pkp.controllers.grid.filter||{form:{}};a.pkp.controllers.grid.filter.form.FilterFormHandler=function(c,b){this.parent(c,b);if(!0===b.noMoreTemplates||!0===b.filterTemplates)this.disableFormControls(),a(b.pulldownSelector).change(this.callbackWrapper(this.selectOptionHandler_)),b.filterTemplates&&this.bind("pkpRemoveHandler",this.removeHandler_);this.editFilterUrlTemplate_=b.editFilterUrlTemplate};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.filter.form.FilterFormHandler,
a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.grid.filter.form.FilterFormHandler.prototype.editFilterUrlTemplate_=null;a.pkp.controllers.grid.filter.form.FilterFormHandler.prototype.selectOptionHandler_=function(c){a(c).hide();a.get(this.editFilterUrlTemplate_.replace("DUMMY_FILTER_TEMPLATE_ID",a(c).val()),this.callbackWrapper(this.getFilterForm_),"json")};a.pkp.controllers.grid.filter.form.FilterFormHandler.prototype.removeHandler_=function(){this.unbind("pkpRemoveHandler",this.removeHandler_)};
a.pkp.controllers.grid.filter.form.FilterFormHandler.prototype.getFilterForm_=function(c,b){var d=this.handleJson(b);this.remove();this.getHtmlElement().replaceWith(a(d.content))}})(jQuery);(function(a){a.pkp.pages=a.pkp.pages||{};a.pkp.pages.search=a.pkp.pages.search||{};a.pkp.pages.search.SearchFormHandler=function(a,b){a.find('input[name="query"]').focus().select();b.submitHandler=this.submitForm;b.trackFormChanges=!1;b.transformButtons=!1;this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.pages.search.SearchFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.pages.search.SearchFormHandler.prototype.submitForm=function(c){var b,d,e,f,g;b=this.getHtmlElement();e="query authors title abstract discipline subject type coverage indexTerms suppFiles galleyFullText".split(" ");
f=0;for(g=e.length;f<g&&!(d=""==b.find('input[name="'+e[f]+'"]').val(),!d);f++);d?alert(a.pkp.locale.search_noKeywordError):this.submitFormWithoutValidation(c)}})(jQuery);(function(a){a.pkp.plugins.generic.lucene=a.pkp.plugins.generic.lucene||{};a.pkp.plugins.generic.lucene.LuceneAutocompleteHandler=function(a,b){b.minLength=1;b.searchForm=b.searchForm||"searchForm";this.searchForm_=b.searchForm;this.parent(a,b)};a.pkp.classes.Helper.inherits(a.pkp.plugins.generic.lucene.LuceneAutocompleteHandler,a.pkp.controllers.AutocompleteHandler);a.pkp.plugins.generic.lucene.LuceneAutocompleteHandler.prototype.searchForm_="";a.pkp.plugins.generic.lucene.LuceneAutocompleteHandler.prototype.fetchAutocomplete=
function(c,b,d){var e;e=this.textInput;e.addClass("spinner");a.post(this.getAutocompleteUrl(),a("#"+this.searchForm_).serialize(),function(a){e.removeClass("spinner");d(a.content)},"json")}})(jQuery);(function(a){a.fn.pkpHandler=function(c,b){this.each(function(){var d=a(this);b=b||{};a.pkp.classes.Helper.objectFactory(c,[d,b])});return this};a.fn.pkpAjaxHtml=function(c,b){var d=this.first();a.ajax({url:c,dataType:"json",success:function(a){d.find("#loading").hide();!0===a.status?(a.content&&d.html(a.content),b&&b()):(d.trigger("ajaxHtmlError",a.content),alert(a.content))},error:function(){alert("Failed Ajax request or invalid JSON returned.")}});d.html("<div id='loading' class='throbber'></div>");
return this}})(jQuery);
