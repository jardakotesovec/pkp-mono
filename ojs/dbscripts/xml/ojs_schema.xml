<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE schema SYSTEM "xmlschema.dtd">

<!--
  * ojs_schema.xml
  *
  * Copyright (c) 2003-2004 The Public Knowledge Project
  * Distributed under the GNU GPL v2. For full terms see the file docs/COPYING.
  *
  * OJS database schema in XML.
  *
  * $Id$
  -->

<schema version="0.2">

	<!--
	  *
	  * TABLE site
	  *
	  -->
	<table name="site">
		<descr>Common site settings.</descr>
		<field name="title" type="C" size="120">
			<NOTNULL/>
			<DEFAULT value="Open Journal Systems"/>
		</field>
		<field name="intro" type="X"/>
		<field name="journal_redirect" type="I8">
			<descr>If not 0, redirect to the specified journal site.</descr>
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
	</table>

	<!--
	  *
	  * TABLE users
	  *
	  -->
	<table name="users">
		<descr>User authentication credentials and profile data.</descr>
		<field name="user_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="username" type="C" size="32">
			<NOTNULL/>
		</field>
		<field name="password" type="C" size="32">
			<NOTNULL/>
		</field>
		<field name="first_name" type="C" size="40">
			<NOTNULL/>
		</field>
		<field name="middle_name" type="C" size="40"/>
		<field name="last_name" type="C" size="90">
			<NOTNULL/>
		</field>
		<field name="affiliation" type="C" size="255"/>
		<field name="email" type="C" size="90">
			<NOTNULL/>
		</field>
		<field name="phone" type="C" size="24"/>
		<field name="fax" type="C" size="24"/>
		<field name="mailing_address" type="C" size="255"/>
		<field name="biography" type="X"/>
		<field name="date_registered" type="T">
			<NOTNULL/>
		</field>
		<index name="username">
			<col>username</col>
			<UNIQUE/>
		</index>
		<index name="email">
			<col>email</col>
			<UNIQUE/>
		</index>
	</table>

	<!--
	  *
	  * TABLE sessions
	  *
	  -->
	<table name="sessions">
		<descr>Browser/user sessions and session data.</descr>
		<field name="session_id" type="C" size="32">
			<KEY/>
		</field>
		<field name="user_id" type="I8">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<field name="ip_address" type="C" size="15">
			<NOTNULL/>
		</field>
		<field name="user_agent" type="C" size="255"/>
		<field name="created" type="I8">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<field name="last_used" type="I8">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<field name="remember" type="L">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<field name="data" type="X">
			<NOTNULL/>
			<DEFAULT value=""/>
		</field>
		<index name="user_id">
			<col>user_id</col>
		</index>
	</table>

	<!--
	  *
	  * TABLE journals
	  *
	  -->
	<table name="journals">
		<descr>Journals and basic journal settings.</descr>
		<field name="journal_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="title" type="C" size="255">
			<NOTNULL/>
		</field>
		<field name="path" type="C" size="32">
			<NOTNULL/>
		</field>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<index name="path">
			<col>path</col>
			<UNIQUE/>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE journal_settings
	  *
	  -->
	<table name="journal_settings">
		<descr>Journal settings.</descr>
		<field name="journal_id" type="I8">
			<KEY/>
		</field>
		<field name="setting_name" type="C" size="255">
			<KEY/>
		</field>
		<field name="setting_value" type="X"/>
		<field name="setting_type" type="C" size="6">
			<descr>(bool|int|float|string|object)</descr>
			<NOTNULL/>
		</field>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE roles
	  *
	  -->
	<table name="roles">
		<descr>User roles in journals.</descr>
		<field name="journal_id" type="I8">
			<KEY/>
		</field>
		<field name="user_id" type="I8">
			<KEY/>
		</field>
		<field name="role_id" type="I8">
			<KEY/>
		</field>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
		<index name="user_id">
			<col>user_id</col>
		</index>
		<index name="role_id">
			<col>role_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE sections
	  *
	  -->
	<table name="sections">
		<descr>Journal sections.</descr>
		<field name="section_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="title" type="C" size="120">
			<NOTNULL/>
		</field>
		<field name="abbrev" type="C" size="20"/>
		<field name="seq" type="F">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE section_editors
	  *
	  -->
	<table name="section_editors">
		<descr>Assignments of section editors to sections.</descr>
		<field name="journal_id" type="I8">
			<KEY/>
		</field>
		<field name="section_id" type="I8">
			<KEY/>
		</field>
		<field name="user_id" type="I8">
			<KEY/>
		</field>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
		<index name="section_id">
			<col>section_id</col>
		</index>
		<index name="user_id">
			<col>user_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE issues
	  *
	  -->
	<table name="issues">
		<descr>Journal issues.</descr>
		<field name="issue_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="title" type="C" size="120"/>
		<field name="volume" type="I2"/>
		<field name="number" type="I2"/>
		<field name="year" type="I2"/>
		<field name="published" type="L">
			<NOTNULL/>
			<DEFAULT value="0"/>
		</field>
		<field name="current" type="L">
			<NOTNULL/>
			<DEFAULT VALUE="0"/>
		</field>
		<field name="date_published" type="T"/>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE review_assignments
	  *
	  -->
	<table name="review_assignments">
		<descr>Reviewing assignments.</descr>
		<field name="review_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="article_id" type="I8">v
			<NOTNULL/>
		</field>
		<field name="reviewer_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="comments" type="X"/>
		<field name="recommendation" type="I1"/>
		<field name="date_notified" type="T"/>
		<field name="date_completed" type="T"/>
		<field name="date_acknowledged" type="T"/>
		<index name="article_id">
			<col>article_id</col>
		</index>
		<index name="reviewer_id">
			<col>reviewer_id</col>
		</index>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE copyed_assignments
	  *
	  -->
	<table name="copyed_assignments">
		<descr>Copyediting assignments.</descr>
		<field name="copyed_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="article_id" type="I8">v
			<NOTNULL/>
		</field>
		<field name="copyeditor_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="comments" type="X"/>
		<field name="date_notified" type="T"/>
		<field name="date_completed" type="T"/>
		<field name="date_acknowledged" type="T"/>
		<field name="date_author_notified" type="T"/>
		<field name="date_author_completed" type="T"/>
		<field name="date_author_acknowledged" type="T"/>
		<index name="article_id">
			<col>article_id</col>
		</index>
		<index name="copyeditor_id">
			<col>copyeditor_id</col>
		</index>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE proof_assignments
	  *
	  -->
	<table name="proof_assignments">
		<descr>Proofreading assignments.</descr>
		<field name="proof_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="article_id" type="I8">v
			<NOTNULL/>
		</field>
		<field name="proofreader_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="comments" type="X"/>
		<field name="date_notified" type="T"/>
		<field name="date_completed" type="T"/>
		<field name="date_acknowledged" type="T"/>
		<field name="date_author_notified" type="T"/>
		<field name="date_author_completed" type="T"/>
		<index name="article_id">
			<col>article_id</col>
		</index>
		<index name="proofreader_id">
			<col>proofreader_id</col>
		</index>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE article_comments
	  *
	  -->
	<table name="article_comments">
		<descr>Comments posted on articles.</descr>
		<field name="comment_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="article_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="author_name" type="C" size="120">
			<NOTNULL/>
		</field>
		<field name="author_email" type="C" size="120">
			<NOTNULL/>
		</field>
		<field name="comment_title" type="C" size="90">
			<NOTNULL/>
		</field>
		<field name="comments" type="X"/>
		<field name="date_posted" type="T"/>
		<index name="article_id">
			<col>article_id</col>
		</index>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE email_templates
	  *
	  -->
	<table name="email_templates">
		<descr>Templates for journal emails.</descr>
		<field name="email_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="email_key" type="I8">
			<descr>Unique identifier for this email.</descr>
			<NOTNULL/>
		</field>
		<field name="journal_id" type="I8">
			<NOTNULL/>
		</field>
		<field name="subject" type="C" size="120">
			<NOTNULL/>
		</field>
		<field name="body" type="X"/>
		<index name="email_key">
			<col>email_key</col>
			<UNIQUE/>
		</index>
		<index name="journal_id">
			<col>journal_id</col>
		</index>
	</table>
	
	<!--
	  *
	  * TABLE email_templates_default
	  *
	  -->
	<table name="email_templates_default">
		<descr>Default journal email templates.</descr>
		<field name="email_id" type="I8">
			<KEY/>
			<AUTOINCREMENT/>
		</field>
		<field name="email_key" type="I8">
			<descr>Unique identifier for this email.</descr>
			<NOTNULL/>
		</field>
		<field name="subject" type="C" size="120">
			<NOTNULL/>
		</field>
		<field name="body" type="X"/>
		<index name="email_key">
			<col>email_key</col>
			<UNIQUE/>
		</index>
	</table>
	
	<!--
	  *
	  * SQL to complete initial setup
	  *
	  -->
	<sql>
		<descr>Insert some initial data (TEMPORARY -- should be handled by an installation script instead).</descr>
		<query>INSERT INTO site (title) VALUES ('Open Journal Systems')</query>
		<query>INSERT INTO users (username, password) VALUES ('admin', md5('admin'))</query>
		<query>INSERT INTO roles (journal_id, user_id, role_id) VALUES (0, 1, 1)</query>
	</sql>
	
</schema>
